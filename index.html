<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema Productividad UQ 2024</title>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-app.js";
        import { getFirestore, collection, addDoc, getDocs, updateDoc, doc, query, orderBy, getDoc, deleteDoc } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-firestore.js";
        import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-auth.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBbqMf8ZOmqmbGTmr2tr8nziyUWKSE6OWg",
            authDomain: "uniquindio-produccion.firebaseapp.com",
            projectId: "uniquindio-produccion",
            storageBucket: "uniquindio-produccion.firebasestorage.app",
            messagingSenderId: "440871309124",
            appId: "1:440871309124:web:108be1894adaf6ecaf1111"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);
        
        const urlAppsScript = "https://script.google.com/macros/s/AKfycbz6Ro0qt7YOM3pDuDOyMbaSUhuO-hAGC_-ljKCNqx9ook4jXqaykdeYcoFu9CbIPvQMGg/exec";

        let rolActual = '';
        let idRegistroActual = null;
        let baseDocentes = [];
        let docenteSeleccionadoActual = null;
        let modoEdicion = false;

        const CONTRASE√ëAS = {
            'JOSE': 'jose2026',
            'LINA': 'lina2026'
        };

        // ==================== CONFIGURACI√ìN DE CAMPOS POR CATEGOR√çA CON PARES EVALUADORES ====================
        const CAMPOS_POR_CATEGORIA = {
            "Art√≠culos Indexados": [
                { nombre: "nombre_articulo", label: "Nombre del Art√≠culo", tipo: "text", requerido: true },
                { nombre: "titulo_revista", label: "T√≠tulo de la Revista", tipo: "text", requerido: true },
                { nombre: "doc_completa", label: "Documentaci√≥n Completa", tipo: "select", opciones: ["SI", "NO"], requerido: true }
            ],
            "Art√≠culos No Indexados": [
                { nombre: "nombre_articulo", label: "Nombre del Art√≠culo", tipo: "text", requerido: true },
                { nombre: "titulo_revista", label: "T√≠tulo de la Revista", tipo: "text", requerido: true }
            ],
            "Libro Investigaci√≥n": [
                { nombre: "titulo_libro", label: "T√≠tulo del Libro", tipo: "text", requerido: true },
                { nombre: "par1_nombre", label: "Par Evaluador 1 - Nombre", tipo: "text", requerido: false, grupo: "par1" },
                { nombre: "par1_perfil", label: "Par Evaluador 1 - Perfil", tipo: "text", requerido: false, grupo: "par1" },
                { nombre: "par1_fecha_verificacion", label: "Par Evaluador 1 - Fecha Verificaci√≥n", tipo: "date", requerido: false, grupo: "par1" },
                { nombre: "par1_link_verificacion", label: "Par Evaluador 1 - Link Verificaci√≥n", tipo: "text", requerido: false, grupo: "par1" },
                { nombre: "par2_nombre", label: "Par Evaluador 2 - Nombre", tipo: "text", requerido: false, grupo: "par2" },
                { nombre: "par2_perfil", label: "Par Evaluador 2 - Perfil", tipo: "text", requerido: false, grupo: "par2" },
                { nombre: "par2_fecha_verificacion", label: "Par Evaluador 2 - Fecha Verificaci√≥n", tipo: "date", requerido: false, grupo: "par2" },
                { nombre: "par2_link_verificacion", label: "Par Evaluador 2 - Link Verificaci√≥n", tipo: "text", requerido: false, grupo: "par2" },
                { nombre: "fecha_invitacion", label: "Fecha Invitaci√≥n", tipo: "date", requerido: false }
            ],
            "Libro Texto": [
                { nombre: "titulo_libro", label: "T√≠tulo del Libro", tipo: "text", requerido: true },
                { nombre: "area_conocimiento", label: "√Årea de Conocimiento", tipo: "text", requerido: true },
                { nombre: "enviado_curricular", label: "Enviado Curricular", tipo: "date", requerido: false },
                { nombre: "recibido_curricular", label: "Recibido del Curricular", tipo: "date", requerido: false },
                { nombre: "par1_nombre", label: "Par Evaluador 1 - Nombre", tipo: "text", requerido: false, grupo: "par1" },
                { nombre: "par1_perfil", label: "Par Evaluador 1 - Perfil", tipo: "text", requerido: false, grupo: "par1" },
                { nombre: "par1_fecha_verificacion", label: "Par Evaluador 1 - Fecha Verificaci√≥n", tipo: "date", requerido: false, grupo: "par1" },
                { nombre: "par1_link_verificacion", label: "Par Evaluador 1 - Link Verificaci√≥n", tipo: "text", requerido: false, grupo: "par1" },
                { nombre: "par2_nombre", label: "Par Evaluador 2 - Nombre", tipo: "text", requerido: false, grupo: "par2" },
                { nombre: "par2_perfil", label: "Par Evaluador 2 - Perfil", tipo: "text", requerido: false, grupo: "par2" },
                { nombre: "par2_fecha_verificacion", label: "Par Evaluador 2 - Fecha Verificaci√≥n", tipo: "date", requerido: false, grupo: "par2" },
                { nombre: "par2_link_verificacion", label: "Par Evaluador 2 - Link Verificaci√≥n", tipo: "text", requerido: false, grupo: "par2" },
                { nombre: "fecha_invitacion", label: "Fecha Invitaci√≥n", tipo: "date", requerido: false },
                { nombre: "fecha_reemision", label: "Fecha Reemisi√≥n", tipo: "date", requerido: false }
            ],
            "Libro Ensayo": [
                { nombre: "titulo_libro", label: "T√≠tulo del Libro", tipo: "text", requerido: true },
                { nombre: "area_conocimiento", label: "√Årea de Conocimiento", tipo: "text", requerido: true },
                { nombre: "enviado_facultad", label: "Enviado Facultad", tipo: "date", requerido: false },
                { nombre: "recibido_facultad", label: "Recibido Facultad", tipo: "date", requerido: false },
                { nombre: "par1_nombre", label: "Par Evaluador 1 - Nombre", tipo: "text", requerido: false, grupo: "par1" },
                { nombre: "par1_perfil", label: "Par Evaluador 1 - Perfil", tipo: "text", requerido: false, grupo: "par1" },
                { nombre: "par1_fecha_verificacion", label: "Par Evaluador 1 - Fecha Verificaci√≥n", tipo: "date", requerido: false, grupo: "par1" },
                { nombre: "par1_link_verificacion", label: "Par Evaluador 1 - Link Verificaci√≥n", tipo: "text", requerido: false, grupo: "par1" },
                { nombre: "par2_nombre", label: "Par Evaluador 2 - Nombre", tipo: "text", requerido: false, grupo: "par2" },
                { nombre: "par2_perfil", label: "Par Evaluador 2 - Perfil", tipo: "text", requerido: false, grupo: "par2" },
                { nombre: "par2_fecha_verificacion", label: "Par Evaluador 2 - Fecha Verificaci√≥n", tipo: "date", requerido: false, grupo: "par2" },
                { nombre: "par2_link_verificacion", label: "Par Evaluador 2 - Link Verificaci√≥n", tipo: "text", requerido: false, grupo: "par2" },
                { nombre: "fecha_invitacion", label: "Fecha Invitaci√≥n", tipo: "date", requerido: false },
                { nombre: "fecha_reemision", label: "Fecha Reemisi√≥n", tipo: "date", requerido: false }
            ],
            "Software": [
                { nombre: "titulo_software", label: "T√≠tulo del Software", tipo: "text", requerido: true },
                { nombre: "estado", label: "Estado", tipo: "select", opciones: ["En proceso", "Completo", "Pendiente"], requerido: true },
                { nombre: "fecha_envio_comite", label: "Fecha Env√≠o Comit√©", tipo: "date", requerido: false },
                { nombre: "concepto_comite", label: "Concepto Comit√©", tipo: "select", opciones: ["SI", "NO"], requerido: false },
                { nombre: "par1_nombre", label: "Par Evaluador 1 - Nombre", tipo: "text", requerido: false, grupo: "par1" },
                { nombre: "par1_perfil", label: "Par Evaluador 1 - Perfil", tipo: "text", requerido: false, grupo: "par1" },
                { nombre: "par1_fecha_verificacion", label: "Par Evaluador 1 - Fecha Verificaci√≥n", tipo: "date", requerido: false, grupo: "par1" },
                { nombre: "par1_link_verificacion", label: "Par Evaluador 1 - Link Verificaci√≥n", tipo: "text", requerido: false, grupo: "par1" },
                { nombre: "par2_nombre", label: "Par Evaluador 2 - Nombre", tipo: "text", requerido: false, grupo: "par2" },
                { nombre: "par2_perfil", label: "Par Evaluador 2 - Perfil", tipo: "text", requerido: false, grupo: "par2" },
                { nombre: "par2_fecha_verificacion", label: "Par Evaluador 2 - Fecha Verificaci√≥n", tipo: "date", requerido: false, grupo: "par2" },
                { nombre: "par2_link_verificacion", label: "Par Evaluador 2 - Link Verificaci√≥n", tipo: "text", requerido: false, grupo: "par2" },
                { nombre: "fecha_invitacion", label: "Fecha Invitaci√≥n", tipo: "date", requerido: false },
                { nombre: "fecha_remision", label: "Fecha Remisi√≥n", tipo: "date", requerido: false }
            ],
            "Producci√≥n T√©cnica": [
                { nombre: "titulo_produccion", label: "T√≠tulo de la Producci√≥n", tipo: "text", requerido: true },
                { nombre: "estado", label: "Estado", tipo: "select", opciones: ["En proceso", "Completo", "Pendiente"], requerido: true },
                { nombre: "par1_nombre", label: "Par Evaluador 1 - Nombre", tipo: "text", requerido: false, grupo: "par1" },
                { nombre: "par1_perfil", label: "Par Evaluador 1 - Perfil", tipo: "text", requerido: false, grupo: "par1" },
                { nombre: "par1_fecha_verificacion", label: "Par Evaluador 1 - Fecha Verificaci√≥n", tipo: "date", requerido: false, grupo: "par1" },
                { nombre: "par1_link_verificacion", label: "Par Evaluador 1 - Link Verificaci√≥n", tipo: "text", requerido: false, grupo: "par1" },
                { nombre: "par2_nombre", label: "Par Evaluador 2 - Nombre", tipo: "text", requerido: false, grupo: "par2" },
                { nombre: "par2_perfil", label: "Par Evaluador 2 - Perfil", tipo: "text", requerido: false, grupo: "par2" },
                { nombre: "par2_fecha_verificacion", label: "Par Evaluador 2 - Fecha Verificaci√≥n", tipo: "date", requerido: false, grupo: "par2" },
                { nombre: "par2_link_verificacion", label: "Par Evaluador 2 - Link Verificaci√≥n", tipo: "text", requerido: false, grupo: "par2" }
            ],
            "Producci√≥n Audiovisual": [
                { nombre: "titulo_produccion", label: "T√≠tulo de la Producci√≥n", tipo: "text", requerido: true },
                { nombre: "estado", label: "Estado", tipo: "select", opciones: ["En proceso", "Completo", "Pendiente"], requerido: true },
                { nombre: "par1_nombre", label: "Par Evaluador 1 - Nombre", tipo: "text", requerido: false, grupo: "par1" },
                { nombre: "par1_perfil", label: "Par Evaluador 1 - Perfil", tipo: "text", requerido: false, grupo: "par1" },
                { nombre: "par1_fecha_verificacion", label: "Par Evaluador 1 - Fecha Verificaci√≥n", tipo: "date", requerido: false, grupo: "par1" },
                { nombre: "par1_link_verificacion", label: "Par Evaluador 1 - Link Verificaci√≥n", tipo: "text", requerido: false, grupo: "par1" },
                { nombre: "par2_nombre", label: "Par Evaluador 2 - Nombre", tipo: "text", requerido: false, grupo: "par2" },
                { nombre: "par2_perfil", label: "Par Evaluador 2 - Perfil", tipo: "text", requerido: false, grupo: "par2" },
                { nombre: "par2_fecha_verificacion", label: "Par Evaluador 2 - Fecha Verificaci√≥n", tipo: "date", requerido: false, grupo: "par2" },
                { nombre: "par2_link_verificacion", label: "Par Evaluador 2 - Link Verificaci√≥n", tipo: "text", requerido: false, grupo: "par2" },
                { nombre: "fecha_invitacion", label: "Fecha Invitaci√≥n", tipo: "date", requerido: false },
                { nombre: "fecha_reemision", label: "Fecha Reemisi√≥n", tipo: "date", requerido: false }
            ],
            "Obra Art√≠stica": [
                { nombre: "titulo_obra", label: "T√≠tulo de la Obra", tipo: "text", requerido: true },
                { nombre: "par1_nombre", label: "Par Evaluador 1 - Nombre", tipo: "text", requerido: false, grupo: "par1" },
                { nombre: "par1_perfil", label: "Par Evaluador 1 - Perfil", tipo: "text", requerido: false, grupo: "par1" },
                { nombre: "par1_fecha_verificacion", label: "Par Evaluador 1 - Fecha Verificaci√≥n", tipo: "date", requerido: false, grupo: "par1" },
                { nombre: "par1_link_verificacion", label: "Par Evaluador 1 - Link Verificaci√≥n", tipo: "text", requerido: false, grupo: "par1" },
                { nombre: "par2_nombre", label: "Par Evaluador 2 - Nombre", tipo: "text", requerido: false, grupo: "par2" },
                { nombre: "par2_perfil", label: "Par Evaluador 2 - Perfil", tipo: "text", requerido: false, grupo: "par2" },
                { nombre: "par2_fecha_verificacion", label: "Par Evaluador 2 - Fecha Verificaci√≥n", tipo: "date", requerido: false, grupo: "par2" },
                { nombre: "par2_link_verificacion", label: "Par Evaluador 2 - Link Verificaci√≥n", tipo: "text", requerido: false, grupo: "par2" },
                { nombre: "fecha_invitacion", label: "Fecha Invitaci√≥n", tipo: "date", requerido: false },
                { nombre: "fecha_reemision", label: "Fecha Reemisi√≥n", tipo: "date", requerido: false }
            ],
            "Patente": [
                { nombre: "titulo_patente", label: "T√≠tulo de la Patente", tipo: "text", requerido: true }
            ],
            "Premio": [
                { nombre: "titulo_trabajo_premio", label: "T√≠tulo del Trabajo del Premio", tipo: "text", requerido: true },
                { nombre: "premio_otorgado", label: "Premio Otorgado", tipo: "text", requerido: true },
                { nombre: "fecha_premio", label: "Fecha del Premio", tipo: "date", requerido: true },
                { nombre: "doc_completa", label: "Documentaci√≥n Completa", tipo: "select", opciones: ["SI", "NO"], requerido: true }
            ],
            "Ponencias": [
                { nombre: "titulo_ponencia", label: "T√≠tulo de la Ponencia", tipo: "text", requerido: true }
            ],
            "Tesis": [
                { nombre: "titulo_tesis", label: "T√≠tulo de la Tesis", tipo: "text", requerido: true },
                { nombre: "doc_completa", label: "Documentaci√≥n Completa", tipo: "select", opciones: ["SI", "NO"], requerido: true }
            ],
            "Pos Doctorado": [
                { nombre: "titulo_trabajo_posdoctoral", label: "T√≠tulo del Trabajo Posdoctoral Realizado", tipo: "text", requerido: true },
                { nombre: "resolucion_fecha_titulo", label: "Resoluci√≥n y Fecha del T√≠tulo", tipo: "text", requerido: false }
            ],
            "T√≠tulos": [
                { nombre: "titulo_obtenido", label: "T√≠tulo Obtenido", tipo: "text", requerido: true },
                { nombre: "resolucion_convalidacion", label: "Resoluci√≥n y Fecha del T√≠tulo o Convalidaci√≥n", tipo: "text", requerido: false }
            ]
        };

        // ==================== LOGIN ====================
        window.intentarLogin = function(rol) {
            const password = document.getElementById(`password-${rol.toLowerCase()}`).value;
            
            if (!password) {
                alert("‚ö†Ô∏è Ingrese la contrase√±a");
                return;
            }
            
            if (password === CONTRASE√ëAS[rol]) {
                iniciarSesion(rol);
            } else {
                alert("‚ùå Contrase√±a incorrecta");
                document.getElementById(`password-${rol.toLowerCase()}`).value = '';
            }
        };

        function iniciarSesion(rol) {
            rolActual = rol;
            document.getElementById('pantalla-login').classList.add('hidden');
            document.getElementById('btn-cerrar-sesion').classList.remove('hidden');
            
            if (rol === 'JOSE') {
                mostrarPanelJose();
            } else {
                mostrarPanelLina();
            }
        }

        function mostrarPanelJose() {
            document.getElementById('panel-jose').classList.remove('hidden');
            document.getElementById('header-title').innerText = "SEGUIMIENTO DE SOLICITUDES (JOS√â)";
            document.getElementById('header-bg').classList.remove('bg-gray-700', 'bg-blue-900');
            document.getElementById('header-bg').classList.add('bg-green-800');
            cargarBaseDocentes();
            cambiarCategoria();
            cargarRegistrosJose();
        }

        function mostrarPanelLina() {
            document.getElementById('panel-lina').classList.remove('hidden');
            document.getElementById('header-title').innerText = "COMPILADO Y LIQUIDACI√ìN (LINA)";
            document.getElementById('header-bg').classList.remove('bg-gray-700', 'bg-green-800');
            document.getElementById('header-bg').classList.add('bg-blue-900');
            cargarBaseDocentes();
            cargarPendientesLina();
        }

        window.cerrarSesion = function() {
            location.reload();
        };

        window.toggleVista = function() {
            const vistaFormulario = document.getElementById('vista-formulario');
            const vistaTabla = document.getElementById('vista-tabla');
            const btnFormulario = document.getElementById('btn-vista-formulario');
            const btnTabla = document.getElementById('btn-vista-tabla');
            
            if (vistaFormulario.classList.contains('hidden')) {
                vistaFormulario.classList.remove('hidden');
                vistaTabla.classList.add('hidden');
                btnFormulario.classList.add('bg-green-700', 'text-white');
                btnFormulario.classList.remove('bg-gray-200', 'text-gray-700');
                btnTabla.classList.remove('bg-green-700', 'text-white');
                btnTabla.classList.add('bg-gray-200', 'text-gray-700');
            } else {
                vistaFormulario.classList.add('hidden');
                vistaTabla.classList.remove('hidden');
                btnTabla.classList.add('bg-green-700', 'text-white');
                btnTabla.classList.remove('bg-gray-200', 'text-gray-700');
                btnFormulario.classList.remove('bg-green-700', 'text-white');
                btnFormulario.classList.add('bg-gray-200', 'text-gray-700');
                cargarRegistrosJose();
            }
        };

        // ==================== CARGAR DOCENTES ====================
        async function cargarBaseDocentes() {
            try {
                console.log('üîÑ Cargando base de docentes...');
                
                const response = await fetch(urlAppsScript + '?action=obtenerDocentes');
                const data = await response.json();
                
                if (data && Array.isArray(data) && data.length > 0) {
                    baseDocentes = data;
                    
                    const datalistJose = document.getElementById('lista-docentes-jose');
                    if (datalistJose) {
                        datalistJose.innerHTML = '';
                        data.forEach(doc => {
                            const option = document.createElement('option');
                            option.value = doc.nombre;
                            datalistJose.appendChild(option);
                        });
                    }
                    
                    const datalistLina = document.getElementById('lista-docentes-lina');
                    if (datalistLina) {
                        datalistLina.innerHTML = '';
                        data.forEach(doc => {
                            const option = document.createElement('option');
                            option.value = doc.nombre;
                            datalistLina.appendChild(option);
                        });
                    }
                    
                    console.log(`‚úÖ ${data.length} docentes cargados`);
                } else {
                    console.warn('‚ö†Ô∏è No se encontraron docentes');
                    alert('‚ö†Ô∏è No se pudieron cargar los docentes');
                }
                    
            } catch (error) {
                console.error('‚ùå Error al cargar docentes:', error);
                alert('‚ùå Error al conectar con Google Sheets');
            }
        }

        // ==================== AUTOCOMPLETAR DOCENTE ====================
        window.autocompletarDocente = function() {
            const nombreInput = document.getElementById('autor');
            const nombreSeleccionado = nombreInput?.value.trim();
            
            if (!nombreSeleccionado) return;
            
            const docente = baseDocentes.find(d => d.nombre === nombreSeleccionado);
            
            if (docente) {
                docenteSeleccionadoActual = docente;
                
                const programaInput = document.getElementById('programa');
                if (programaInput && docente.dependencia) {
                    programaInput.value = docente.dependencia;
                }
                
                nombreInput.classList.add('border-green-500', 'bg-green-50');
                setTimeout(() => {
                    nombreInput.classList.remove('border-green-500', 'bg-green-50');
                }, 1000);
                
                console.log('‚úÖ Docente encontrado:', docente.nombre);
            } else {
                docenteSeleccionadoActual = null;
                console.log('‚ö†Ô∏è Docente no encontrado');
            }
        };

        // ==================== CAMBIAR CATEGOR√çA Y MOSTRAR CAMPOS DIN√ÅMICOS ====================
        window.cambiarCategoria = function() {
            const categoria = document.getElementById('categoria')?.value;
            const camposExtrasContainer = document.getElementById('campos-extras-jose');
            
            if (!camposExtrasContainer || !categoria) return;
            
            camposExtrasContainer.innerHTML = '';
            
            const campos = CAMPOS_POR_CATEGORIA[categoria] || [];
            
            if (campos.length === 0) return;
            
            const titulo = document.createElement('h3');
            titulo.className = 'col-span-2 text-lg font-bold text-green-800 mt-4 mb-2 border-b-2 border-green-300 pb-2';
            titulo.textContent = `üìã Informaci√≥n Espec√≠fica de ${categoria}`;
            camposExtrasContainer.appendChild(titulo);
            
            // Detectar si hay pares evaluadores
            const tienePares = campos.some(c => c.grupo === 'par1' || c.grupo === 'par2');
            
            if (tienePares) {
                // Crear secci√≥n Par Evaluador 1
                const tituloPar1 = document.createElement('h4');
                tituloPar1.className = 'col-span-2 text-md font-bold text-blue-700 mt-3 mb-2 bg-blue-50 p-2 rounded';
                tituloPar1.textContent = 'üë§ Par Evaluador 1';
                camposExtrasContainer.appendChild(tituloPar1);
                
                campos.filter(c => c.grupo === 'par1').forEach(campo => {
                    crearCampo(campo, camposExtrasContainer);
                });
                
                // Crear secci√≥n Par Evaluador 2
                const tituloPar2 = document.createElement('h4');
                tituloPar2.className = 'col-span-2 text-md font-bold text-purple-700 mt-3 mb-2 bg-purple-50 p-2 rounded';
                tituloPar2.textContent = 'üë§ Par Evaluador 2';
                camposExtrasContainer.appendChild(tituloPar2);
                
                campos.filter(c => c.grupo === 'par2').forEach(campo => {
                    crearCampo(campo, camposExtrasContainer);
                });
                
                // Otros campos que no son de pares
                const otrosCampos = campos.filter(c => !c.grupo);
                if (otrosCampos.length > 0) {
                    const tituloOtros = document.createElement('h4');
                    tituloOtros.className = 'col-span-2 text-md font-bold text-gray-700 mt-3 mb-2 bg-gray-50 p-2 rounded';
                    tituloOtros.textContent = 'üìù Otros Campos';
                    camposExtrasContainer.appendChild(tituloOtros);
                    
                    otrosCampos.forEach(campo => {
                        crearCampo(campo, camposExtrasContainer);
                    });
                }
            } else {
                // Si no hay pares, crear campos normalmente
                campos.forEach(campo => {
                    crearCampo(campo, camposExtrasContainer);
                });
            }
        };

        function crearCampo(campo, container) {
            const div = document.createElement('div');
            
            const label = document.createElement('label');
            label.className = 'block text-xs font-bold text-gray-600 mb-1';
            label.textContent = campo.label.replace('Par Evaluador 1 - ', '').replace('Par Evaluador 2 - ', '') + (campo.requerido ? ' *' : '');
            
            let input;
            
            if (campo.tipo === 'select') {
                input = document.createElement('select');
                input.className = 'w-full p-2 border rounded';
                
                const optionVacia = document.createElement('option');
                optionVacia.value = '';
                optionVacia.textContent = 'Seleccione...';
                input.appendChild(optionVacia);
                
                campo.opciones.forEach(opcion => {
                    const option = document.createElement('option');
                    option.value = opcion;
                    option.textContent = opcion;
                    input.appendChild(option);
                });
            } else if (campo.tipo === 'textarea') {
                input = document.createElement('textarea');
                input.rows = 3;
                input.className = 'w-full p-2 border rounded';
            } else {
                input = document.createElement('input');
                input.type = campo.tipo;
                input.className = 'w-full p-2 border rounded';
            }
            
            input.id = campo.nombre;
            if (campo.requerido) {
                input.required = true;
            }
            
            div.appendChild(label);
            div.appendChild(input);
            container.appendChild(div);
        }

        // ==================== ENVIAR/ACTUALIZAR SOLICITUD ====================
        window.enviarSolicitud = async function() {
            const btnEnviar = document.getElementById('btn-enviar-jose');
            const categoriaSeleccionada = document.getElementById('categoria').value;
            
            // Validar campos obligatorios
            const camposRequeridos = ['categoria', 'anio', 'semestre', 'fecha_recibido', 'autor', 'programa'];
            for (let campo of camposRequeridos) {
                const valor = document.getElementById(campo)?.value;
                if (!valor || valor.trim() === '') {
                    alert(`‚ö†Ô∏è El campo es obligatorio: ${campo}`);
                    return;
                }
            }
            
            // Validar campos espec√≠ficos requeridos
            const camposEspecificos = CAMPOS_POR_CATEGORIA[categoriaSeleccionada] || [];
            for (let campo of camposEspecificos) {
                if (campo.requerido) {
                    const valor = document.getElementById(campo.nombre)?.value;
                    if (!valor || valor.trim() === '') {
                        alert(`‚ö†Ô∏è El campo es obligatorio: ${campo.label}`);
                        return;
                    }
                }
            }
            
            btnEnviar.disabled = true;
            btnEnviar.textContent = '‚è≥ Enviando...';
            
            try {
                const datosGenerales = {
                    tipo_registro: modoEdicion ? "JOSE_EDIT" : "JOSE",
                    timestamp: modoEdicion ? (document.getElementById('timestamp_original')?.value || new Date().toISOString()) : new Date().toISOString(),
                    categoria: categoriaSeleccionada,
                    anio: document.getElementById('anio').value,
                    semestre: document.getElementById('semestre').value,
                    fecha_recibido: document.getElementById('fecha_recibido').value,
                    autor: document.getElementById('autor').value,
                    programa: document.getElementById('programa').value,
                    estado_ciarp: 'Pendiente',
                    observaciones_jose: document.getElementById('observaciones-jose')?.value || ''
                };
                
                // Guardar informaci√≥n del docente
                if (docenteSeleccionadoActual) {
                    datosGenerales.docente_info = docenteSeleccionadoActual;
                }
                
                // Recoger campos espec√≠ficos
                camposEspecificos.forEach(campo => {
                    const valor = document.getElementById(campo.nombre)?.value;
                    if (valor) {
                        datosGenerales[campo.nombre] = valor;
                    }
                });
                
                console.log('üì§ Enviando datos:', datosGenerales);
                
                let firebaseId = '';
                
                if (modoEdicion && idRegistroActual) {
                    // ACTUALIZAR registro existente
                    datosGenerales._fila = document.getElementById('fila_original')?.value;
                    
                    const docRef = doc(db, 'solicitudes', idRegistroActual);
                    await updateDoc(docRef, datosGenerales);
                    console.log('‚úÖ Actualizado en Firebase:', idRegistroActual);
                    firebaseId = idRegistroActual;
                } else {
                    // CREAR nuevo registro
                    const docRef = await addDoc(collection(db, 'solicitudes'), datosGenerales);
                    console.log('‚úÖ Guardado en Firebase:', docRef.id);
                    firebaseId = docRef.id;
                }
                
                // Enviar a Google Sheets
                const responseSheets = await fetch(urlAppsScript, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(datosGenerales)
                });
                
                const resultSheets = await responseSheets.json();
                console.log('‚úÖ Respuesta de Sheets:', resultSheets);
                
                if (resultSheets.status === 'success') {
                    // Guardar _fila si es nuevo registro
                    if (!modoEdicion && resultSheets.fila && firebaseId) {
                        const docRef = doc(db, 'solicitudes', firebaseId);
                        await updateDoc(docRef, {
                            _fila: resultSheets.fila,
                            _categoria: datosGenerales.categoria
                        });
                        console.log('‚úÖ _fila guardado:', resultSheets.fila);
                    }
                    
                    alert(modoEdicion ? '‚úÖ Registro actualizado correctamente' : '‚úÖ Solicitud enviada correctamente');
                    limpiarFormularioJose();
                    cargarRegistrosJose();
                } else {
                    throw new Error(resultSheets.message || 'Error desconocido');
                }
                
            } catch (error) {
                console.error('‚ùå Error:', error);
                alert('‚ùå Error al enviar: ' + error.message);
            } finally {
                btnEnviar.disabled = false;
                btnEnviar.textContent = modoEdicion ? 'üíæ GUARDAR CAMBIOS' : '‚úÖ ENVIAR SOLICITUD';
            }
        };

        function limpiarFormularioJose() {
            document.getElementById('form-jose').reset();
            document.getElementById('campos-extras-jose').innerHTML = '';
            docenteSeleccionadoActual = null;
            modoEdicion = false;
            idRegistroActual = null;
            document.getElementById('btn-enviar-jose').textContent = '‚úÖ ENVIAR SOLICITUD';
        }

        // ==================== CARGAR REGISTROS JOS√â ====================
        async function cargarRegistrosJose() {
            try {
                const q = query(collection(db, 'solicitudes'), orderBy('timestamp', 'desc'));
                const querySnapshot = await getDocs(q);
                
                const tablaRegistros = document.getElementById('tabla-registros-jose');
                tablaRegistros.innerHTML = '';
                
                if (querySnapshot.empty) {
                    tablaRegistros.innerHTML = '<tr><td colspan="7" class="text-center py-8 text-gray-500">No hay registros</td></tr>';
                    return;
                }
                
                querySnapshot.forEach((doc) => {
                    const data = doc.data();
                    const tr = document.createElement('tr');
                    tr.className = 'hover:bg-green-50 cursor-pointer transition';
                    
                    const estadoColor = data.estado_ciarp === 'Aprobado' ? 'text-green-700 font-bold' :
                                       data.estado_ciarp === 'No Aprobado' ? 'text-red-700 font-bold' :
                                       'text-yellow-700 font-bold';
                    
                    let tituloProducto = obtenerTituloProducto(data);
                    
                    tr.innerHTML = `
                        <td class="border p-3 text-sm">${data.categoria || ''}</td>
                        <td class="border p-3 text-sm font-semibold">${tituloProducto}</td>
                        <td class="border p-3 text-sm">${data.autor || ''}</td>
                        <td class="border p-3 text-sm">${data.programa || ''}</td>
                        <td class="border p-3 text-sm ${estadoColor}">${data.estado_ciarp || 'Pendiente'}</td>
                        <td class="border p-3 text-sm text-center font-bold text-blue-700">${data.puntaje_asignado || '0'}</td>
                        <td class="border p-3 text-center">
                            <button onclick="editarRegistroJose('${doc.id}')" class="bg-green-600 hover:bg-green-700 text-white px-3 py-1 rounded text-xs font-bold">
                                ‚úèÔ∏è EDITAR
                            </button>
                        </td>
                    `;
                    
                    tablaRegistros.appendChild(tr);
                });
                
            } catch (error) {
                console.error('‚ùå Error al cargar registros:', error);
                alert('‚ùå Error al cargar registros');
            }
        }

        window.editarRegistroJose = async function(idDoc) {
            try {
                const docRef = doc(db, 'solicitudes', idDoc);
                const docSnap = await getDoc(docRef);
                
                if (!docSnap.exists()) {
                    alert('‚ùå Registro no encontrado');
                    return;
                }
                
                const data = docSnap.data();
                
                // Cambiar a vista de formulario
                document.getElementById('vista-formulario').classList.remove('hidden');
                document.getElementById('vista-tabla').classList.add('hidden');
                document.getElementById('btn-vista-formulario').classList.add('bg-green-700', 'text-white');
                document.getElementById('btn-vista-formulario').classList.remove('bg-gray-200', 'text-gray-700');
                document.getElementById('btn-vista-tabla').classList.remove('bg-green-700', 'text-white');
                document.getElementById('btn-vista-tabla').classList.add('bg-gray-200', 'text-gray-700');
                
                // Activar modo edici√≥n
                modoEdicion = true;
                idRegistroActual = idDoc;
                
                // Llenar formulario
                document.getElementById('categoria').value = data.categoria || '';
                cambiarCategoria();
                
                document.getElementById('anio').value = data.anio || '';
                document.getElementById('semestre').value = data.semestre || '';
                document.getElementById('fecha_recibido').value = data.fecha_recibido || '';
                document.getElementById('autor').value = data.autor || '';
                document.getElementById('programa').value = data.programa || '';
                document.getElementById('observaciones-jose').value = data.observaciones_jose || '';
                
                // Llenar campos espec√≠ficos
                const campos = CAMPOS_POR_CATEGORIA[data.categoria] || [];
                campos.forEach(campo => {
                    const input = document.getElementById(campo.nombre);
                    if (input && data[campo.nombre]) {
                        input.value = data[campo.nombre];
                    }
                });
                
                // Guardar datos originales
                const inputTimestamp = document.createElement('input');
                inputTimestamp.type = 'hidden';
                inputTimestamp.id = 'timestamp_original';
                inputTimestamp.value = data.timestamp;
                document.getElementById('form-jose').appendChild(inputTimestamp);
                
                const inputFila = document.createElement('input');
                inputFila.type = 'hidden';
                inputFila.id = 'fila_original';
                inputFila.value = data._fila || '';
                document.getElementById('form-jose').appendChild(inputFila);
                
                // Cambiar texto del bot√≥n
                document.getElementById('btn-enviar-jose').textContent = 'üíæ GUARDAR CAMBIOS';
                
                // Scroll al inicio
                window.scrollTo({ top: 0, behavior: 'smooth' });
                
            } catch (error) {
                console.error('‚ùå Error al cargar registro:', error);
                alert('‚ùå Error al cargar registro');
            }
        };

        // ==================== CARGAR PENDIENTES (LINA) ====================
        async function cargarPendientesLina() {
            try {
                const q = query(collection(db, 'solicitudes'), orderBy('timestamp', 'desc'));
                const querySnapshot = await getDocs(q);
                
                const tablaPendientes = document.getElementById('tabla-pendientes-lina');
                tablaPendientes.innerHTML = '';
                
                if (querySnapshot.empty) {
                    tablaPendientes.innerHTML = '<tr><td colspan="6" class="text-center py-8 text-gray-500">No hay solicitudes pendientes</td></tr>';
                    return;
                }
                
                querySnapshot.forEach((doc) => {
                    const data = doc.data();
                    const tr = document.createElement('tr');
                    tr.className = 'hover:bg-blue-50 cursor-pointer transition';
                    tr.onclick = () => abrirModalEvaluacion(doc.id, data);
                    
                    const estadoColor = data.estado_ciarp === 'Aprobado' ? 'text-green-700 font-bold' :
                                       data.estado_ciarp === 'No Aprobado' ? 'text-red-700 font-bold' :
                                       'text-yellow-700 font-bold';
                    
                    let tituloProducto = obtenerTituloProducto(data);
                    
                    tr.innerHTML = `
                        <td class="border p-3 text-sm">${data.categoria || ''}</td>
                        <td class="border p-3 text-sm font-semibold">${tituloProducto}</td>
                        <td class="border p-3 text-sm">${data.autor || ''}</td>
                        <td class="border p-3 text-sm">${data.programa || ''}</td>
                        <td class="border p-3 text-sm ${estadoColor}">${data.estado_ciarp || 'Pendiente'}</td>
                        <td class="border p-3 text-sm text-center font-bold text-blue-700">${data.puntaje_asignado || '0'}</td>
                    `;
                    
                    tablaPendientes.appendChild(tr);
                });
                
            } catch (error) {
                console.error('‚ùå Error al cargar pendientes:', error);
                alert('‚ùå Error al cargar solicitudes');
            }
        }

        function obtenerTituloProducto(data) {
            if (data.nombre_articulo) return data.nombre_articulo;
            if (data.titulo_libro) return data.titulo_libro;
            if (data.titulo_software) return data.titulo_software;
            if (data.titulo_produccion) return data.titulo_produccion;
            if (data.titulo_obra) return data.titulo_obra;
            if (data.titulo_patente) return data.titulo_patente;
            if (data.titulo_trabajo_premio) return data.titulo_trabajo_premio;
            if (data.titulo_ponencia) return data.titulo_ponencia;
            if (data.titulo_tesis) return data.titulo_tesis;
            if (data.titulo_trabajo_posdoctoral) return data.titulo_trabajo_posdoctoral;
            if (data.titulo_obtenido) return data.titulo_obtenido;
            return '';
        }

        // ==================== ABRIR MODAL EVALUACI√ìN (LINA) ====================
        window.abrirModalEvaluacion = async function(idDoc, data) {
            idRegistroActual = idDoc;
            
            let tituloProducto = obtenerTituloProducto(data);
            
            // Informaci√≥n de Jos√©
            document.getElementById('info-categoria').textContent = data.categoria || '';
            document.getElementById('info-fecha').textContent = data.fecha_recibido || '';
            document.getElementById('info-titulo').textContent = tituloProducto;
            document.getElementById('info-autor').textContent = data.autor || '';
            document.getElementById('info-programa').textContent = data.programa || '';
            document.getElementById('info-obs-jose').textContent = data.observaciones_jose || 'Sin observaciones';
            
            // Mostrar campos espec√≠ficos de Jos√©
            mostrarCamposEspecificosJose(data);
            
            // Buscar y mostrar informaci√≥n del docente
            let docente = null;
            if (data.docente_info) {
                docente = data.docente_info;
            } else {
                docente = baseDocentes.find(d => d.nombre === data.autor);
            }
            
            if (docente) {
                document.getElementById('buscar-docente-lina').value = docente.nombre;
                document.getElementById('info-cedula').textContent = docente.cedula || '';
                document.getElementById('info-correo').textContent = docente.correo || '';
                document.getElementById('info-escolaridad').textContent = docente.escolaridad || '';
                document.getElementById('info-categoria-doc').textContent = docente.categoria || '';
                document.getElementById('info-dedicacion').textContent = docente.dedicacion || '';
                document.getElementById('info-facultad').textContent = docente.facultad || '';
                document.getElementById('info-contacto').textContent = docente.contacto || '';
                document.getElementById('info-cargo').textContent = docente.cargo || '';
                document.getElementById('info-depto-expedicion').textContent = docente.deptoExpedicion || '';
                document.getElementById('info-municipio-expedicion').textContent = docente.municipioExpedicion || '';
            } else {
                document.getElementById('buscar-docente-lina').value = data.autor;
                ['cedula', 'correo', 'escolaridad', 'categoria-doc', 'dedicacion', 'facultad', 'contacto', 'cargo', 'depto-expedicion', 'municipio-expedicion'].forEach(id => {
                    document.getElementById('info-' + id).textContent = id === 'cedula' ? 'No encontrado' : '';
                });
            }
            
            // Campos editables de Lina
            document.getElementById('edit-estado-ciarp').value = data.estado_ciarp || 'Pendiente';
            document.getElementById('edit-puntaje-eval1').value = data.puntaje_eval1 || '';
            document.getElementById('edit-puntaje-eval2').value = data.puntaje_eval2 || '';
            document.getElementById('edit-puntaje-final').value = data.puntaje_asignado || '';
            document.getElementById('edit-acta').value = data.acta_ciarp || '';
            document.getElementById('edit-resolucion').value = data.resolucion || '';
            document.getElementById('edit-observaciones-lina').value = data.observaciones_lina || '';
            
            document.getElementById('modal-evaluacion').classList.remove('hidden');
        };

        function mostrarCamposEspecificosJose(data) {
            const container = document.getElementById('campos-especificos-jose');
            if (!container) return;
            
            container.innerHTML = '';
            
            const campos = CAMPOS_POR_CATEGORIA[data.categoria] || [];
            
            if (campos.length === 0) return;
            
            const titulo = document.createElement('h4');
            titulo.className = 'col-span-3 text-sm font-bold text-green-800 mt-2 mb-2 border-b border-green-200 pb-1';
            titulo.textContent = `Campos Espec√≠ficos Capturados:`;
            container.appendChild(titulo);
            
            // Detectar si hay pares
            const tienePares = campos.some(c => c.grupo === 'par1' || c.grupo === 'par2');
            
            if (tienePares) {
                // Mostrar Par 1
                const par1Campos = campos.filter(c => c.grupo === 'par1');
                if (par1Campos.some(c => data[c.nombre])) {
                    const tituloPar1 = document.createElement('div');
                    tituloPar1.className = 'col-span-3 text-xs font-bold text-blue-700 mt-2 bg-blue-50 p-2 rounded';
                    tituloPar1.textContent = 'üë§ Par Evaluador 1:';
                    container.appendChild(tituloPar1);
                    
                    par1Campos.forEach(campo => {
                        if (data[campo.nombre]) {
                            const div = document.createElement('div');
                            div.innerHTML = `<strong class="text-gray-700">${campo.label.replace('Par Evaluador 1 - ', '')}:</strong> <span class="text-gray-900">${data[campo.nombre]}</span>`;
                            container.appendChild(div);
                        }
                    });
                }
                
                // Mostrar Par 2
                const par2Campos = campos.filter(c => c.grupo === 'par2');
                if (par2Campos.some(c => data[c.nombre])) {
                    const tituloPar2 = document.createElement('div');
                    tituloPar2.className = 'col-span-3 text-xs font-bold text-purple-700 mt-2 bg-purple-50 p-2 rounded';
                    tituloPar2.textContent = 'üë§ Par Evaluador 2:';
                    container.appendChild(tituloPar2);
                    
                    par2Campos.forEach(campo => {
                        if (data[campo.nombre]) {
                            const div = document.createElement('div');
                            div.innerHTML = `<strong class="text-gray-700">${campo.label.replace('Par Evaluador 2 - ', '')}:</strong> <span class="text-gray-900">${data[campo.nombre]}</span>`;
                            container.appendChild(div);
                        }
                    });
                }
                
                // Otros campos
                const otrosCampos = campos.filter(c => !c.grupo);
                otrosCampos.forEach(campo => {
                    if (data[campo.nombre]) {
                        const div = document.createElement('div');
                        div.innerHTML = `<strong class="text-gray-700">${campo.label}:</strong> <span class="text-gray-900">${data[campo.nombre]}</span>`;
                        container.appendChild(div);
                    }
                });
            } else {
                campos.forEach(campo => {
                    if (data[campo.nombre]) {
                        const div = document.createElement('div');
                        div.innerHTML = `<strong class="text-gray-700">${campo.label}:</strong> <span class="text-gray-900">${data[campo.nombre]}</span>`;
                        container.appendChild(div);
                    }
                });
            }
        }

        window.cerrarModal = function() {
            document.getElementById('modal-evaluacion').classList.add('hidden');
            idRegistroActual = null;
        };

        // ==================== GUARDAR EVALUACI√ìN (LINA) ====================
        window.guardarEvaluacion = async function() {
            if (!idRegistroActual) {
                alert('‚ö†Ô∏è No hay registro seleccionado');
                return;
            }
            
            const btnGuardar = document.getElementById('btn-guardar-lina');
            btnGuardar.disabled = true;
            btnGuardar.textContent = '‚è≥ Guardando...';
            
            try {
                const docRef = doc(db, 'solicitudes', idRegistroActual);
                const docSnap = await getDoc(docRef);
                
                if (!docSnap.exists()) {
                    throw new Error('Registro no encontrado');
                }
                
                const datosActuales = docSnap.data();
                
                const datosLina = {
                    timestamp_lina: new Date().toISOString(),
                    estado_ciarp: document.getElementById('edit-estado-ciarp').value,
                    puntaje_eval1: parseFloat(document.getElementById('edit-puntaje-eval1').value) || 0,
                    puntaje_eval2: parseFloat(document.getElementById('edit-puntaje-eval2').value) || 0,
                    puntaje_asignado: parseFloat(document.getElementById('edit-puntaje-final').value) || 0,
                    acta_ciarp: document.getElementById('edit-acta').value,
                    resolucion: document.getElementById('edit-resolucion').value,
                    observaciones_lina: document.getElementById('edit-observaciones-lina').value
                };
                
                await updateDoc(docRef, datosLina);
                console.log('‚úÖ Actualizado en Firebase');
                
                const datosCompletos = {
                    ...datosActuales,
                    ...datosLina,
                    tipo_registro: "LINA",
                    _fila: datosActuales._fila
                };
                
                const responseSheets = await fetch(urlAppsScript, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(datosCompletos)
                });
                
                const resultSheets = await responseSheets.json();
                console.log('‚úÖ Respuesta de Sheets:', resultSheets);
                
                if (resultSheets.status === 'success') {
                    alert('‚úÖ Evaluaci√≥n guardada correctamente');
                    cerrarModal();
                    cargarPendientesLina();
                } else {
                    throw new Error(resultSheets.message || 'Error desconocido');
                }
                
            } catch (error) {
                console.error('‚ùå Error:', error);
                alert('‚ùå Error al guardar: ' + error.message);
            } finally {
                btnGuardar.disabled = false;
                btnGuardar.textContent = 'üíæ GUARDAR EVALUACI√ìN';
            }
        };

        signInAnonymously(auth).catch(error => {
            console.error('‚ùå Error de autenticaci√≥n:', error);
        });
    </script>
</head>
<body class="bg-gradient-to-br from-gray-100 to-gray-200 min-h-screen">
    <!-- HEADER -->
    <header id="header-bg" class="bg-gray-700 text-white shadow-lg sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 py-4 flex justify-between items-center">
            <h1 id="header-title" class="text-2xl font-bold">SISTEMA DE PRODUCTIVIDAD UQ 2024</h1>
            <button onclick="cerrarSesion()" class="hidden bg-white/20 hover:bg-white/30 px-4 py-2 rounded-lg font-semibold transition" id="btn-cerrar-sesion">
                üö™ Cerrar Sesi√≥n
            </button>
        </div>
    </header>

    <!-- PANTALLA DE LOGIN -->
    <div id="pantalla-login" class="max-w-4xl mx-auto mt-20 px-4">
        <div class="bg-white rounded-3xl shadow-2xl overflow-hidden">
            <div class="bg-gradient-to-r from-green-700 to-blue-900 p-8 text-white text-center">
                <h1 class="text-4xl font-bold mb-2">üéì Sistema de Productividad</h1>
                <p class="text-xl">Universidad del Quind√≠o - 2024</p>
            </div>
            
            <div class="p-10">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <!-- CARD JOS√â -->
                    <div class="bg-green-50 border-4 border-green-200 rounded-2xl p-8 hover:shadow-xl transition">
                        <div class="text-center mb-6">
                            <div class="bg-green-700 text-white w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-4 text-4xl">
                                üìù
                            </div>
                            <h2 class="text-2xl font-bold text-green-900">JOS√â</h2>
                            <p class="text-sm text-green-700 mt-2">Seguimiento de Solicitudes</p>
                        </div>
                        <input type="password" id="password-jose" placeholder="Contrase√±a" 
                               class="w-full p-3 border-2 border-green-300 rounded-lg mb-4 text-center font-bold"
                               onkeypress="if(event.key==='Enter') intentarLogin('JOSE')">
                        <button onclick="intentarLogin('JOSE')" 
                                class="w-full bg-green-700 text-white py-4 rounded-lg font-bold text-lg hover:bg-green-800 transition shadow-lg">
                            ‚úÖ INICIAR SESI√ìN
                        </button>
                    </div>

                    <!-- CARD LINA -->
                    <div class="bg-blue-50 border-4 border-blue-200 rounded-2xl p-8 hover:shadow-xl transition">
                        <div class="text-center mb-6">
                            <div class="bg-blue-900 text-white w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-4 text-4xl">
                                üìä
                            </div>
                            <h2 class="text-2xl font-bold text-blue-900">LINA</h2>
                            <p class="text-sm text-blue-700 mt-2">Compilado y Liquidaci√≥n</p>
                        </div>
                        <input type="password" id="password-lina" placeholder="Contrase√±a" 
                               class="w-full p-3 border-2 border-blue-300 rounded-lg mb-4 text-center font-bold"
                               onkeypress="if(event.key==='Enter') intentarLogin('LINA')">
                        <button onclick="intentarLogin('LINA')" 
                                class="w-full bg-blue-900 text-white py-4 rounded-lg font-bold text-lg hover:bg-blue-950 transition shadow-lg">
                            ‚úÖ INICIAR SESI√ìN
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- PANEL JOS√â -->
    <div id="panel-jose" class="hidden max-w-7xl mx-auto mt-8 px-4 pb-8">
        
        <!-- BOTONES DE NAVEGACI√ìN -->
        <div class="bg-white rounded-xl shadow-lg p-4 mb-6 flex gap-4">
            <button id="btn-vista-formulario" onclick="toggleVista()" 
                    class="flex-1 bg-green-700 text-white py-3 px-6 rounded-lg font-bold hover:bg-green-800 transition">
                üìù NUEVO REGISTRO
            </button>
            <button id="btn-vista-tabla" onclick="toggleVista()" 
                    class="flex-1 bg-gray-200 text-gray-700 py-3 px-6 rounded-lg font-bold hover:bg-gray-300 transition">
                üìã MIS REGISTROS
            </button>
        </div>

        <!-- VISTA FORMULARIO -->
        <div id="vista-formulario" class="bg-white rounded-2xl shadow-xl p-8">
            <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center gap-3">
                <span class="bg-green-700 text-white p-3 rounded-lg">üìù</span>
                REGISTRO DE SOLICITUD
            </h2>
            
            <form id="form-jose" class="space-y-6">
                <!-- Informaci√≥n General -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-xs font-bold text-gray-600 mb-1">Categor√≠a *</label>
                        <select id="categoria" onchange="cambiarCategoria()" required class="w-full p-2 border rounded font-semibold">
                            <option value="">Seleccione...</option>
                            <option>Art√≠culos Indexados</option>
                            <option>Art√≠culos No Indexados</option>
                            <option>Libro Investigaci√≥n</option>
                            <option>Libro Texto</option>
                            <option>Libro Ensayo</option>
                            <option>Software</option>
                            <option>Producci√≥n T√©cnica</option>
                            <option>Producci√≥n Audiovisual</option>
                            <option>Obra Art√≠stica</option>
                            <option>Patente</option>
                            <option>Premio</option>
                            <option>Ponencias</option>
                            <option>Tesis</option>
                            <option>Pos Doctorado</option>
                            <option>T√≠tulos</option>
                        </select>
                    </div>

                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-xs font-bold text-gray-600 mb-1">A√±o *</label>
                            <select id="anio" required class="w-full p-2 border rounded">
                                <option value="2024">2024</option>
                                <option value="2025">2025</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-xs font-bold text-gray-600 mb-1">Semestre *</label>
                            <select id="semestre" required class="w-full p-2 border rounded">
                                <option value="1">1</option>
                                <option value="2">2</option>
                            </select>
                        </div>
                    </div>

                    <div>
                        <label class="block text-xs font-bold text-gray-600 mb-1">Fecha Recibido *</label>
                        <input type="date" id="fecha_recibido" required class="w-full p-2 border rounded">
                    </div>

                    <div>
                        <label class="block text-xs font-bold text-gray-600 mb-1">Autor/Docente *</label>
                        <input type="text" id="autor" list="lista-docentes-jose" required 
                               onchange="autocompletarDocente()" class="w-full p-2 border rounded">
                        <datalist id="lista-docentes-jose"></datalist>
                    </div>

                    <div class="md:col-span-2">
                        <label class="block text-xs font-bold text-gray-600 mb-1">Programa Acad√©mico *</label>
                        <input type="text" id="programa" required class="w-full p-2 border rounded">
                    </div>
                </div>

                <!-- Campos Espec√≠ficos Din√°micos -->
                <div id="campos-extras-jose" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                </div>

                <!-- Observaciones -->
                <div>
                    <label class="block text-xs font-bold text-gray-600 mb-1">Observaciones de Jos√©</label>
                    <textarea id="observaciones-jose" rows="3" class="w-full p-2 border rounded"></textarea>
                </div>

                <button type="button" id="btn-enviar-jose" onclick="enviarSolicitud()" 
                        class="w-full bg-green-700 text-white py-4 rounded-lg font-bold text-lg hover:bg-green-800 transition shadow-lg">
                    ‚úÖ ENVIAR SOLICITUD
                </button>
            </form>
        </div>

        <!-- VISTA TABLA -->
        <div id="vista-tabla" class="hidden bg-white rounded-2xl shadow-xl p-8">
            <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center gap-3">
                <span class="bg-green-700 text-white p-3 rounded-lg">üìã</span>
                MIS REGISTROS
            </h2>
            
            <div class="overflow-x-auto">
                <table class="w-full border-collapse">
                    <thead>
                        <tr class="bg-green-700 text-white">
                            <th class="border p-3 text-sm font-bold">Categor√≠a</th>
                            <th class="border p-3 text-sm font-bold">T√≠tulo</th>
                            <th class="border p-3 text-sm font-bold">Autor</th>
                            <th class="border p-3 text-sm font-bold">Programa</th>
                            <th class="border p-3 text-sm font-bold">Estado</th>
                            <th class="border p-3 text-sm font-bold">Puntaje</th>
                            <th class="border p-3 text-sm font-bold">Acciones</th>
                        </tr>
                    </thead>
                    <tbody id="tabla-registros-jose">
                        <tr><td colspan="7" class="text-center py-8 text-gray-500">Cargando...</td></tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- PANEL LINA -->
    <div id="panel-lina" class="hidden max-w-7xl mx-auto mt-8 px-4 pb-8">
        <div class="bg-white rounded-2xl shadow-xl p-8">
            <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center gap-3">
                <span class="bg-blue-900 text-white p-3 rounded-lg">üìä</span>
                SOLICITUDES PENDIENTES
            </h2>
            
            <div class="overflow-x-auto">
                <table class="w-full border-collapse">
                    <thead>
                        <tr class="bg-blue-900 text-white">
                            <th class="border p-3 text-sm font-bold">Categor√≠a</th>
                            <th class="border p-3 text-sm font-bold">T√≠tulo</th>
                            <th class="border p-3 text-sm font-bold">Autor</th>
                            <th class="border p-3 text-sm font-bold">Programa</th>
                            <th class="border p-3 text-sm font-bold">Estado</th>
                            <th class="border p-3 text-sm font-bold">Puntaje</th>
                        </tr>
                    </thead>
                    <tbody id="tabla-pendientes-lina">
                        <tr><td colspan="6" class="text-center py-8 text-gray-500">Cargando...</td></tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- MODAL EVALUACI√ìN (LINA) -->
    <div id="modal-evaluacion" class="hidden fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50 overflow-y-auto">
        <div class="bg-white rounded-2xl shadow-2xl max-w-6xl w-full my-8">
            <div class="sticky top-0 bg-blue-900 text-white p-6 rounded-t-2xl flex justify-between items-center z-10">
                <h2 class="text-2xl font-bold">üìù EVALUACI√ìN Y COMPILADO</h2>
                <button onclick="cerrarModal()" class="text-white hover:text-gray-200 text-3xl font-bold">√ó</button>
            </div>

            <div class="p-8 space-y-6 max-h-[calc(100vh-200px)] overflow-y-auto">
                <!-- Informaci√≥n de Jos√© -->
                <div class="bg-green-50 p-6 rounded-lg border-2 border-green-200">
                    <h3 class="font-bold text-green-900 mb-4 text-lg">üìã Informaci√≥n Original (Jos√©)</h3>
                    <div class="grid grid-cols-3 gap-4 text-sm">
                        <div><strong class="text-gray-700">Categor√≠a:</strong> <span id="info-categoria" class="text-gray-900"></span></div>
                        <div><strong class="text-gray-700">Fecha Recibido:</strong> <span id="info-fecha" class="text-gray-900"></span></div>
                        <div class="col-span-3"><strong class="text-gray-700">T√≠tulo:</strong> <span id="info-titulo" class="text-gray-900 font-semibold"></span></div>
                        <div><strong class="text-gray-700">Autor:</strong> <span id="info-autor" class="text-gray-900"></span></div>
                        <div class="col-span-2"><strong class="text-gray-700">Programa:</strong> <span id="info-programa" class="text-gray-900"></span></div>
                        <div class="col-span-3"><strong class="text-gray-700">Observaciones:</strong> <span id="info-obs-jose" class="text-gray-900"></span></div>
                        
                        <div id="campos-especificos-jose" class="col-span-3 grid grid-cols-3 gap-3">
                        </div>
                    </div>
                </div>

                <!-- Datos Completos del Docente -->
                <div class="bg-yellow-50 p-6 rounded-lg border-2 border-yellow-200">
                    <h3 class="font-bold text-yellow-900 mb-4 text-lg">üë§ Informaci√≥n Completa del Docente</h3>
                    <div class="mb-3">
                        <label class="block text-xs font-bold text-gray-700 mb-1">Docente</label>
                        <input type="text" id="buscar-docente-lina" list="lista-docentes-lina" 
                               class="w-full p-2 border-2 border-yellow-300 rounded bg-white" readonly>
                        <datalist id="lista-docentes-lina"></datalist>
                    </div>
                    <div class="grid grid-cols-3 gap-4 text-sm">
                        <div><strong class="text-gray-700">C√©dula:</strong> <span id="info-cedula" class="text-gray-900"></span></div>
                        <div class="col-span-2"><strong class="text-gray-700">Correo:</strong> <span id="info-correo" class="text-gray-900"></span></div>
                        <div><strong class="text-gray-700">Contacto:</strong> <span id="info-contacto" class="text-gray-900"></span></div>
                        <div><strong class="text-gray-700">Cargo:</strong> <span id="info-cargo" class="text-gray-900"></span></div>
                        <div><strong class="text-gray-700">Escolaridad:</strong> <span id="info-escolaridad" class="text-gray-900"></span></div>
                        <div><strong class="text-gray-700">Categor√≠a:</strong> <span id="info-categoria-doc" class="text-gray-900"></span></div>
                        <div><strong class="text-gray-700">Dedicaci√≥n:</strong> <span id="info-dedicacion" class="text-gray-900"></span></div>
                        <div class="col-span-2"><strong class="text-gray-700">Facultad:</strong> <span id="info-facultad" class="text-gray-900"></span></div>
                        <div><strong class="text-gray-700">Depto. Expedici√≥n:</strong> <span id="info-depto-expedicion" class="text-gray-900"></span></div>
                        <div class="col-span-2"><strong class="text-gray-700">Municipio Expedici√≥n:</strong> <span id="info-municipio-expedicion" class="text-gray-900"></span></div>
                    </div>
                </div>

                <!-- Evaluaci√≥n de Lina -->
                <div class="bg-blue-50 p-6 rounded-lg border-2 border-blue-200">
                    <h3 class="font-bold text-blue-900 mb-4 text-lg">‚≠ê Evaluaci√≥n CIARP</h3>
                    
                    <div class="mb-4">
                        <label class="block text-sm font-bold text-gray-700 mb-2">Estado CIARP</label>
                        <select id="edit-estado-ciarp" class="w-full p-3 border-2 border-blue-300 rounded-lg font-bold text-lg">
                            <option value="Pendiente">‚è≥ Pendiente</option>
                            <option value="Aprobado">‚úÖ Aprobado</option>
                            <option value="No Aprobado">‚ùå No Aprobado</option>
                        </select>
                    </div>

                    <div class="grid grid-cols-4 gap-4 mb-4">
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-2">Puntaje Eval 1</label>
                            <input type="number" step="0.1" id="edit-puntaje-eval1" class="w-full p-3 border-2 border-blue-300 rounded-lg text-center font-bold text-lg">
                        </div>
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-2">Puntaje Eval 2</label>
                            <input type="number" step="0.1" id="edit-puntaje-eval2" class="w-full p-3 border-2 border-blue-300 rounded-lg text-center font-bold text-lg">
                        </div>
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-2">Puntaje Final</label>
                            <input type="number" step="0.1" id="edit-puntaje-final" class="w-full p-3 border-2 border-green-500 bg-green-50 rounded-lg text-center font-bold text-xl text-green-700">
                        </div>
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-2">Acta CIARP</label>
                            <input type="text" id="edit-acta" class="w-full p-3 border-2 border-blue-300 rounded-lg">
                        </div>
                    </div>

                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-2">Resoluci√≥n</label>
                            <input type="text" id="edit-resolucion" placeholder="R.R. No..." class="w-full p-3 border-2 border-blue-300 rounded-lg">
                        </div>
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-2">Observaciones T√©cnicas</label>
                            <textarea id="edit-observaciones-lina" rows="3" class="w-full p-3 border-2 border-blue-300 rounded-lg"></textarea>
                        </div>
                    </div>
                </div>

                <button id="btn-guardar-lina" onclick="guardarEvaluacion()" 
                        class="w-full bg-blue-900 text-white py-4 rounded-xl font-bold hover:bg-blue-950 transition text-lg shadow-lg">
                    üíæ GUARDAR EVALUACI√ìN
                </button>
            </div>
        </div>
    </div>

</body>
</html>



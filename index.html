<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema Productividad UQ 2024 - FINAL</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>
    
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-app.js";
        import { getFirestore, collection, addDoc, getDocs, updateDoc, doc, query, orderBy, getDoc } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-firestore.js";
        import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-auth.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBbqMf8ZOmqmbGTmr2tr8nziyUWKSE6OWg",
            authDomain: "uniquindio-produccion.firebaseapp.com",
            projectId: "uniquindio-produccion",
            storageBucket: "uniquindio-produccion.firebasestorage.app",
            messagingSenderId: "440871309124",
            appId: "1:440871309124:web:108be1894adaf6ecaf1111"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);
        
        const urlAppsScript = "https://script.google.com/macros/s/AKfycbyzdWZei_53a_ncBCnuXKgaHx3zC80CSzZ3uy9aosyDJXcIQRT-MY0xXXcQxQFRlivT3Q/exec";

        let rolActual = '';
        let idRegistroActual = null;

        let baseDocentes = []; // ‚úÖ BASE DE DATOS DE DOCENTES

        // ==================== CARGAR DOCENTES AL INICIAR ====================
        async function cargarBaseDocentes() {
            try {
                console.log('üîÑ Cargando base de docentes...');
                
                fetch(urlAppsScript + '?action=obtenerDocentes')
                    .then(response => response.json())
                    .then(data => {
                        if (data && Array.isArray(data)) {
                            cargarDatalistDocentes(data);
                        }
                    })
                    .catch(error => {
                        console.error('‚ùå Error al cargar docentes:', error);
                    });
                    
            } catch (error) {
                console.error('‚ùå Error al cargar base de docentes:', error);
            }
        }

        function cargarDatalistDocentes(docentes) {
            if (!docentes || docentes.length === 0) {
                console.log('‚ö†Ô∏è No se encontraron docentes en la base de datos');
                return;
            }
            
            baseDocentes = docentes;
            const datalist = document.getElementById('lista-docentes');
            
            if (!datalist) {
                console.error('‚ùå Elemento lista-docentes no encontrado');
                return;
            }
            
            datalist.innerHTML = '';
            
            docentes.forEach(doc => {
                const option = document.createElement('option');
                option.value = doc.nombre;
                datalist.appendChild(option);
            });
            
            // ‚úÖ NUEVO: Tambi√©n cargar para el datalist de Jos√©
            const datalistJose = document.getElementById('lista-docentes-jose');
            if (datalistJose) {
                datalistJose.innerHTML = '';
                docentes.forEach(doc => {
                    const option = document.createElement('option');
                    option.value = doc.nombre;
                    datalistJose.appendChild(option);
                });
            }
            
            console.log(`‚úÖ ${docentes.length} docentes cargados en el autocompletador`);
        }

        // ==================== AUTOCOMPLETAR DATOS DEL DOCENTE PARA LINA ====================
        function autocompletarDocenteLina() {
            const input = document.getElementById('buscar-docente');
            const nombreSeleccionado = input.value.trim();
            
            if (!nombreSeleccionado) return;
            
            const docente = baseDocentes.find(d => d.nombre === nombreSeleccionado);
            
            if (docente) {
                // Campos de solo lectura (amarillos)
                document.getElementById('edit-documento').value = docente.cedula || '';
                
                const correoField = document.getElementById('edit-correo');
                if (correoField) {
                    correoField.value = docente.correo || '';
                }
                
                // ‚úÖ NUEVO: Llenar tambi√©n los campos editables (azules) con los datos del docente
                const programaField = document.getElementById('edit-programa');
                if (programaField) {
                    programaField.value = docente.dependencia || '';
                }
                
                const escolaridadField = document.getElementById('edit-escolaridad');
                if (escolaridadField) {
                    escolaridadField.value = docente.escolaridad || '';
                }
                
                const categoriaField = document.getElementById('edit-categoria-doc');
                if (categoriaField) {
                    categoriaField.value = docente.categoria || '';
                }
                
                const dedicacionField = document.getElementById('edit-dedicacion');
                if (dedicacionField) {
                    dedicacionField.value = docente.dedicacion || '';
                }
                
                const facultadField = document.getElementById('edit-facultad');
                if (facultadField) {
                    facultadField.value = docente.facultad || '';
                }
                
                // Animaci√≥n visual para campos de solo lectura
                ['edit-documento', 'edit-correo'].forEach(id => {
                    const elem = document.getElementById(id);
                    if (elem) {
                        elem.classList.remove('bg-yellow-50');
                        elem.classList.add('bg-green-100', 'border-green-500');
                        setTimeout(() => {
                            elem.classList.remove('bg-green-100', 'border-green-500');
                            elem.classList.add('bg-yellow-50');
                        }, 2000);
                    }
                });
                
                // Animaci√≥n visual para campos editables
                ['edit-programa', 'edit-escolaridad', 'edit-categoria-doc', 'edit-dedicacion', 'edit-facultad'].forEach(id => {
                    const elem = document.getElementById(id);
                    if (elem && elem.value) {
                        elem.classList.add('bg-green-100', 'border-green-500');
                        setTimeout(() => {
                            elem.classList.remove('bg-green-100', 'border-green-500');
                        }, 2000);
                    }
                });
                
                console.log('‚úÖ Datos del docente autocompletados:', docente.nombre);
            } else {
                console.log('‚ö†Ô∏è Docente no encontrado en la base de datos:', nombreSeleccionado);
            }
        }

        // ==================== AUTOCOMPLETAR DATOS DEL DOCENTE PARA JOS√â ====================
        function autocompletarDocenteJose() {
            const input = document.getElementById('autor');
            const nombreSeleccionado = input.value.trim();
            
            if (!nombreSeleccionado) return;
            
            const docente = baseDocentes.find(d => d.nombre === nombreSeleccionado);
            
            if (docente) {
                console.log('‚úÖ Docente encontrado:', docente.nombre);
                console.log('üìã Datos completos:', docente);
                
                // Mostrar notificaci√≥n visual en el nombre
                input.classList.remove('border-gray-300');
                input.classList.add('border-green-500', 'bg-green-50');
                setTimeout(() => {
                    input.classList.remove('border-green-500', 'bg-green-50');
                    input.classList.add('border-gray-300');
                }, 2000);
                
                // ‚úÖ LLENAR PROGRAMA (usando dependencia o facultad)
                const programaInput = document.getElementById('programa');
                if (programaInput) {
                    // Priorizar dependencia directa, si no hay, usar facultad
                    const programaValue = docente.dependencia || docente.facultad || '';
                    if (programaValue) {
                        programaInput.value = programaValue;
                        programaInput.classList.remove('border-gray-300');
                        programaInput.classList.add('border-green-500', 'bg-green-50');
                        setTimeout(() => {
                            programaInput.classList.remove('border-green-500', 'bg-green-50');
                            programaInput.classList.add('border-gray-300');
                        }, 2000);
                    }
                }
                
                // ‚úÖ GUARDAR DATOS DEL DOCENTE EN EL FORMULARIO (para que Lina los vea despu√©s)
                // Estos datos se enviar√°n junto con la solicitud
                if (!window.datosDocenteSeleccionado) {
                    window.datosDocenteSeleccionado = {};
                }
                
                window.datosDocenteSeleccionado = {
                    nombre: docente.nombre,
                    cedula: docente.cedula,
                    dependencia: docente.dependencia,
                    facultad: docente.facultad,
                    escolaridad: docente.escolaridad,
                    dedicacion: docente.dedicacion,
                    categoria: docente.categoria,
                    correo: docente.correo,
                    contacto: docente.contacto,
                    cargo: docente.cargo || '',                           // ‚úÖ NUEVO
                    deptoExpedicion: docente.deptoExpedicion || '',       // ‚úÖ NUEVO
                    municipioExpedicion: docente.municipioExpedicion || '' // ‚úÖ NUEVO
                };
                
                // Mostrar mensaje de confirmaci√≥n
                mostrarNotificacion('‚úÖ Docente validado: ' + docente.nombre);
                
            } else {
                console.log('‚ö†Ô∏è Docente no encontrado en la base de datos:', nombreSeleccionado);
                window.datosDocenteSeleccionado = null;
                mostrarNotificacion('‚ö†Ô∏è Docente no encontrado en la base de datos', 'warning');
            }
        }
        
        // Funci√≥n auxiliar para mostrar notificaciones
        function mostrarNotificacion(mensaje, tipo = 'success') {
            const div = document.createElement('div');
            div.className = `fixed top-4 right-4 px-6 py-3 rounded-lg shadow-lg text-white font-bold z-50 ${
                tipo === 'success' ? 'bg-green-600' : 'bg-yellow-600'
            }`;
            div.textContent = mensaje;
            document.body.appendChild(div);
            setTimeout(() => div.remove(), 3000);
        }

        const CONTRASE√ëAS = {
            'JOSE': 'jose2026',
            'LINA': 'lina2026'
        };

        // ==================== LOGIN ====================
        window.intentarLogin = (rol) => {
            const password = document.getElementById(`password-${rol.toLowerCase()}`).value;
            
            if (!password) {
                alert("‚ö†Ô∏è Ingrese la contrase√±a");
                return;
            }
            
            if (password === CONTRASE√ëAS[rol]) {
                iniciarSesion(rol);
            } else {
                alert("‚ùå Contrase√±a incorrecta");
                document.getElementById(`password-${rol.toLowerCase()}`).value = '';
            }
        };

        function iniciarSesion(rol) {
            rolActual = rol;
            document.getElementById('pantalla-login').classList.add('hidden');
            
            if (rol === 'JOSE') {
                document.getElementById('panel-jose').classList.remove('hidden');
                document.getElementById('header-title').innerText = "SEGUIMIENTO DE SOLICITUDES (JOS√â)";
                document.getElementById('header-bg').classList.add('bg-[#003d2b]');
                cambiarCategoria();
                
                // ‚úÖ NUEVO: Cargar base de docentes al iniciar sesi√≥n de Jos√© tambi√©n
                cargarBaseDocentes();
                
                // ‚úÖ NUEVO: Event listener para autocompletado de Jos√©
                setTimeout(() => {
                    const autorInput = document.getElementById('autor');
                    if (autorInput) {
                        autorInput.addEventListener('change', autocompletarDocenteJose);
                        autorInput.addEventListener('blur', autocompletarDocenteJose);
                    }
                }, 500);
            } else {
                document.getElementById('panel-lina').classList.remove('hidden');
                document.getElementById('header-title').innerText = "COMPILADO Y LIQUIDACI√ìN (LINA)";
                document.getElementById('header-bg').classList.add('bg-blue-900');
                cargarPendientesLina();
                
                // ‚úÖ NUEVO: Cargar base de docentes al iniciar sesi√≥n de Lina
                cargarBaseDocentes();
                
                // ‚úÖ NUEVO: Event listeners para el autocompletado de Lina
                setTimeout(() => {
                    const buscadorDocente = document.getElementById('buscar-docente');
                    if (buscadorDocente) {
                        buscadorDocente.addEventListener('change', autocompletarDocenteLina);
                        buscadorDocente.addEventListener('blur', autocompletarDocenteLina);
                    }
                }, 500);
            }
        }

        // ==================== JOS√â - SOLO SEGUIMIENTO ====================
        window.cambiarCategoria = () => {
            const cat = document.getElementById('categoria').value;
            const container = document.getElementById('campos-jose-especificos');
            const inputClass = "w-full p-2 border border-gray-300 rounded focus:border-green-600 outline-none";
            const labelClass = "block text-xs font-bold text-gray-500 uppercase mb-1";
            let html = '';

            // ‚úÖ ELIMINADO: "T√≠tulo del Producto" - ahora cada categor√≠a pide directamente su t√≠tulo espec√≠fico
            
            if (cat === "Art√≠culos Indexados" || cat === "Art√≠culos No Indexados") {
                html = `<div class="grid grid-cols-2 gap-4">
                    <div><label class="${labelClass}">Nombre del Art√≠culo</label><input type="text" id="nombre_articulo" class="${inputClass}"></div>
                    <div><label class="${labelClass}">T√≠tulo de la Revista</label><input type="text" id="titulo_revista" class="${inputClass}"></div>
                </div>`;
            
            } else if (cat === "Libro Investigaci√≥n" || cat === "Libro Texto" || cat === "Libro Ensayo") {
                html = `<div class="grid grid-cols-2 gap-4">
                    <div><label class="${labelClass}">T√≠tulo del Libro</label><input type="text" id="titulo_libro" class="${inputClass}"></div>
                    <div><label class="${labelClass}">√Årea de Conocimiento</label><input type="text" id="area_conocimiento" class="${inputClass}"></div>
                </div>`;
            
            } else if (cat === "Premio") {
                html = `<div class="grid grid-cols-2 gap-4">
                    <div><label class="${labelClass}">T√≠tulo del Trabajo Premiado</label><input type="text" id="titulo_trabajo_premiado" class="${inputClass}"></div>
                    <div><label class="${labelClass}">Premio Otorgado</label><input type="text" id="premio_otorgado" class="${inputClass}"></div>
                    <div class="col-span-2"><label class="${labelClass}">Fecha del Premio</label><input type="date" id="fecha_premio" class="${inputClass}"></div>
                </div>`;
            
            } else if (cat === "Software") {
                html = `<div class="grid grid-cols-2 gap-4">
                    <div><label class="${labelClass}">T√≠tulo del Software</label><input type="text" id="titulo_software" class="${inputClass}"></div>
                    <div><label class="${labelClass}">Concepto Comit√© T√©cnico</label>
                        <select id="concepto_comite" class="${inputClass}">
                            <option value="">Pendiente</option>
                            <option value="SI">SI - Aprobado</option>
                            <option value="NO">NO - Rechazado</option>
                        </select>
                    </div>
                </div>`;
            
            } else if (cat === "Patente") {
                html = `<div><label class="${labelClass}">T√≠tulo de la Patente</label><input type="text" id="titulo_patente" class="${inputClass}"></div>`;
            
            } else if (cat === "Obra Art√≠stica" || cat === "Producci√≥n Audiovisual") {
                html = `<div class="grid grid-cols-2 gap-4">
                    <div><label class="${labelClass}">T√≠tulo de la Obra</label><input type="text" id="titulo_obra" class="${inputClass}"></div>
                    <div><label class="${labelClass}">Soportes Verificados</label>
                        <select id="soportes_ok" class="${inputClass}">
                            <option value="">Pendiente</option>
                            <option value="OK">OK - Verificado</option>
                            <option value="INCOMPLETO">Incompleto</option>
                        </select>
                    </div>
                </div>`;
            
            } else if (cat === "Ponencias") {
                html = `<div><label class="${labelClass}">T√≠tulo de la Ponencia</label><input type="text" id="titulo_ponencia" class="${inputClass}"></div>`;
            
            } else if (cat === "Tesis") {
                html = `<div class="grid grid-cols-2 gap-4">
                    <div><label class="${labelClass}">T√≠tulo de la Tesis</label><input type="text" id="titulo_tesis" class="${inputClass}"></div>
                    <div><label class="${labelClass}">Nombre del Estudiante</label><input type="text" id="autor_estudiante" class="${inputClass}"></div>
                </div>`;
            
            } else if (cat === "T√≠tulos") {
                html = `<div class="grid grid-cols-2 gap-4">
                    <div><label class="${labelClass}">T√≠tulo Obtenido</label><input type="text" id="titulo_obtenido" class="${inputClass}"></div>
                    <div><label class="${labelClass}">Universidad que Otorga</label><input type="text" id="universidad_otorga" class="${inputClass}"></div>
                </div>`;
            
            } else if (cat === "Ascensos") {
                html = `<div class="grid grid-cols-3 gap-4">
                    <div><label class="${labelClass}">Tipo de Trabajo</label><input type="text" id="tipo_trabajo" class="${inputClass}"></div>
                    <div><label class="${labelClass}">Categor√≠a Actual</label><input type="text" id="categoria_actual" class="${inputClass}"></div>
                    <div><label class="${labelClass}">Categor√≠a Solicitada</label><input type="text" id="categoria_solicitada" class="${inputClass}"></div>
                </div>`;
            }

            container.innerHTML = html;
        };

        window.enviarSolicitud = async () => {
            const categoria = document.getElementById('categoria').value;
            const anio = document.getElementById('anio').value;
            const semestre = document.getElementById('semestre').value;
            const fechaRecibido = document.getElementById('fecha-recibido').value;
            const autor = document.getElementById('autor').value;
            const programa = document.getElementById('programa').value;
            const docCompleta = document.getElementById('doc-completa').value;
            const estadoCiarp = document.getElementById('estado-ciarp').value;
            const observaciones = document.getElementById('observaciones-jose').value;

            if (!categoria || !anio || !semestre || !fechaRecibido || !autor) {
                alert("‚ö†Ô∏è Complete los campos obligatorios");
                return;
            }

            // ‚úÖ Obtener el t√≠tulo seg√∫n la categor√≠a (sin duplicar "T√≠tulo del Producto")
            let tituloProducto = '';
            if (categoria.includes("Art√≠culos")) {
                tituloProducto = document.getElementById('nombre_articulo')?.value || '';
            } else if (categoria.includes("Libro")) {
                tituloProducto = document.getElementById('titulo_libro')?.value || '';
            } else if (categoria === "Premio") {
                tituloProducto = document.getElementById('titulo_trabajo_premiado')?.value || '';
            } else if (categoria === "Software") {
                tituloProducto = document.getElementById('titulo_software')?.value || '';
            } else if (categoria === "Patente") {
                tituloProducto = document.getElementById('titulo_patente')?.value || '';
            } else if (categoria === "Obra Art√≠stica" || categoria === "Producci√≥n Audiovisual") {
                tituloProducto = document.getElementById('titulo_obra')?.value || '';
            } else if (categoria === "Ponencias") {
                tituloProducto = document.getElementById('titulo_ponencia')?.value || '';
            } else if (categoria === "Tesis") {
                tituloProducto = document.getElementById('titulo_tesis')?.value || '';
            } else if (categoria === "T√≠tulos") {
                tituloProducto = document.getElementById('titulo_obtenido')?.value || '';
            } else if (categoria === "Ascensos") {
                tituloProducto = document.getElementById('tipo_trabajo')?.value || '';
            }

            if (!tituloProducto) {
                alert("‚ö†Ô∏è Complete el t√≠tulo del producto");
                return;
            }

            const btnEnviar = document.getElementById('btn-enviar-jose');
            btnEnviar.disabled = true;
            btnEnviar.innerText = "‚è≥ ENVIANDO...";

            try {
                await signInAnonymously(auth);

                const data = {
                    tipo_registro: "JOSE",
                    timestamp: new Date().toISOString(),
                    categoria,
                    anio,
                    semestre,
                    fecha_recibido: fechaRecibido,
                    titulo_producto: tituloProducto,
                    autor,
                    programa,
                    doc_completa: docCompleta,
                    estado_ciarp: estadoCiarp,
                    observaciones_jose: observaciones
                };
                
                // ‚úÖ INCLUIR DATOS DEL DOCENTE SI FUERON SELECCIONADOS
                if (window.datosDocenteSeleccionado) {
                    data.docente_cedula = window.datosDocenteSeleccionado.cedula || '';
                    data.docente_dependencia = window.datosDocenteSeleccionado.dependencia || '';
                    data.docente_facultad = window.datosDocenteSeleccionado.facultad || '';
                    data.docente_escolaridad = window.datosDocenteSeleccionado.escolaridad || '';
                    data.docente_dedicacion = window.datosDocenteSeleccionado.dedicacion || '';
                    data.docente_categoria = window.datosDocenteSeleccionado.categoria || '';
                    data.docente_correo = window.datosDocenteSeleccionado.correo || '';
                    data.docente_contacto = window.datosDocenteSeleccionado.contacto || '';
                    data.docente_cargo = window.datosDocenteSeleccionado.cargo || '';                      // ‚úÖ NUEVO
                    data.docente_deptoExpedicion = window.datosDocenteSeleccionado.deptoExpedicion || '';  // ‚úÖ NUEVO
                    data.docente_municipioExpedicion = window.datosDocenteSeleccionado.municipioExpedicion || ''; // ‚úÖ NUEVO
                    console.log('‚úÖ Datos del docente incluidos en la solicitud');
                }

                // Campos espec√≠ficos seg√∫n categor√≠a
                if (categoria.includes("Art√≠culos")) {
                    data.nombre_articulo = document.getElementById('nombre_articulo')?.value || '';
                    data.titulo_revista = document.getElementById('titulo_revista')?.value || '';
                } else if (categoria.includes("Libro")) {
                    data.titulo_libro = tituloProducto;
                    data.area_conocimiento = document.getElementById('area_conocimiento')?.value || '';
                } else if (categoria === "Premio") {
                    data.titulo_trabajo_premiado = tituloProducto;
                    data.premio_otorgado = document.getElementById('premio_otorgado')?.value || '';
                    data.fecha_premio = document.getElementById('fecha_premio')?.value || '';
                } else if (categoria === "Software") {
                    data.titulo_software = tituloProducto;
                    data.concepto_comite = document.getElementById('concepto_comite')?.value || '';
                } else if (categoria === "Patente") {
                    data.titulo_patente = tituloProducto;
                } else if (categoria === "Obra Art√≠stica" || categoria === "Producci√≥n Audiovisual") {
                    data.titulo_obra = tituloProducto;
                    data.soportes_ok = document.getElementById('soportes_ok')?.value || '';
                } else if (categoria === "Ponencias") {
                    data.titulo_ponencia = tituloProducto;
                } else if (categoria === "Tesis") {
                    data.titulo_tesis = tituloProducto;
                    data.autor_estudiante = document.getElementById('autor_estudiante')?.value || '';
                } else if (categoria === "T√≠tulos") {
                    data.titulo_obtenido = tituloProducto;
                    data.universidad_otorga = document.getElementById('universidad_otorga')?.value || '';
                } else if (categoria === "Ascensos") {
                    data.tipo_trabajo = tituloProducto;
                    data.categoria_actual = document.getElementById('categoria_actual')?.value || '';
                    data.categoria_solicitada = document.getElementById('categoria_solicitada')?.value || '';
                }

                // Guardar en Firebase
                const docRef = await addDoc(collection(db, "solicitudes"), data);
                console.log("‚úÖ Firebase ID:", docRef.id);

                // Enviar a Google Sheets
                const response = await fetch(urlAppsScript, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });

                alert("‚úÖ Solicitud enviada correctamente");
                limpiarFormularioJose();
                
            } catch (error) {
                console.error("‚ùå Error:", error);
                alert("‚ùå Error al enviar: " + error.message);
            } finally {
                btnEnviar.disabled = false;
                btnEnviar.innerText = "‚úÖ ENVIAR SOLICITUD";
            }
        };

        function limpiarFormularioJose() {
            document.getElementById('form-jose').reset();
            document.getElementById('campos-jose-especificos').innerHTML = '';
        }

        // ==================== LINA - COMPILADO Y LIQUIDACI√ìN ====================
        window.cargarPendientesLina = async () => {
            try {
                await signInAnonymously(auth);
                const q = query(collection(db, "solicitudes"), orderBy("timestamp", "desc"));
                const querySnapshot = await getDocs(q);

                const tbody = document.getElementById('tabla-pendientes-lina');
                tbody.innerHTML = '';

                querySnapshot.forEach((doc) => {
                    const data = doc.data();
                    const estadoColor = data.estado_ciarp === 'Aprobado' ? 'bg-green-100 text-green-800' : 
                                       data.estado_ciarp === 'No Aprobado' ? 'bg-red-100 text-red-800' : 
                                       'bg-yellow-100 text-yellow-800';
                    
                    const row = `<tr class="hover:bg-blue-50 cursor-pointer" onclick="abrirEvaluacion('${doc.id}')">
                        <td class="border px-2 py-2 text-xs">${data.categoria || ''}</td>
                        <td class="border px-2 py-2 text-xs font-semibold">${data.titulo_producto || ''}</td>
                        <td class="border px-2 py-2 text-xs">${data.autor || ''}</td>
                        <td class="border px-2 py-2 text-xs">${data.programa || ''}</td>
                        <td class="border px-2 py-2 text-center">
                            <span class="px-2 py-1 rounded text-xs font-bold ${estadoColor}">
                                ${data.estado_ciarp || 'Pendiente'}
                            </span>
                        </td>
                        <td class="border px-2 py-2 text-center text-xs">${data.puntaje_asignado || 0}</td>
                    </tr>`;
                    tbody.innerHTML += row;
                });

            } catch (error) {
                console.error("‚ùå Error al cargar pendientes:", error);
            }
        };

        window.abrirEvaluacion = async (id) => {
            idRegistroActual = id;
            
            try {
                const docRef = doc(db, "solicitudes", id);
                const docSnap = await getDoc(docRef);

                if (!docSnap.exists()) {
                    alert("‚ùå Registro no encontrado");
                    return;
                }

                const data = docSnap.data();
                
                // Mostrar modal
                document.getElementById('modal-evaluacion').classList.remove('hidden');
                
                // ===== DATOS DE JOS√â (solo lectura) =====
                document.getElementById('info-categoria').innerText = data.categoria || '';
                document.getElementById('info-fecha').innerText = data.fecha_recibido || '';
                document.getElementById('info-doc').innerText = data.doc_completa || '';
                document.getElementById('info-titulo').innerText = data.titulo_producto || '';
                document.getElementById('info-autor').innerText = data.autor || '';
                document.getElementById('info-programa').innerText = data.programa || '';
                document.getElementById('info-estado-jose').innerText = data.estado_ciarp || 'Pendiente';
                document.getElementById('info-obs-jose').innerText = data.observaciones_jose || 'Sin observaciones';
                
                // ‚úÖ PRELLENAR EL BUSCADOR CON EL NOMBRE DEL AUTOR QUE JOS√â INGRES√ì
                const buscadorDocente = document.getElementById('buscar-docente');
                if (buscadorDocente && data.autor) {
                    buscadorDocente.value = data.autor;
                    // Simular autocompletado autom√°tico
                    autocompletarDocenteLina();
                }

                // Mostrar campos espec√≠ficos de Jos√©
                let camposJoseHtml = '';
                if (data.categoria?.includes("Art√≠culos")) {
                    camposJoseHtml = `
                        <div><strong>Nombre Art√≠culo:</strong> ${data.nombre_articulo || ''}</div>
                        <div><strong>Revista:</strong> ${data.titulo_revista || ''}</div>
                    `;
                } else if (data.categoria?.includes("Libro")) {
                    camposJoseHtml = `
                        <div><strong>T√≠tulo Libro:</strong> ${data.titulo_libro || ''}</div>
                        <div><strong>√Årea:</strong> ${data.area_conocimiento || ''}</div>
                    `;
                } else if (data.categoria === "Software") {
                    camposJoseHtml = `
                        <div><strong>T√≠tulo Software:</strong> ${data.titulo_software || ''}</div>
                        <div><strong>Concepto Comit√©:</strong> ${data.concepto_comite || 'Pendiente'}</div>
                    `;
                }
                document.getElementById('campos-jose-readonly').innerHTML = camposJoseHtml;

                // ===== DATOS DE LINA (editables) =====
                // ‚úÖ USAR DATOS DEL DOCENTE SI JOS√â LOS PRELLEN√ì
                document.getElementById('edit-documento').value = data.docente_cedula || data.documento_id || '';
                document.getElementById('edit-programa').value = data.docente_dependencia || data.programa || '';
                document.getElementById('edit-escolaridad').value = data.docente_escolaridad || data.escolaridad || '';
                document.getElementById('edit-categoria-doc').value = data.docente_categoria || data.categoria_docente || '';
                document.getElementById('edit-dedicacion').value = data.docente_dedicacion || data.dedicacion || '';
                document.getElementById('edit-facultad').value = data.docente_facultad || data.facultad || '';
                
                // ‚úÖ NUEVO: Llenar tambi√©n el correo si est√° disponible
                const correoField = document.getElementById('edit-correo');
                if (correoField) {
                    correoField.value = data.docente_correo || '';
                }
                
                // Mostrar indicador visual si los datos vienen de Jos√©
                if (data.docente_cedula || data.docente_correo) {
                    console.log('‚úÖ Datos del docente prellenados por Jos√©');
                    ['edit-documento', 'edit-correo', 'edit-programa', 'edit-escolaridad', 'edit-categoria-doc', 'edit-dedicacion', 'edit-facultad'].forEach(id => {
                        const elem = document.getElementById(id);
                        if (elem && elem.value) {
                            elem.classList.add('bg-green-50', 'border-green-400');
                        }
                    });
                }
                
                // ‚úÖ ESTADO EDITABLE POR LINA
                document.getElementById('edit-estado-ciarp').value = data.estado_ciarp || 'Pendiente';
                
                // ‚úÖ SOLO 2 EVALUACIONES + PUNTAJE FINAL (sin promedio autom√°tico)
                document.getElementById('edit-puntaje-eval1').value = data.puntaje_eval1 || '';
                document.getElementById('edit-puntaje-eval2').value = data.puntaje_eval2 || '';
                document.getElementById('edit-puntaje-asignado').value = data.puntaje_asignado || '';
                
                document.getElementById('edit-acta').value = data.acta_ciarp || '';
                document.getElementById('edit-resolucion').value = data.resolucion || '';
                document.getElementById('edit-obs-lina').value = data.observaciones_lina || '';

                // Campos espec√≠ficos de Lina seg√∫n categor√≠a
                cargarCamposLinaEspecificos(data);

            } catch (error) {
                console.error("‚ùå Error:", error);
                alert("‚ùå Error al cargar datos");
            }
        };

        function cargarCamposLinaEspecificos(data) {
            const container = document.getElementById('campos-lina-especificos');
            const inputClass = "w-full border-2 border-blue-300 p-2 rounded text-sm";
            const labelClass = "block text-xs font-bold text-gray-600 mb-1";
            let html = '';

            if (data.categoria === "Art√≠culos Indexados") {
                html = `
                    <div class="grid grid-cols-3 gap-4">
                        <div><label class="${labelClass}">MODALIDAD</label>
                            <select id="edit-modalidad" class="${inputClass}">
                                <option value="">Seleccionar</option>
                                <option ${data.modalidad === 'Investigaci√≥n' ? 'selected' : ''}>Investigaci√≥n</option>
                                <option ${data.modalidad === 'Reflexi√≥n' ? 'selected' : ''}>Reflexi√≥n</option>
                            </select>
                        </div>
                        <div><label class="${labelClass}">TIPO</label>
                            <select id="edit-tipo" class="${inputClass}">
                                <option value="">Seleccionar</option>
                                <option ${data.tipo === 'Completo' ? 'selected' : ''}>Completo</option>
                                <option ${data.tipo === 'Corto' ? 'selected' : ''}>Corto</option>
                            </select>
                        </div>
                        <div><label class="${labelClass}">PA√çS</label><input type="text" id="edit-pais" value="${data.pais || ''}" class="${inputClass}"></div>
                        <div><label class="${labelClass}">ISSN</label><input type="text" id="edit-issn" value="${data.issn || ''}" class="${inputClass}"></div>
                        <div><label class="${labelClass}">CLASIFICACI√ìN PUBLINDEX</label>
                            <select id="edit-clasificacion" class="${inputClass}">
                                <option value="">Seleccionar</option>
                                <option ${data.clasificacion_publindex === 'A1' ? 'selected' : ''}>A1</option>
                                <option ${data.clasificacion_publindex === 'A2' ? 'selected' : ''}>A2</option>
                                <option ${data.clasificacion_publindex === 'B' ? 'selected' : ''}>B</option>
                                <option ${data.clasificacion_publindex === 'C' ? 'selected' : ''}>C</option>
                            </select>
                        </div>
                        <div><label class="${labelClass}">EDITORIAL</label><input type="text" id="edit-editorial" value="${data.editorial || ''}" class="${inputClass}"></div>
                        <div><label class="${labelClass}">A√ëO PUBLICACI√ìN</label><input type="number" id="edit-anio-pub" value="${data.anio_publicacion || ''}" class="${inputClass}"></div>
                        <div><label class="${labelClass}">N√öM. AUTORES</label><input type="number" id="edit-num-autores" value="${data.num_autores || ''}" class="${inputClass}"></div>
                        <div class="col-span-3"><label class="${labelClass}">UNIVERSIDADES COAUTORES</label>
                            <textarea id="edit-universidades" rows="2" class="${inputClass}">${data.universidades_coautores || ''}</textarea>
                        </div>
                    </div>
                `;
            } else if (data.categoria === "Art√≠culos No Indexados") {
                html = `
                    <div><label class="${labelClass}">ISSN</label><input type="text" id="edit-issn" value="${data.issn || ''}" class="${inputClass}"></div>
                `;
            } else if (data.categoria?.includes("Libro")) {
                html = `
                    <div class="grid grid-cols-3 gap-4">
                        <div><label class="${labelClass}">ISBN</label><input type="text" id="edit-isbn" value="${data.isbn || ''}" class="${inputClass}"></div>
                        <div><label class="${labelClass}">A√ëO PUBLICACI√ìN</label><input type="number" id="edit-anio-pub" value="${data.anio_publicacion || ''}" class="${inputClass}"></div>
                        <div><label class="${labelClass}">EDITORIAL</label><input type="text" id="edit-editorial" value="${data.editorial || ''}" class="${inputClass}"></div>
                    </div>
                `;
            }

            container.innerHTML = html;
        }

        // ‚úÖ EVENTO: Actualizar en tiempo real cuando se cambia el puntaje
        document.addEventListener('DOMContentLoaded', () => {
            const puntajeFields = ['edit-puntaje-eval1', 'edit-puntaje-eval2', 'edit-puntaje-asignado'];
            
            puntajeFields.forEach(fieldId => {
                const field = document.getElementById(fieldId);
                if (field) {
                    field.addEventListener('change', async () => {
                        await guardarPuntajeAutomatico();
                    });
                }
            });
            
            // ‚úÖ NUEVO: Autocompletar al cambiar el nombre del docente (Jos√©)
            const autorInput = document.getElementById('autor');
            if (autorInput) {
                autorInput.addEventListener('change', autocompletarDocenteJose);
                autorInput.addEventListener('blur', autocompletarDocenteJose);
            }
            
            // ‚úÖ CARGAR BASE DE DOCENTES AL INICIAR
            cargarBaseDocentes();
        });

        async function guardarPuntajeAutomatico() {
            if (!idRegistroActual) return;

            try {
                const puntaje1 = parseFloat(document.getElementById('edit-puntaje-eval1').value) || 0;
                const puntaje2 = parseFloat(document.getElementById('edit-puntaje-eval2').value) || 0;
                const puntajeFinal = parseFloat(document.getElementById('edit-puntaje-asignado').value) || 0;

                const docRef = doc(db, "solicitudes", idRegistroActual);
                await updateDoc(docRef, {
                    puntaje_eval1: puntaje1,
                    puntaje_eval2: puntaje2,
                    puntaje_asignado: puntajeFinal,
                    timestamp_lina: new Date().toISOString()
                });

                // ‚úÖ ACTUALIZAR GOOGLE DRIVE INMEDIATAMENTE
                const docSnap = await getDoc(docRef);
                const dataCompleta = docSnap.data();
                
                await fetch(urlAppsScript, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        ...dataCompleta,
                        tipo_registro: "LINA"
                    })
                });

                console.log("‚úÖ Puntajes actualizados autom√°ticamente en Firebase y Drive");
                
            } catch (error) {
                console.error("‚ùå Error al actualizar puntaje:", error);
            }
        }


        window.guardarEvaluacion = async () => {
            if (!idRegistroActual) {
                alert("‚ùå No hay registro seleccionado");
                return;
            }

            const btnGuardar = document.getElementById('btn-guardar-lina');
            btnGuardar.disabled = true;
            btnGuardar.innerHTML = '<span>‚è≥</span> GUARDANDO...';

            try {
                // ‚úÖ PRIMERO: Obtener TODOS los datos originales de Firebase
                const docRef = doc(db, "solicitudes", idRegistroActual);
                const docSnap = await getDoc(docRef);
                const datosOriginales = docSnap.data();

                // ‚úÖ SEGUNDO: Crear objeto con TODOS los datos (originales + actualizados)
                const dataCompleta = {
                    // Mantener TODOS los datos de Jos√©
                    ...datosOriginales,
                    
                    // Sobrescribir con los datos de Lina
                    tipo_registro: "LINA",
                    timestamp_lina: new Date().toISOString(),
                    
                    // Datos del docente
                    documento_id: document.getElementById('edit-documento').value,
                    escolaridad: document.getElementById('edit-escolaridad').value,
                    categoria_docente: document.getElementById('edit-categoria-doc').value,
                    dedicacion: document.getElementById('edit-dedicacion').value,
                    facultad: document.getElementById('edit-facultad').value,
                    programa: document.getElementById('edit-programa').value,
                    
                    // Estado editable
                    estado_ciarp: document.getElementById('edit-estado-ciarp').value,
                    
                    // Evaluaciones
                    puntaje_eval1: parseFloat(document.getElementById('edit-puntaje-eval1').value) || 0,
                    puntaje_eval2: parseFloat(document.getElementById('edit-puntaje-eval2').value) || 0,
                    puntaje_asignado: parseFloat(document.getElementById('edit-puntaje-asignado').value) || 0,
                    
                    // Documentaci√≥n
                    acta_ciarp: document.getElementById('edit-acta').value,
                    resolucion: document.getElementById('edit-resolucion').value,
                    observaciones_lina: document.getElementById('edit-obs-lina').value
                };

                // ‚úÖ Agregar campos espec√≠ficos seg√∫n categor√≠a
                if (datosOriginales.categoria === "Art√≠culos Indexados") {
                    dataCompleta.modalidad = document.getElementById('edit-modalidad')?.value || '';
                    dataCompleta.tipo = document.getElementById('edit-tipo')?.value || '';
                    dataCompleta.pais = document.getElementById('edit-pais')?.value || '';
                    dataCompleta.issn = document.getElementById('edit-issn')?.value || '';
                    dataCompleta.clasificacion_publindex = document.getElementById('edit-clasificacion')?.value || '';
                    dataCompleta.editorial = document.getElementById('edit-editorial')?.value || '';
                    dataCompleta.anio_publicacion = document.getElementById('edit-anio-pub')?.value || '';
                    dataCompleta.num_autores = parseInt(document.getElementById('edit-num-autores')?.value) || 0;
                    dataCompleta.universidades_coautores = document.getElementById('edit-universidades')?.value || '';
                } else if (datosOriginales.categoria === "Art√≠culos No Indexados") {
                    dataCompleta.issn = document.getElementById('edit-issn')?.value || '';
                } else if (datosOriginales.categoria?.includes("Libro")) {
                    dataCompleta.isbn = document.getElementById('edit-isbn')?.value || '';
                    dataCompleta.anio_publicacion = document.getElementById('edit-anio-pub')?.value || '';
                    dataCompleta.editorial = document.getElementById('edit-editorial')?.value || '';
                }

                console.log("üì§ Enviando datos completos a Google Sheets:", dataCompleta);

                // ‚úÖ Actualizar Firebase
                await updateDoc(docRef, dataCompleta);

                // ‚úÖ Actualizar Google Sheets con TODOS los datos
                const response = await fetch(urlAppsScript, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(dataCompleta)
                });

                console.log("‚úÖ Datos enviados correctamente a Google Sheets");

                alert("‚úÖ Evaluaci√≥n guardada correctamente");
                cerrarModal();
                cargarPendientesLina();

            } catch (error) {
                console.error("‚ùå Error:", error);
                alert("‚ùå Error al guardar: " + error.message);
            } finally {
                btnGuardar.disabled = false;
                btnGuardar.innerHTML = '<span>üíæ</span> GUARDAR COMPILADO COMPLETO';
            }
        };

        window.cerrarModal = () => {
            document.getElementById('modal-evaluacion').classList.add('hidden');
            idRegistroActual = null;
        };

        window.cerrarSesion = () => {
            location.reload();
        };
    </script>
</head>
<body class="bg-gray-100 min-h-screen">

    <!-- HEADER -->
    <div id="header-bg" class="text-white py-6 shadow-xl transition-all duration-300">
        <div class="max-w-7xl mx-auto px-6">
            <div class="flex justify-between items-center">
                <div>
                    <h1 id="header-title" class="text-3xl font-extrabold tracking-tight">Sistema Productividad Acad√©mica</h1>
                    <p class="text-sm opacity-90 mt-1">Universidad del Quind√≠o - 2024</p>
                </div>
                <button onclick="cerrarSesion()" class="bg-white/20 hover:bg-white/30 px-6 py-2 rounded-lg font-bold transition flex items-center gap-2">
                    <span>üîì</span> CERRAR SESI√ìN
                </button>
            </div>
        </div>
    </div>

    <!-- PANTALLA DE LOGIN -->
    <div id="pantalla-login" class="max-w-4xl mx-auto mt-16 px-4">
        <div class="bg-white rounded-3xl shadow-2xl p-12">
            <h2 class="text-4xl font-bold text-center text-gray-800 mb-12">Seleccione su Perfil</h2>
            
            <div class="grid grid-cols-2 gap-8">
                <!-- JOS√â -->
                <div class="bg-gradient-to-br from-[#003d2b] to-green-800 p-8 rounded-2xl text-white shadow-xl">
                    <div class="text-center mb-6">
                        <div class="bg-white/20 w-24 h-24 rounded-full mx-auto flex items-center justify-center text-5xl mb-4">üìã</div>
                        <h3 class="text-2xl font-bold">JOS√â</h3>
                        <p class="text-sm opacity-90 mt-2">Seguimiento de Solicitudes</p>
                    </div>
                    <input type="password" id="password-jose" placeholder="Contrase√±a" 
                           class="w-full p-3 rounded-lg mb-4 text-gray-800 font-semibold"
                           onkeypress="if(event.key==='Enter') intentarLogin('JOSE')">
                    <button onclick="intentarLogin('JOSE')" 
                            class="w-full bg-white text-[#003d2b] py-3 rounded-lg font-bold hover:bg-gray-100 transition">
                        INGRESAR
                    </button>
                </div>

                <!-- LINA -->
                <div class="bg-gradient-to-br from-blue-900 to-blue-700 p-8 rounded-2xl text-white shadow-xl">
                    <div class="text-center mb-6">
                        <div class="bg-white/20 w-24 h-24 rounded-full mx-auto flex items-center justify-center text-5xl mb-4">üìä</div>
                        <h3 class="text-2xl font-bold">LINA</h3>
                        <p class="text-sm opacity-90 mt-2">Compilado y Liquidaci√≥n</p>
                    </div>
                    <input type="password" id="password-lina" placeholder="Contrase√±a" 
                           class="w-full p-3 rounded-lg mb-4 text-gray-800 font-semibold"
                           onkeypress="if(event.key==='Enter') intentarLogin('LINA')">
                    <button onclick="intentarLogin('LINA')" 
                            class="w-full bg-white text-blue-900 py-3 rounded-lg font-bold hover:bg-gray-100 transition">
                        INGRESAR
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- PANEL JOS√â -->
    <div id="panel-jose" class="hidden max-w-7xl mx-auto mt-8 px-4 pb-8">
        <div class="bg-white rounded-2xl shadow-xl p-8">
            <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center gap-3">
                <span class="bg-[#003d2b] text-white p-2 rounded">üìã</span>
                NUEVA SOLICITUD
            </h2>
            
            <form id="form-jose" class="space-y-6">
                <div class="grid grid-cols-4 gap-4">
                    <div>
                        <label class="block text-xs font-bold text-gray-500 uppercase mb-1">Categor√≠a</label>
                        <select id="categoria" onchange="cambiarCategoria()" class="w-full p-2 border border-gray-300 rounded focus:border-green-600 outline-none" required>
                            <option value="">Seleccionar...</option>
                            <option>Art√≠culos Indexados</option>
                            <option>Art√≠culos No Indexados</option>
                            <option>Libro Investigaci√≥n</option>
                            <option>Libro Texto</option>
                            <option>Libro Ensayo</option>
                            <option>Premio</option>
                            <option>Software</option>
                            <option>Patente</option>
                            <option>Obra Art√≠stica</option>
                            <option>Producci√≥n Audiovisual</option>
                            <option>Ponencias</option>
                            <option>Tesis</option>
                            <option>T√≠tulos</option>
                            <option>Ascensos</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-xs font-bold text-gray-500 uppercase mb-1">A√±o</label>
                        <select id="anio" class="w-full p-2 border border-gray-300 rounded focus:border-green-600 outline-none" required>
                            <option value="2024">2024</option>
                            <option value="2025">2025</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-xs font-bold text-gray-500 uppercase mb-1">Semestre</label>
                        <select id="semestre" class="w-full p-2 border border-gray-300 rounded focus:border-green-600 outline-none" required>
                            <option value="">Seleccionar...</option>
                            <option value="I">I</option>
                            <option value="II">II</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-xs font-bold text-gray-500 uppercase mb-1">Fecha Recibido</label>
                        <input type="date" id="fecha-recibido" class="w-full p-2 border border-gray-300 rounded focus:border-green-600 outline-none" required>
                    </div>
                </div>

                <div id="campos-jose-especificos"></div>

                <!-- ‚úÖ NUEVO: CAMPO AUTOR CON AUTOCOMPLETADO PARA JOS√â -->
                <div class="bg-gradient-to-r from-green-50 to-blue-50 p-4 rounded-lg border-2 border-green-300 shadow-sm">
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-xs font-bold text-green-700 mb-1">üîç AUTOR/DOCENTE</label>
                            <input 
                                list="lista-docentes-jose" 
                                type="text" 
                                id="autor" 
                                placeholder="Escriba el nombre del docente..." 
                                class="w-full p-2 border-2 border-green-400 rounded focus:border-green-600 outline-none" 
                                required
                                autocomplete="off">
                            <datalist id="lista-docentes-jose"></datalist>
                            <p class="text-xs text-green-600 mt-1">üí° Seleccione un nombre para validar que est√° en la base de datos</p>
                        </div>
                        <div>
                            <label class="block text-xs font-bold text-gray-500 uppercase mb-1">PROGRAMA</label>
                            <input type="text" id="programa" class="w-full p-2 border border-gray-300 rounded focus:border-green-600 outline-none">
                        </div>
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-xs font-bold text-gray-500 uppercase mb-1">Documentaci√≥n Completa</label>
                        <select id="doc-completa" class="w-full p-2 border border-gray-300 rounded focus:border-green-600 outline-none">
                            <option value="SI">SI</option>
                            <option value="NO">NO</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-xs font-bold text-gray-500 uppercase mb-1">Estado CIARP</label>
                        <select id="estado-ciarp" class="w-full p-2 border border-gray-300 rounded focus:border-green-600 outline-none">
                            <option value="Pendiente">Pendiente</option>
                            <option value="Aprobado">Aprobado</option>
                            <option value="No Aprobado">No Aprobado</option>
                        </select>
                    </div>
                </div>

                <div>
                    <label class="block text-xs font-bold text-gray-500 uppercase mb-1">Observaciones</label>
                    <textarea id="observaciones-jose" rows="3" class="w-full p-2 border border-gray-300 rounded focus:border-green-600 outline-none"></textarea>
                </div>

                <button type="button" id="btn-enviar-jose" onclick="enviarSolicitud()" 
                        class="w-full bg-[#003d2b] text-white py-4 rounded-xl font-bold hover:bg-green-900 transition text-lg shadow-lg flex items-center justify-center gap-3">
                    <span>‚úÖ</span> ENVIAR SOLICITUD
                </button>
            </form>
        </div>
    </div>

    <!-- PANEL LINA -->
    <div id="panel-lina" class="hidden max-w-7xl mx-auto mt-8 px-4 pb-8">
        <div class="bg-white rounded-2xl shadow-xl p-8">
            <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center gap-3">
                <span class="bg-blue-900 text-white p-2 rounded">üìä</span>
                SOLICITUDES PARA COMPILAR
            </h2>
            
            <div class="overflow-x-auto">
                <table class="w-full border-collapse border">
                    <thead class="bg-blue-900 text-white">
                        <tr>
                            <th class="border px-4 py-3 text-xs">CATEGOR√çA</th>
                            <th class="border px-4 py-3 text-xs">T√çTULO</th>
                            <th class="border px-4 py-3 text-xs">DOCENTE</th>
                            <th class="border px-4 py-3 text-xs">PROGRAMA</th>
                            <th class="border px-4 py-3 text-xs">ESTADO</th>
                            <th class="border px-4 py-3 text-xs">PUNTAJE</th>
                        </tr>
                    </thead>
                    <tbody id="tabla-pendientes-lina"></tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- MODAL EVALUACI√ìN LINA -->
    <div id="modal-evaluacion" class="hidden fixed inset-0 bg-black/60 flex items-center justify-center p-4 z-50 overflow-y-auto">
        <div class="bg-white rounded-3xl shadow-2xl max-w-6xl w-full my-8">
            <div class="bg-blue-900 text-white p-6 rounded-t-3xl flex justify-between items-center">
                <h3 class="text-2xl font-bold">üìã EVALUACI√ìN Y COMPILADO</h3>
                <button onclick="cerrarModal()" class="bg-white/20 hover:bg-white/30 px-4 py-2 rounded-lg font-bold transition">‚úï CERRAR</button>
            </div>
            
            <div class="p-8 space-y-6">
                <div class="bg-green-50 p-5 rounded-lg border-2 border-green-200">
                    <div class="flex items-center gap-2 mb-4">
                        <div class="bg-[#003d2b] text-white p-1 rounded">üìã</div>
                        <h4 class="font-bold text-[#003d2b] text-lg">DATOS DE SEGUIMIENTO (JOS√â)</h4>
                        <span class="text-xs bg-green-200 text-green-800 px-2 py-1 rounded ml-auto">SOLO LECTURA</span>
                    </div>
                    
                    <div class="grid grid-cols-4 gap-4 text-sm">
                        <div><span class="font-bold text-gray-600">Categor√≠a:</span> <span id="info-categoria" class="font-bold text-green-700"></span></div>
                        <div><span class="font-bold text-gray-600">Fecha Recibido:</span> <span id="info-fecha"></span></div>
                        <div><span class="font-bold text-gray-600">Doc. Completa:</span> <span id="info-doc" class="font-bold"></span></div>
                        
                        <div class="col-span-2"><span class="font-bold text-gray-600">T√≠tulo:</span> <span id="info-titulo" class="text-gray-900"></span></div>
                        <div><span class="font-bold text-gray-600">Docente:</span> <span id="info-autor" class="text-gray-900"></span></div>
                        <div><span class="font-bold text-gray-600">Programa:</span> <span id="info-programa" class="text-gray-900"></span></div>
                        
                        <div class="col-span-4 border-t pt-3 mt-2">
                            <span class="font-bold text-gray-600">Informaci√≥n Espec√≠fica:</span>
                            <div id="campos-jose-readonly" class="mt-2 p-3 bg-white rounded border"></div>
                        </div>
                        
                        <div class="col-span-2"><span class="font-bold text-gray-600">Estado Inicial:</span> <span id="info-estado-jose" class="font-bold text-lg"></span></div>
                        <div class="col-span-2"><span class="font-bold text-gray-600">Observaciones Jos√©:</span> <span id="info-obs-jose" class="text-gray-600 italic"></span></div>
                    </div>
                </div>

                <div class="bg-blue-50 p-5 rounded-lg border-2 border-blue-200">
                    <div class="flex items-center gap-2 mb-4">
                        <div class="bg-blue-900 text-white p-1 rounded">üë§</div>
                        <h4 class="font-bold text-blue-900 text-lg">DATOS DE COMPILADO (LINA)</h4>
                        <span class="text-xs bg-blue-200 text-blue-800 px-2 py-1 rounded ml-auto">EDITABLE</span>
                    </div>
                    
                    <div class="mb-6">
                        <p class="text-sm font-bold text-gray-700 mb-3 border-b pb-2">üë§ INFORMACI√ìN DEL DOCENTE</p>
                        
                        <!-- ‚úÖ BUSCADOR DE DOCENTE CON AUTOCOMPLETADO -->
                        <div class="mb-4 bg-gradient-to-r from-green-50 to-blue-50 p-4 rounded-lg border-2 border-green-300 shadow-sm">
                            <label class="block text-xs font-bold text-green-700 mb-2">
                                üîç BUSCAR DOCENTE POR NOMBRE
                            </label>
                            <input 
                                list="lista-docentes" 
                                id="buscar-docente" 
                                placeholder="Comienza a escribir el nombre del docente..." 
                                class="w-full border-2 border-green-400 p-3 rounded-lg text-sm font-medium focus:border-green-600 focus:ring-2 focus:ring-green-200 transition-all"
                                autocomplete="off">
                            <datalist id="lista-docentes"></datalist>
                            <p class="text-xs text-green-600 mt-2 flex items-center gap-1">
                                üí° <span>Al seleccionar un docente, sus datos b√°sicos se llenar√°n autom√°ticamente</span>
                            </p>
                        </div>
                        
                        <!-- DATOS AUTOCOMPLETADOS (solo lectura) -->
                        <div class="bg-yellow-50 p-3 rounded-lg mb-3 border border-yellow-200">
                            <p class="text-xs font-bold text-yellow-700 mb-2">üìã DATOS DEL DOCENTE (autocompletados)</p>
                            <div class="grid grid-cols-2 gap-3">
                                <div>
                                    <label class="block text-xs font-bold text-gray-600 mb-1">C√âDULA</label>
                                    <input type="text" id="edit-documento" 
                                           class="w-full border-2 border-yellow-300 p-2 rounded text-sm bg-white" 
                                           readonly>
                                </div>
                                <div>
                                    <label class="block text-xs font-bold text-gray-600 mb-1">CORREO INSTITUCIONAL</label>
                                    <input type="email" id="edit-correo" 
                                           class="w-full border-2 border-yellow-300 p-2 rounded text-sm bg-white" 
                                           readonly>
                                </div>
                            </div>
                        </div>
                        
                        <!-- DATOS EDITABLES -->
                        <div class="bg-blue-50 p-3 rounded-lg border border-blue-200">
                            <p class="text-xs font-bold text-blue-700 mb-2">‚úèÔ∏è INFORMACI√ìN ACAD√âMICA (editable)</p>
                            <div class="grid grid-cols-5 gap-3">
                                <div>
                                    <label class="block text-xs font-bold text-gray-600 mb-1">PROGRAMA</label>
                                    <input type="text" id="edit-programa" 
                                           class="w-full border-2 border-blue-300 p-2 rounded text-sm"
                                           placeholder="Ej: Administraci√≥n de Negocios">
                                </div>
                                <div>
                                    <label class="block text-xs font-bold text-gray-600 mb-1">ESCOLARIDAD</label>
                                    <select id="edit-escolaridad" class="w-full border-2 border-blue-300 p-2 rounded text-sm">
                                        <option value="">Seleccionar</option>
                                        <option>Pregrado</option>
                                        <option>Especializaci√≥n</option>
                                        <option>Maestr√≠a</option>
                                        <option>Doctorado</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-xs font-bold text-gray-600 mb-1">CATEGOR√çA DOCENTE</label>
                                    <select id="edit-categoria-doc" class="w-full border-2 border-blue-300 p-2 rounded text-sm">
                                        <option value="">Seleccionar</option>
                                        <option>Auxiliar</option>
                                        <option>Asistente</option>
                                        <option>Asociado</option>
                                        <option>Titular</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-xs font-bold text-gray-600 mb-1">DEDICACI√ìN</label>
                                    <select id="edit-dedicacion" class="w-full border-2 border-blue-300 p-2 rounded text-sm">
                                        <option value="">Seleccionar</option>
                                        <option>TC</option>
                                        <option>MT</option>
                                        <option>C√°tedra</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-xs font-bold text-gray-600 mb-1">FACULTAD</label>
                                    <input type="text" id="edit-facultad" 
                                           class="w-full border-2 border-blue-300 p-2 rounded text-sm"
                                           placeholder="Ej: Ingenier√≠a">
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mb-6">
                        <p class="text-sm font-bold text-gray-700 mb-3 border-b pb-2">üìã INFORMACI√ìN ESPEC√çFICA DEL PRODUCTO</p>
                        <div id="campos-lina-especificos"></div>
                    </div>
                    
                    <!-- ‚úÖ ESTADO EDITABLE POR LINA -->
                    <div class="mb-6">
                        <p class="text-sm font-bold text-gray-700 mb-3 border-b pb-2">‚úÖ APROBACI√ìN CIARP</p>
                        <div>
                            <label class="block text-xs font-bold text-gray-600 mb-1">ESTADO CIARP (EDITABLE)</label>
                            <select id="edit-estado-ciarp" class="w-full border-2 border-purple-400 bg-purple-50 p-3 rounded font-bold text-lg">
                                <option value="Pendiente">‚è≥ Pendiente</option>
                                <option value="Aprobado">‚úÖ Aprobado</option>
                                <option value="No Aprobado">‚ùå No Aprobado</option>
                            </select>
                        </div>
                    </div>
                    
                    <!-- ‚úÖ EVALUACI√ìN SIN PROMEDIO AUTOM√ÅTICO -->
                    <div class="bg-yellow-50 p-4 rounded-lg border-2 border-yellow-300 mb-6">
                        <p class="text-sm font-bold text-yellow-900 mb-4 flex items-center gap-2">
                            <span>‚≠ê</span> EVALUACI√ìN Y LIQUIDACI√ìN DE PUNTAJES
                        </p>
                        <div class="grid grid-cols-4 gap-4">
                            <div>
                                <label class="block text-xs font-bold text-gray-600 mb-1">PUNTAJE EVAL 1</label>
                                <input type="number" step="0.1" id="edit-puntaje-eval1"
                                       class="w-full border-2 border-yellow-400 p-2 rounded font-bold text-center text-lg">
                            </div>
                            <div>
                                <label class="block text-xs font-bold text-gray-600 mb-1">PUNTAJE EVAL 2</label>
                                <input type="number" step="0.1" id="edit-puntaje-eval2"
                                       class="w-full border-2 border-yellow-400 p-2 rounded font-bold text-center text-lg">
                            </div>
                            <div>
                                <label class="block text-xs font-bold text-gray-600 mb-1">PUNTAJE FINAL</label>
                                <input type="number" step="0.1" id="edit-puntaje-asignado" 
                                       class="w-full border-2 border-green-500 bg-green-50 p-2 rounded font-bold text-center text-2xl text-green-700">
                            </div>
                            <div>
                                <label class="block text-xs font-bold text-gray-600 mb-1">ACTA CIARP</label>
                                <input type="text" id="edit-acta" placeholder="N√∫mero de acta" 
                                       class="w-full border-2 border-blue-300 p-2 rounded text-sm">
                            </div>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-xs font-bold text-gray-600 mb-1">RESOLUCI√ìN</label>
                            <input type="text" id="edit-resolucion" placeholder="R.R. No..." 
                                   class="w-full border-2 border-blue-300 p-2 rounded text-sm">
                        </div>
                        <div>
                            <label class="block text-xs font-bold text-gray-600 mb-1">OBSERVACIONES T√âCNICAS (LINA)</label>
                            <textarea id="edit-obs-lina" rows="3" 
                                      class="w-full border-2 border-blue-300 p-2 rounded text-sm"
                                      placeholder="Observaciones para el compilado..."></textarea>
                        </div>
                    </div>
                </div>

                <button id="btn-guardar-lina" onclick="guardarEvaluacion()" 
                        class="w-full bg-blue-900 text-white py-4 rounded-xl font-bold hover:bg-blue-950 transition text-lg shadow-lg flex items-center justify-center gap-3">
                    <span>üíæ</span> GUARDAR COMPILADO COMPLETO
                </button>
            </div>
        </div>
    </div>

</body>
</html>

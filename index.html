<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema Productividad UQ 2024</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>
    
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-app.js";
        import { getFirestore, collection, addDoc, getDocs, updateDoc, doc, query, orderBy } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-firestore.js";
        import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-auth.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBbqMf8ZOmqmbGTmr2tr8nziyUWKSE6OWg",
            authDomain: "uniquindio-produccion.firebaseapp.com",
            projectId: "uniquindio-produccion",
            storageBucket: "uniquindio-produccion.firebasestorage.app",
            messagingSenderId: "440871309124",
            appId: "1:440871309124:web:108be1894adaf6ecaf1111"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);
        
        const urlAppsScript = "https://script.google.com/macros/s/AKfycbyOa0PXFxIu4lnAjobGIZMJdtJbs4ULUHJU1mv8gnCvjstp-a3qfQO7wDD2HYT_lJs6yA/exec";

        let rolActual = ''; 

        const CONTRASE√ëAS = {
            'JOSE': 'jose2026',
            'LINA': 'lina2026'
        };

        window.intentarLogin = (rol) => {
            const password = document.getElementById(`password-${rol.toLowerCase()}`).value;
            
            if (!password) {
                alert("‚ö†Ô∏è Por favor ingrese la contrase√±a");
                return;
            }
            
            if (password === CONTRASE√ëAS[rol]) {
                iniciarSesion(rol);
            } else {
                alert("‚ùå Contrase√±a incorrecta");
                document.getElementById(`password-${rol.toLowerCase()}`).value = '';
            }
        };

        function iniciarSesion(rol) {
            rolActual = rol;
            document.getElementById('pantalla-login').classList.add('hidden');
            
            if (rol === 'JOSE') {
                document.getElementById('panel-jose').classList.remove('hidden');
                document.getElementById('header-title').innerText = "SEGUIMIENTO DE SOLICITUDES (JOS√â)";
                document.getElementById('header-bg').classList.add('bg-[#003d2b]');
            } else {
                document.getElementById('panel-lina').classList.remove('hidden');
                document.getElementById('header-title').innerText = "COMPILADO Y LIQUIDACI√ìN (LINA)";
                document.getElementById('header-bg').classList.add('bg-blue-900');
                cargarPendientesLina();
            }
        }

        // CAMPOS ESPEC√çFICOS PARA JOS√â (SEGUIMIENTO)
        window.cambiarCategoria = () => {
            const cat = document.getElementById('categoria').value;
            const container = document.getElementById('campos-especificos');
            const inputClass = "w-full p-2 border border-gray-300 rounded focus:border-green-600 outline-none";
            const labelClass = "block text-xs font-bold text-gray-500 uppercase mb-1";
            let html = '';

            if (cat === "Art√≠culos Indexados") {
                html = `<div class="grid grid-cols-2 gap-4">
                    <div><label class="${labelClass}">Nombre del Art√≠culo</label><input type="text" id="nombre_articulo" class="${inputClass}"></div>
                    <div><label class="${labelClass}">T√≠tulo de la Revista</label><input type="text" id="titulo_revista" class="${inputClass}"></div>
                </div>`;
            
            } else if (cat === "Art√≠culos No Indexados") {
                html = `<div class="grid grid-cols-2 gap-4">
                    <div><label class="${labelClass}">Nombre del Art√≠culo</label><input type="text" id="nombre_articulo" class="${inputClass}"></div>
                    <div><label class="${labelClass}">T√≠tulo de la Revista</label><input type="text" id="titulo_revista" class="${inputClass}"></div>
                </div>`;
            
            } else if (cat === "Libro Investigaci√≥n" || cat === "Libro Texto" || cat === "Libro Ensayo") {
                html = `<div class="grid grid-cols-2 gap-4">
                    <div><label class="${labelClass}">Profesor Solicitante</label><input type="text" id="profesor_solicitante" class="${inputClass}"></div>
                    <div><label class="${labelClass}">√Årea de Conocimiento</label><input type="text" id="area_conocimiento" class="${inputClass}"></div>
                </div>`;
            
            } else if (cat === "Premio") {
                html = `<div class="grid grid-cols-2 gap-4">
                    <div><label class="${labelClass}">T√≠tulo del Trabajo Premiado</label><input type="text" id="titulo_trabajo_premiado" class="${inputClass}"></div>
                    <div><label class="${labelClass}">Premio Otorgado</label><input type="text" id="premio_otorgado" class="${inputClass}"></div>
                    <div><label class="${labelClass}">Fecha del Premio</label><input type="date" id="fecha_premio" class="${inputClass}"></div>
                </div>`;
            
            } else if (cat === "Software") {
                html = `<div><label class="${labelClass}">T√≠tulo del Software</label><input type="text" id="titulo_software" class="${inputClass}"></div>
                        <div class="mt-3"><label class="${labelClass}">Concepto Comit√© T√©cnico</label>
                        <select id="concepto_comite" class="${inputClass}">
                            <option value="">Pendiente</option>
                            <option value="SI">SI - Aprobado</option>
                            <option value="NO">NO - Rechazado</option>
                        </select></div>`;
            
            } else if (cat === "Patente") {
                html = `<div><label class="${labelClass}">T√≠tulo de la Patente</label><input type="text" id="titulo_patente" class="${inputClass}"></div>`;
            
            } else if (cat === "Obra Art√≠stica" || cat === "Producci√≥n Audiovisual") {
                html = `<div><label class="${labelClass}">T√≠tulo de la Obra</label><input type="text" id="titulo_obra" class="${inputClass}"></div>
                        <div class="mt-3"><label class="${labelClass}">Soportes Verificados</label>
                        <select id="soportes_ok" class="${inputClass}">
                            <option value="">Pendiente</option>
                            <option value="OK">OK - Verificado</option>
                            <option value="INCOMPLETO">Incompleto</option>
                        </select></div>`;
            
            } else if (cat === "Ponencias") {
                html = `<div><label class="${labelClass}">T√≠tulo de la Ponencia</label><input type="text" id="titulo_ponencia" class="${inputClass}"></div>`;
            
            } else if (cat === "Tesis") {
                html = `<div class="grid grid-cols-2 gap-4">
                    <div><label class="${labelClass}">T√≠tulo de la Tesis</label><input type="text" id="titulo_tesis" class="${inputClass}"></div>
                    <div><label class="${labelClass}">Autor (Estudiante)</label><input type="text" id="autor_estudiante" class="${inputClass}"></div>
                </div>`;
            
            } else if (cat === "T√≠tulos") {
                html = `<div class="grid grid-cols-2 gap-4">
                    <div><label class="${labelClass}">T√≠tulo Obtenido</label><input type="text" id="titulo_obtenido" class="${inputClass}"></div>
                    <div><label class="${labelClass}">Universidad que Otorga</label><input type="text" id="universidad_otorga" class="${inputClass}"></div>
                </div>`;
            
            } else if (cat === "Ascensos") {
                html = `<div class="grid grid-cols-3 gap-4">
                    <div><label class="${labelClass}">Tipo de Trabajo</label>
                        <select id="tipo_trabajo" class="${inputClass}">
                            <option value="">Seleccionar</option>
                            <option>Docencia</option>
                            <option>Investigaci√≥n</option>
                            <option>Extensi√≥n</option>
                        </select>
                    </div>
                    <div><label class="${labelClass}">Categor√≠a Actual</label>
                        <select id="categoria_actual" class="${inputClass}">
                            <option value="">Seleccionar</option>
                            <option>Auxiliar</option>
                            <option>Asistente</option>
                            <option>Asociado</option>
                            <option>Titular</option>
                        </select>
                    </div>
                    <div><label class="${labelClass}">Categor√≠a Solicitada</label>
                        <select id="categoria_solicitada" class="${inputClass}">
                            <option value="">Seleccionar</option>
                            <option>Auxiliar</option>
                            <option>Asistente</option>
                            <option>Asociado</option>
                            <option>Titular</option>
                        </select>
                    </div>
                </div>`;
            
            } else {
                html = `<p class="text-gray-500 text-sm italic">Sin campos adicionales</p>`;
            }
            
            container.innerHTML = html;
        };

        // GUARDAR SOLICITUD (JOS√â - SEGUIMIENTO)
        document.getElementById('form-jose').addEventListener('submit', async (e) => {
            e.preventDefault();
            const btn = document.getElementById('btn-jose');
            btn.innerText = "GUARDANDO..."; 
            btn.disabled = true;

            const categoria = document.getElementById('categoria').value;
            
            const registro = {
                // DATOS JOS√â (SEGUIMIENTO)
                anio: "2024",
                semestre: document.getElementById('semestre').value,
                categoria: categoria,
                fecha_recibido: document.getElementById('fecha_recibido').value,
                titulo_producto: document.getElementById('titulo_producto').value,
                autor: document.getElementById('autor').value,
                programa: document.getElementById('programa').value,
                doc_completa: document.getElementById('doc_completa').value,
                observaciones_jose: document.getElementById('observaciones_jose').value,
                estado_ciarp: document.getElementById('estado_inicial').value,
                
                // Campos espec√≠ficos seg√∫n categor√≠a (JOS√â)
                nombre_articulo: document.getElementById('nombre_articulo')?.value || '',
                titulo_revista: document.getElementById('titulo_revista')?.value || '',
                profesor_solicitante: document.getElementById('profesor_solicitante')?.value || '',
                area_conocimiento: document.getElementById('area_conocimiento')?.value || '',
                titulo_trabajo_premiado: document.getElementById('titulo_trabajo_premiado')?.value || '',
                premio_otorgado: document.getElementById('premio_otorgado')?.value || '',
                fecha_premio: document.getElementById('fecha_premio')?.value || '',
                titulo_software: document.getElementById('titulo_software')?.value || '',
                concepto_comite: document.getElementById('concepto_comite')?.value || '',
                titulo_patente: document.getElementById('titulo_patente')?.value || '',
                titulo_obra: document.getElementById('titulo_obra')?.value || '',
                soportes_ok: document.getElementById('soportes_ok')?.value || '',
                titulo_ponencia: document.getElementById('titulo_ponencia')?.value || '',
                titulo_tesis: document.getElementById('titulo_tesis')?.value || '',
                autor_estudiante: document.getElementById('autor_estudiante')?.value || '',
                titulo_obtenido: document.getElementById('titulo_obtenido')?.value || '',
                universidad_otorga: document.getElementById('universidad_otorga')?.value || '',
                tipo_trabajo: document.getElementById('tipo_trabajo')?.value || '',
                categoria_actual: document.getElementById('categoria_actual')?.value || '',
                categoria_solicitada: document.getElementById('categoria_solicitada')?.value || '',
                
                // CAMPOS LINA (COMPILADO - vac√≠os inicialmente)
                modalidad: "",
                tipo: "",
                pais: "",
                issn: "",
                clasificacion_publindex: "",
                editorial: "",
                isbn: "",
                anio_publicacion: "",
                documento_id: "",
                escolaridad: "",
                categoria_docente: "",
                dedicacion: "",
                facultad: "",
                puntaje_eval1: 0,
                puntaje_eval2: 0,
                puntaje_promedio: 0,
                puntaje_asignado: 0,
                num_autores: 0,
                universidades_coautores: "",
                acta_ciarp: "",
                resolucion: "",
                observaciones_lina: "",
                fecha_creacion: new Date().toISOString()
            };

            try {
                await addDoc(collection(db, 'registros_2024'), registro);
                console.log('‚úÖ Guardado en Firebase');
                
                await fetch(urlAppsScript, { 
                    method: 'POST',
                    body: JSON.stringify(registro),
                    mode: 'no-cors',
                    headers: { 'Content-Type': 'application/json' }
                });
                
                console.log('‚úÖ Sincronizado con Drive');
                alert("‚úÖ Solicitud Registrada en Seguimiento");
                e.target.reset();
                cambiarCategoria();
                
            } catch (err) { 
                console.error('‚ùå Error:', err);
                alert("‚ùå Error: " + err.message); 
            } finally { 
                btn.innerText = "REGISTRAR EN SEGUIMIENTO"; 
                btn.disabled = false; 
            }
        });

        // L√ìGICA LINA (COMPILADO)
        async function cargarPendientesLina() {
            const tbody = document.getElementById('tabla-pendientes');
            tbody.innerHTML = '<tr><td colspan="7" class="text-center p-4 text-gray-500">Cargando...</td></tr>';
            
            const q = query(collection(db, 'registros_2024'), orderBy('fecha_creacion', 'desc'));
            const snapshot = await getDocs(q);
            
            tbody.innerHTML = '';
            
            if (snapshot.empty) {
                tbody.innerHTML = '<tr><td colspan="7" class="text-center p-4 text-gray-400">No hay solicitudes</td></tr>';
                return;
            }
            
            snapshot.forEach((docSnap) => {
                const d = docSnap.data();
                const tr = document.createElement('tr');
                tr.className = "border-b hover:bg-blue-50 cursor-pointer transition";
                tr.onclick = () => abrirModalEvaluacion(docSnap.id, d);
                
                let estadoColor = d.estado_ciarp === "Aprobado" ? "text-green-600" : 
                                 d.estado_ciarp === "Negado" ? "text-red-600" : "text-yellow-600";

                tr.innerHTML = `
                    <td class="p-3 text-sm">${d.semestre || ''}-${d.anio || '2024'}</td>
                    <td class="p-3 text-sm">${d.fecha_recibido || 'N/A'}</td>
                    <td class="p-3 text-sm font-bold">${d.autor}</td>
                    <td class="p-3 text-sm">${d.titulo_producto}</td>
                    <td class="p-3 text-sm">${d.categoria}</td>
                    <td class="p-3 text-sm ${estadoColor} font-bold">${d.estado_ciarp || 'Pendiente'}</td>
                    <td class="p-3 text-sm text-center font-bold ${d.puntaje_asignado > 0 ? 'text-green-700' : 'text-gray-400'}">${d.puntaje_asignado || '-'}</td>
                `;
                tbody.appendChild(tr);
            });
        }

        let idRegistroActual = null;

        window.abrirModalEvaluacion = (id, data) => {
            idRegistroActual = id;
            document.getElementById('modal-evaluacion').classList.remove('hidden');
            
            // Datos de Jos√© (Seguimiento)
            document.getElementById('info-categoria').innerText = data.categoria;
            document.getElementById('info-titulo').innerText = data.titulo_producto;
            document.getElementById('info-autor').innerText = data.autor;
            document.getElementById('info-programa').innerText = data.programa;
            document.getElementById('info-fecha').innerText = data.fecha_recibido;
            document.getElementById('info-doc').innerText = data.doc_completa;
            document.getElementById('info-estado-jose').innerText = data.estado_ciarp || 'Pendiente';
            document.getElementById('info-obs-jose').innerText = data.observaciones_jose || 'Sin observaciones';
            
            // Mostrar campos espec√≠ficos seg√∫n categor√≠a
            mostrarCamposEspecificosJose(data);
            
            // Campos editables por Lina (Compilado)
            document.getElementById('edit-modalidad').value = data.modalidad || "";
            document.getElementById('edit-tipo').value = data.tipo || "";
            document.getElementById('edit-pais').value = data.pais || "";
            document.getElementById('edit-issn').value = data.issn || "";
            document.getElementById('edit-clasificacion').value = data.clasificacion_publindex || "";
            document.getElementById('edit-editorial').value = data.editorial || "";
            document.getElementById('edit-isbn').value = data.isbn || "";
            document.getElementById('edit-anio-pub').value = data.anio_publicacion || "";
            document.getElementById('edit-documento').value = data.documento_id || "";
            document.getElementById('edit-escolaridad').value = data.escolaridad || "";
            document.getElementById('edit-categoria-doc').value = data.categoria_docente || "";
            document.getElementById('edit-dedicacion').value = data.dedicacion || "";
            document.getElementById('edit-facultad').value = data.facultad || "";
            document.getElementById('edit-puntaje-eval1').value = data.puntaje_eval1 || 0;
            document.getElementById('edit-puntaje-eval2').value = data.puntaje_eval2 || 0;
            document.getElementById('edit-num-autores').value = data.num_autores || 0;
            document.getElementById('edit-universidades').value = data.universidades_coautores || "";
            document.getElementById('edit-puntaje').value = data.puntaje_asignado || 0;
            document.getElementById('edit-acta').value = data.acta_ciarp || "";
            document.getElementById('edit-resolucion').value = data.resolucion || "";
            document.getElementById('edit-obs-lina').value = data.observaciones_lina || "";
            
            calcularPromedio();
        };

        function mostrarCamposEspecificosJose(data) {
            const container = document.getElementById('campos-especificos-jose');
            let html = '';
            
            if (data.nombre_articulo) {
                html += `<div><span class="font-bold">Nombre Art√≠culo:</span> ${data.nombre_articulo}</div>`;
            }
            if (data.titulo_revista) {
                html += `<div><span class="font-bold">Revista:</span> ${data.titulo_revista}</div>`;
            }
            if (data.area_conocimiento) {
                html += `<div><span class="font-bold">√Årea Conocimiento:</span> ${data.area_conocimiento}</div>`;
            }
            if (data.premio_otorgado) {
                html += `<div><span class="font-bold">Premio:</span> ${data.premio_otorgado}</div>`;
                html += `<div><span class="font-bold">Fecha Premio:</span> ${data.fecha_premio}</div>`;
            }
            if (data.concepto_comite) {
                html += `<div><span class="font-bold">Comit√© T√©cnico:</span> <span class="font-bold ${data.concepto_comite === 'SI' ? 'text-green-600' : 'text-red-600'}">${data.concepto_comite}</span></div>`;
            }
            if (data.soportes_ok) {
                html += `<div><span class="font-bold">Soportes:</span> <span class="font-bold text-blue-600">${data.soportes_ok}</span></div>`;
            }
            if (data.autor_estudiante) {
                html += `<div><span class="font-bold">Estudiante:</span> ${data.autor_estudiante}</div>`;
            }
            if (data.tipo_trabajo) {
                html += `<div><span class="font-bold">Tipo Trabajo:</span> ${data.tipo_trabajo}</div>`;
            }
            if (data.categoria_actual) {
                html += `<div><span class="font-bold">Categor√≠a Actual:</span> ${data.categoria_actual} ‚Üí ${data.categoria_solicitada || ''}</div>`;
            }
            
            container.innerHTML = html || '<p class="text-gray-500 text-sm italic">Sin informaci√≥n adicional</p>';
        }

        window.cerrarModal = () => document.getElementById('modal-evaluacion').classList.add('hidden');

        window.calcularPromedio = () => {
            const eval1 = parseFloat(document.getElementById('edit-puntaje-eval1').value) || 0;
            const eval2 = parseFloat(document.getElementById('edit-puntaje-eval2').value) || 0;
            const promedio = (eval1 + eval2) / 2;
            document.getElementById('puntaje-promedio-display').innerText = promedio.toFixed(2);
        };

        window.guardarEvaluacion = async () => {
            if(!idRegistroActual) return;
            
            const eval1 = parseFloat(document.getElementById('edit-puntaje-eval1').value) || 0;
            const eval2 = parseFloat(document.getElementById('edit-puntaje-eval2').value) || 0;
            const promedio = (eval1 + eval2) / 2;
            
            const actualizacion = {
                modalidad: document.getElementById('edit-modalidad').value,
                tipo: document.getElementById('edit-tipo').value,
                pais: document.getElementById('edit-pais').value,
                issn: document.getElementById('edit-issn').value,
                clasificacion_publindex: document.getElementById('edit-clasificacion').value,
                editorial: document.getElementById('edit-editorial').value,
                isbn: document.getElementById('edit-isbn').value,
                anio_publicacion: document.getElementById('edit-anio-pub').value,
                documento_id: document.getElementById('edit-documento').value,
                escolaridad: document.getElementById('edit-escolaridad').value,
                categoria_docente: document.getElementById('edit-categoria-doc').value,
                dedicacion: document.getElementById('edit-dedicacion').value,
                facultad: document.getElementById('edit-facultad').value,
                puntaje_eval1: eval1,
                puntaje_eval2: eval2,
                puntaje_promedio: promedio,
                num_autores: parseInt(document.getElementById('edit-num-autores').value) || 0,
                universidades_coautores: document.getElementById('edit-universidades').value,
                puntaje_asignado: parseFloat(document.getElementById('edit-puntaje').value) || 0,
                acta_ciarp: document.getElementById('edit-acta').value,
                resolucion: document.getElementById('edit-resolucion').value,
                observaciones_lina: document.getElementById('edit-obs-lina').value
            };

            await updateDoc(doc(db, 'registros_2024', idRegistroActual), actualizacion);
            alert("‚úÖ Compilado Guardado");
            cerrarModal();
            cargarPendientesLina();
        };

        window.descargarExcel = async () => {
            const snapshot = await getDocs(collection(db, 'registros_2024'));
            const datos = [];
            snapshot.forEach(doc => {
                const d = doc.data();
                datos.push({
                    "A√±o": d.anio,
                    "Semestre": d.semestre,
                    "Categor√≠a": d.categoria,
                    "Fecha Recibido": d.fecha_recibido,
                    "T√≠tulo": d.titulo_producto,
                    "Autor": d.autor,
                    "Programa": d.programa,
                    "Estado CIARP": d.estado_ciarp,
                    "Doc ID": d.documento_id,
                    "Escolaridad": d.escolaridad,
                    "Categor√≠a Docente": d.categoria_docente,
                    "Dedicaci√≥n": d.dedicacion,
                    "Facultad": d.facultad,
                    "Puntaje Eval 1": d.puntaje_eval1,
                    "Puntaje Eval 2": d.puntaje_eval2,
                    "Promedio": d.puntaje_promedio,
                    "Puntaje Asignado": d.puntaje_asignado,
                    "N√∫m. Autores": d.num_autores,
                    "Acta": d.acta_ciarp,
                    "Resoluci√≥n": d.resolucion
                });
            });
            const ws = XLSX.utils.json_to_sheet(datos);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, "Compilado 2024");
            XLSX.writeFile(wb, `Compilado_Productividad_2024_${new Date().toISOString().split('T')[0]}.xlsx`);
        };

        signInAnonymously(auth);
        window.onload = () => { cambiarCategoria(); };
    </script>
</head>
<body class="bg-gray-100 font-sans h-screen flex flex-col">

    <div id="header-bg" class="bg-gray-800 text-white p-4 shadow-lg flex justify-between items-center transition-colors">
        <div>
            <h1 id="header-title" class="text-xl font-black tracking-wider">SISTEMA PRODUCTIVIDAD UQ</h1>
            <p class="text-[10px] opacity-75">Universidad del Quind√≠o - 2024</p>
        </div>
        <button onclick="location.reload()" class="text-xs bg-white/20 px-3 py-1 rounded hover:bg-white/40">Cerrar Sesi√≥n</button>
    </div>

    <!-- LOGIN -->
    <div id="pantalla-login" class="flex-1 flex items-center justify-center p-4">
        <div class="bg-white p-10 rounded-2xl shadow-2xl text-center max-w-md w-full">
            <div class="mb-8">
                <div class="text-4xl mb-3">üîê</div>
                <h2 class="text-2xl font-bold text-gray-700">Acceso al Sistema</h2>
                <p class="text-xs text-gray-500 mt-2">Universidad del Quind√≠o</p>
            </div>
            
            <div class="bg-green-50 p-5 rounded-xl mb-4 border-2 border-green-200">
                <div class="font-black text-lg text-green-800 mb-3">üë§ JOS√â</div>
                <p class="text-xs text-gray-600 mb-3">Seguimiento de Solicitudes</p>
                <input type="password" id="password-jose" placeholder="Contrase√±a" 
                    class="w-full p-3 border-2 border-green-300 rounded-lg mb-3 focus:outline-none focus:border-green-600"
                    onkeypress="if(event.key==='Enter') intentarLogin('JOSE')">
                <button onclick="intentarLogin('JOSE')" 
                    class="w-full bg-[#003d2b] hover:bg-green-900 text-white p-3 rounded-lg font-bold transition">
                    INGRESAR
                </button>
            </div>

            <div class="bg-blue-50 p-5 rounded-xl border-2 border-blue-200">
                <div class="font-black text-lg text-blue-800 mb-3">üë§ LINA</div>
                <p class="text-xs text-gray-600 mb-3">Compilado y Liquidaci√≥n</p>
                <input type="password" id="password-lina" placeholder="Contrase√±a" 
                    class="w-full p-3 border-2 border-blue-300 rounded-lg mb-3 focus:outline-none focus:border-blue-600"
                    onkeypress="if(event.key==='Enter') intentarLogin('LINA')">
                <button onclick="intentarLogin('LINA')" 
                    class="w-full bg-blue-800 hover:bg-blue-900 text-white p-3 rounded-lg font-bold transition">
                    INGRESAR
                </button>
            </div>
        </div>
    </div>

    <!-- PANEL JOS√â (SEGUIMIENTO) -->
    <div id="panel-jose" class="hidden flex-1 overflow-auto p-4 md:p-8">
        <div class="max-w-4xl mx-auto bg-white rounded-xl shadow-xl overflow-hidden">
            <div class="bg-green-50 p-4 border-b">
                <h3 class="text-green-800 font-bold text-lg">üìù Registro de Seguimiento</h3>
                <p class="text-xs text-gray-600 mt-1">Datos iniciales de la solicitud</p>
            </div>
            <form id="form-jose" class="p-6 space-y-5">
                <div class="grid grid-cols-3 gap-4">
                    <div>
                        <label class="block text-xs font-bold text-gray-600 mb-1">SEMESTRE</label>
                        <select id="semestre" required class="w-full border-2 p-2 rounded font-bold">
                            <option>I</option>
                            <option>II</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-xs font-bold text-gray-600 mb-1">FECHA RECIBIDO</label>
                        <input type="date" id="fecha_recibido" required class="w-full border-2 p-2 rounded">
                    </div>
                    <div>
                        <label class="block text-xs font-bold text-gray-600 mb-1">CATEGOR√çA</label>
                        <select id="categoria" onchange="cambiarCategoria()" required class="w-full border-2 p-2 rounded font-bold text-xs">
                            <option value="Art√≠culos Indexados">Art√≠culos Indexados</option>
                            <option value="Art√≠culos No Indexados">Art√≠culos No Indexados</option>
                            <option value="Libro Investigaci√≥n">Libro Investigaci√≥n</option>
                            <option value="Libro Texto">Libro Texto</option>
                            <option value="Libro Ensayo">Libro Ensayo</option>
                            <option value="Premio">Premio</option>
                            <option value="Software">Software</option>
                            <option value="Patente">Patente</option>
                            <option value="Obra Art√≠stica">Obra Art√≠stica</option>
                            <option value="Producci√≥n Audiovisual">Producci√≥n Audiovisual</option>
                            <option value="Producci√≥n T√©cnica">Producci√≥n T√©cnica</option>
                            <option value="Ponencias">Ponencias</option>
                            <option value="Tesis">Tesis (Maestr√≠a/Doctorado)</option>
                            <option value="T√≠tulos">T√≠tulos</option>
                            <option value="Ascensos">Ascensos</option>
                        </select>
                    </div>
                </div>

                <div>
                    <label class="block text-xs font-bold text-gray-600 mb-1">T√çTULO DEL PRODUCTO</label>
                    <input type="text" id="titulo_producto" required class="w-full border-2 p-2 rounded">
                </div>

                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-xs font-bold text-gray-600 mb-1">AUTOR/DOCENTE</label>
                        <input type="text" id="autor" required class="w-full border-2 p-2 rounded">
                    </div>
                    <div>
                        <label class="block text-xs font-bold text-gray-600 mb-1">PROGRAMA ACAD√âMICO</label>
                        <input type="text" id="programa" required class="w-full border-2 p-2 rounded">
                    </div>
                </div>

                <div id="campos-especificos" class="bg-gray-50 p-4 rounded border-2 border-dashed border-gray-300"></div>

                <div class="grid grid-cols-3 gap-4">
                    <div>
                        <label class="block text-xs font-bold text-gray-600 mb-1">DOC. COMPLETA</label>
                        <select id="doc_completa" class="w-full border-2 p-2 rounded font-bold">
                            <option>SI</option>
                            <option>NO</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-xs font-bold text-gray-600 mb-1">ESTADO INICIAL</label>
                        <select id="estado_inicial" class="w-full border-2 p-2 rounded font-bold">
                            <option>Pendiente</option>
                            <option>Aprobado</option>
                            <option>Negado</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-xs font-bold text-gray-600 mb-1">OBSERVACIONES</label>
                        <input type="text" id="observaciones_jose" placeholder="Opcional" class="w-full border-2 p-2 rounded">
                    </div>
                </div>

                <button type="submit" id="btn-jose" class="w-full bg-[#003d2b] text-white py-3 rounded-lg font-bold hover:bg-black transition">
                    ‚úÖ REGISTRAR EN SEGUIMIENTO
                </button>
            </form>
        </div>
    </div>

    <!-- PANEL LINA (COMPILADO) -->
    <div id="panel-lina" class="hidden flex-1 overflow-auto p-4 md:p-8">
        <div class="max-w-full mx-auto space-y-6 px-4">
            <div class="flex justify-between items-center">
                <div>
                    <h2 class="text-2xl font-bold text-blue-900">üìä Compilado de Productividad</h2>
                    <p class="text-sm text-gray-600">Liquidaci√≥n y verificaci√≥n t√©cnica</p>
                </div>
                <button onclick="descargarExcel()" class="bg-green-600 text-white px-5 py-2 rounded-lg shadow hover:bg-green-700 font-bold flex items-center gap-2">
                    <span>üì•</span> Exportar Excel
                </button>
            </div>

            <div class="bg-white rounded-xl shadow-xl overflow-hidden overflow-x-auto">
                <table class="w-full">
                    <thead class="bg-blue-100 text-blue-900 text-xs font-bold uppercase">
                        <tr>
                            <th class="p-3 text-left whitespace-nowrap">Per√≠odo</th>
                            <th class="p-3 text-left whitespace-nowrap">Fecha</th>
                            <th class="p-3 text-left">Docente</th>
                            <th class="p-3 text-left">Producto</th>
                            <th class="p-3 text-left">Categor√≠a</th>
                            <th class="p-3 text-left">Estado</th>
                            <th class="p-3 text-center">Puntaje</th>
                        </tr>
                    </thead>
                    <tbody id="tabla-pendientes"></tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- MODAL LINA (COMPILADO) -->
    <div id="modal-evaluacion" class="hidden fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50 overflow-y-auto">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-6xl my-8">
            <div class="bg-blue-900 text-white p-4 flex justify-between items-center sticky top-0 z-10">
                <div>
                    <h3 class="font-bold text-lg">üìä Compilado y Liquidaci√≥n</h3>
                    <p class="text-xs opacity-80">Verificaci√≥n t√©cnica y asignaci√≥n de puntaje</p>
                </div>
                <button onclick="cerrarModal()" class="text-3xl hover:text-gray-300">&times;</button>
            </div>
            
            <div class="p-6 space-y-5 max-h-[80vh] overflow-y-auto">
                <!-- DATOS DE JOS√â (SEGUIMIENTO) -->
                <div class="bg-green-50 p-4 rounded-lg border-2 border-green-200">
                    <p class="text-xs font-bold text-green-800 mb-3">üìù DATOS DE SEGUIMIENTO (JOS√â)</p>
                    <div class="grid grid-cols-4 gap-3 text-sm">
                        <div><span class="font-bold text-gray-600">Categor√≠a:</span> <span id="info-categoria" class="text-gray-900"></span></div>
                        <div><span class="font-bold text-gray-600">Fecha:</span> <span id="info-fecha" class="text-gray-900"></span></div>
                        <div><span class="font-bold text-gray-600">Doc. Completa:</span> <span id="info-doc" class="font-bold"></span></div>
                        <div><span class="font-bold text-gray-600">Estado Inicial:</span> <span id="info-estado-jose" class="font-bold"></span></div>
                        <div class="col-span-2"><span class="font-bold text-gray-600">Producto:</span> <span id="info-titulo" class="text-gray-900"></span></div>
                        <div><span class="font-bold text-gray-600">Docente:</span> <span id="info-autor" class="text-gray-900"></span></div>
                        <div><span class="font-bold text-gray-600">Programa:</span> <span id="info-programa" class="text-gray-900"></span></div>
                        <div class="col-span-4" id="campos-especificos-jose"></div>
                        <div class="col-span-4"><span class="font-bold text-gray-600">Observaciones:</span> <span id="info-obs-jose" class="text-gray-600 italic"></span></div>
                    </div>
                </div>

                <!-- DATOS COMPILADO (LINA) -->
                <div class="bg-blue-50 p-4 rounded-lg">
                    <p class="text-xs font-bold text-blue-900 mb-3">üìã INFORMACI√ìN PARA COMPILADO</p>
                    
                    <!-- Detalles del Producto -->
                    <div class="grid grid-cols-4 gap-4 mb-4">
                        <div>
                            <label class="block text-xs font-bold text-gray-600 mb-1">MODALIDAD</label>
                            <select id="edit-modalidad" class="w-full border-2 border-blue-200 p-2 rounded text-sm">
                                <option value="">N/A</option>
                                <option>Full paper</option>
                                <option>Short paper</option>
                                <option>Poster</option>
                                <option>Review</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-xs font-bold text-gray-600 mb-1">TIPO</label>
                            <select id="edit-tipo" class="w-full border-2 border-blue-200 p-2 rounded text-sm">
                                <option value="">N/A</option>
                                <option>Nacional</option>
                                <option>Internacional</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-xs font-bold text-gray-600 mb-1">PA√çS</label>
                            <input type="text" id="edit-pais" placeholder="Colombia" class="w-full border-2 border-blue-200 p-2 rounded text-sm">
                        </div>
                        <div>
                            <label class="block text-xs font-bold text-gray-600 mb-1">A√ëO PUBLICACI√ìN</label>
                            <input type="number" id="edit-anio-pub" placeholder="2024" class="w-full border-2 border-blue-200 p-2 rounded text-sm">
                        </div>
                        <div>
                            <label class="block text-xs font-bold text-gray-600 mb-1">ISSN</label>
                            <input type="text" id="edit-issn" class="w-full border-2 border-blue-200 p-2 rounded text-sm">
                        </div>
                        <div>
                            <label class="block text-xs font-bold text-gray-600 mb-1">ISBN</label>
                            <input type="text" id="edit-isbn" class="w-full border-2 border-blue-200 p-2 rounded text-sm">
                        </div>
                        <div>
                            <label class="block text-xs font-bold text-gray-600 mb-1">CLASIFICACI√ìN/PUBLINDEX</label>
                            <select id="edit-clasificacion" class="w-full border-2 border-blue-200 p-2 rounded text-sm">
                                <option value="">N/A</option>
                                <option>A1</option>
                                <option>A2</option>
                                <option>B</option>
                                <option>C</option>
                                <option>D</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-xs font-bold text-gray-600 mb-1">EDITORIAL</label>
                            <input type="text" id="edit-editorial" class="w-full border-2 border-blue-200 p-2 rounded text-sm">
                        </div>
                    </div>

                    <!-- Informaci√≥n del Docente -->
                    <div class="bg-white p-3 rounded mb-4">
                        <p class="text-xs font-bold text-gray-700 mb-2">üë§ DATOS DEL DOCENTE</p>
                        <div class="grid grid-cols-5 gap-3">
                            <div>
                                <label class="block text-xs font-bold text-gray-600 mb-1">DOC. IDENTIDAD</label>
                                <input type="text" id="edit-documento" class="w-full border-2 border-gray-300 p-2 rounded text-sm">
                            </div>
                            <div>
                                <label class="block text-xs font-bold text-gray-600 mb-1">ESCOLARIDAD</label>
                                <select id="edit-escolaridad" class="w-full border-2 border-gray-300 p-2 rounded text-sm">
                                    <option value="">Seleccionar</option>
                                    <option>Pregrado</option>
                                    <option>Especializaci√≥n</option>
                                    <option>Maestr√≠a</option>
                                    <option>Doctorado</option>
                                    <option>Posdoctorado</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-xs font-bold text-gray-600 mb-1">CATEGOR√çA</label>
                                <select id="edit-categoria-doc" class="w-full border-2 border-gray-300 p-2 rounded text-sm">
                                    <option value="">Seleccionar</option>
                                    <option>Auxiliar</option>
                                    <option>Asistente</option>
                                    <option>Asociado</option>
                                    <option>Titular</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-xs font-bold text-gray-600 mb-1">DEDICACI√ìN</label>
                                <select id="edit-dedicacion" class="w-full border-2 border-gray-300 p-2 rounded text-sm">
                                    <option value="">Seleccionar</option>
                                    <option>TC</option>
                                    <option>MT</option>
                                    <option>C√°tedra</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-xs font-bold text-gray-600 mb-1">FACULTAD</label>
                                <input type="text" id="edit-facultad" class="w-full border-2 border-gray-300 p-2 rounded text-sm">
                            </div>
                        </div>
                    </div>

                    <!-- Coautor√≠a -->
                    <div class="grid grid-cols-2 gap-4 mb-4">
                        <div>
                            <label class="block text-xs font-bold text-gray-600 mb-1">N√öMERO TOTAL DE AUTORES</label>
                            <input type="number" id="edit-num-autores" class="w-full border-2 border-blue-200 p-2 rounded text-sm">
                        </div>
                        <div>
                            <label class="block text-xs font-bold text-gray-600 mb-1">UNIVERSIDADES COAUTORES</label>
                            <input type="text" id="edit-universidades" placeholder="UQ, UdeA, UniNorte..." class="w-full border-2 border-blue-200 p-2 rounded text-sm">
                        </div>
                    </div>

                    <!-- Evaluaci√≥n y Puntajes -->
                    <div class="bg-yellow-50 p-3 rounded border-2 border-yellow-200">
                        <p class="text-xs font-bold text-yellow-900 mb-2">‚≠ê EVALUACI√ìN Y LIQUIDACI√ìN</p>
                        <div class="grid grid-cols-5 gap-3">
                            <div>
                                <label class="block text-xs font-bold text-gray-600 mb-1">EVAL 1</label>
                                <input type="number" step="0.1" id="edit-puntaje-eval1" oninput="calcularPromedio()" class="w-full border-2 border-yellow-300 p-2 rounded font-bold text-sm">
                            </div>
                            <div>
                                <label class="block text-xs font-bold text-gray-600 mb-1">EVAL 2</label>
                                <input type="number" step="0.1" id="edit-puntaje-eval2" oninput="calcularPromedio()" class="w-full border-2 border-yellow-300 p-2 rounded font-bold text-sm">
                            </div>
                            <div>
                                <label class="block text-xs font-bold text-gray-600 mb-1">PROMEDIO</label>
                                <div class="w-full border-2 border-yellow-300 bg-yellow-100 p-2 rounded font-bold text-lg text-center" id="puntaje-promedio-display">0.00</div>
                            </div>
                            <div>
                                <label class="block text-xs font-bold text-gray-600 mb-1">PUNTAJE FINAL *</label>
                                <input type="number" step="0.1" id="edit-puntaje" class="w-full border-2 border-green-400 p-2 rounded font-bold text-lg text-green-700 text-center">
                            </div>
                            <div>
                                <label class="block text-xs font-bold text-gray-600 mb-1">ACTA CIARP</label>
                                <input type="text" id="edit-acta" placeholder="3-30/03/2024" class="w-full border-2 border-yellow-300 p-2 rounded text-sm">
                            </div>
                        </div>
                    </div>

                    <!-- Resoluci√≥n y Observaciones -->
                    <div class="grid grid-cols-2 gap-4 mt-4">
                        <div>
                            <label class="block text-xs font-bold text-gray-600 mb-1">RESOLUCI√ìN</label>
                            <input type="text" id="edit-resolucion" placeholder="R.R. No..." class="w-full border-2 border-blue-200 p-2 rounded text-sm">
                        </div>
                        <div>
                            <label class="block text-xs font-bold text-gray-600 mb-1">OBSERVACIONES T√âCNICAS (LINA)</label>
                            <textarea id="edit-obs-lina" rows="2" class="w-full border-2 border-blue-200 p-2 rounded text-sm"></textarea>
                        </div>
                    </div>
                </div>

                <button onclick="guardarEvaluacion()" class="w-full bg-blue-800 text-white py-3 rounded-lg font-bold hover:bg-blue-900 transition text-lg">
                    üíæ GUARDAR EN COMPILADO
                </button>
            </div>
        </div>
    </div>

</body>
</html>

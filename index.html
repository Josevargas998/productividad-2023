<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema Productividad UQ 2024</title>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-app.js";
        import { getFirestore, collection, addDoc, getDocs, updateDoc, doc, query, orderBy, getDoc, deleteDoc } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-firestore.js";
        import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-auth.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBbqMf8ZOmqmbGTmr2tr8nziyUWKSE6OWg",
            authDomain: "uniquindio-produccion.firebaseapp.com",
            projectId: "uniquindio-produccion",
            storageBucket: "uniquindio-produccion.firebasestorage.app",
            messagingSenderId: "440871309124",
            appId: "1:440871309124:web:108be1894adaf6ecaf1111"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);
        
        // ‚ö†Ô∏è IMPORTANTE: Reemplaza esta URL con la URL de tu Apps Script implementado
        const urlAppsScript = "https://script.google.com/macros/s/AKfycbz8OAdYOLSFbrfkQrjPapuptlYlC11cB8cqJ_eMYJ8oKTurvkG8LPGgP39zlsyS-bHPrg/exec";

        let rolActual = '';
        let idRegistroActual = null;
        let baseDocentes = [];

        const CONTRASE√ëAS = {
            'JOSE': 'jose2026',
            'LINA': 'lina2026'
        };

        // ==================== CONFIGURACI√ìN DE CAMPOS POR CATEGOR√çA ====================
        const CAMPOS_POR_CATEGORIA = {
            "Art√≠culos Indexados": {
                jose: ["tipo_articulo", "doi"],
                lina: ["issn", "editorial", "anio_publicacion"]
            },
            "Art√≠culos No Indexados": {
                jose: ["tipo_articulo", "doi"],
                lina: ["issn", "editorial", "anio_publicacion"]
            },
            "Libro Investigaci√≥n": {
                jose: ["isbn", "editorial"],
                lina: ["isbn_lina", "anio_publicacion"]
            },
            "Libro Texto": {
                jose: ["isbn", "editorial", "area_conocimiento"],
                lina: ["isbn_lina", "anio_publicacion"]
            },
            "Software": {
                jose: ["nombre_software", "version"],
                lina: ["tipo_software", "lenguaje_programacion"]
            },
            "Producci√≥n T√©cnica": {
                jose: ["tipo_produccion", "descripcion_tecnica"],
                lina: ["area_aplicacion", "impacto"]
            },
            "Producci√≥n Audiovisual": {
                jose: ["tipo_produccion_av", "duracion", "formato"],
                lina: ["plataforma_distribucion", "alcance"]
            },
            "Obra Art√≠stica": {
                jose: ["tipo_obra", "tecnica"],
                lina: ["lugar_exposicion", "fecha_exhibicion"]
            },
            "Patente": {
                jose: ["numero_solicitud", "tipo_patente"],
                lina: ["numero_registro", "pais_registro", "estado_tramite"]
            },
            "Premio": {
                jose: ["nombre_premio", "entidad_otorga"],
                lina: ["ambito_premio", "fecha_otorgamiento"]
            },
            "Ponencias": {
                jose: ["tipo_evento", "lugar_evento", "fecha_evento"],
                lina: ["tipo_participacion", "publicado_memorias"]
            },
            "Tesis": {
                jose: ["nivel_formacion", "nombre_estudiante", "institucion"],
                lina: ["fecha_sustentacion", "resultado"]
            }
        };

        // ==================== LOGIN ====================
        window.intentarLogin = function(rol) {
            const password = document.getElementById(`password-${rol.toLowerCase()}`).value;
            
            if (!password) {
                alert("‚ö†Ô∏è Ingrese la contrase√±a");
                return;
            }
            
            if (password === CONTRASE√ëAS[rol]) {
                iniciarSesion(rol);
            } else {
                alert("‚ùå Contrase√±a incorrecta");
                document.getElementById(`password-${rol.toLowerCase()}`).value = '';
            }
        };

        function iniciarSesion(rol) {
            rolActual = rol;
            document.getElementById('pantalla-login').classList.add('hidden');
            
            if (rol === 'JOSE') {
                document.getElementById('panel-jose').classList.remove('hidden');
                document.getElementById('header-title').innerText = "SEGUIMIENTO DE SOLICITUDES (JOS√â)";
                document.getElementById('header-bg').classList.remove('bg-gray-700');
                document.getElementById('header-bg').classList.add('bg-green-800');
                cargarBaseDocentes();
                cambiarCategoria();
            } else {
                document.getElementById('panel-lina').classList.remove('hidden');
                document.getElementById('header-title').innerText = "COMPILADO Y LIQUIDACI√ìN (LINA)";
                document.getElementById('header-bg').classList.remove('bg-gray-700');
                document.getElementById('header-bg').classList.add('bg-blue-900');
                cargarBaseDocentes();
                cargarPendientesLina();
            }
        }

        window.cerrarSesion = function() {
            location.reload();
        };

        // ==================== CARGAR DOCENTES DESDE GOOGLE SHEETS ====================
        async function cargarBaseDocentes() {
            try {
                console.log('üîÑ Cargando base de docentes desde Google Sheets...');
                
                const response = await fetch(urlAppsScript + '?action=obtenerDocentes');
                const data = await response.json();
                
                if (data && Array.isArray(data) && data.length > 0) {
                    baseDocentes = data;
                    
                    // Llenar datalist para Jos√©
                    const datalistJose = document.getElementById('lista-docentes-jose');
                    if (datalistJose) {
                        datalistJose.innerHTML = '';
                        data.forEach(doc => {
                            const option = document.createElement('option');
                            option.value = doc.nombre;
                            datalistJose.appendChild(option);
                        });
                    }
                    
                    // Llenar datalist para Lina
                    const datalistLina = document.getElementById('lista-docentes-lina');
                    if (datalistLina) {
                        datalistLina.innerHTML = '';
                        data.forEach(doc => {
                            const option = document.createElement('option');
                            option.value = doc.nombre;
                            datalistLina.appendChild(option);
                        });
                    }
                    
                    console.log(`‚úÖ ${data.length} docentes cargados correctamente`);
                } else {
                    console.warn('‚ö†Ô∏è No se encontraron docentes en la base de datos');
                    alert('‚ö†Ô∏è Advertencia: No se pudieron cargar los docentes. Verifique que la hoja BD_Docentes exista en Google Sheets.');
                }
                    
            } catch (error) {
                console.error('‚ùå Error al cargar docentes:', error);
                alert('‚ùå Error al conectar con Google Sheets. Verifique la configuraci√≥n del Apps Script.');
            }
        }

        // ==================== AUTOCOMPLETAR DOCENTE (JOS√â) ====================
        window.autocompletarDocente = function() {
            const nombreInput = document.getElementById('autor');
            const nombreSeleccionado = nombreInput?.value.trim();
            
            if (!nombreSeleccionado) return;
            
            const docente = baseDocentes.find(d => d.nombre === nombreSeleccionado);
            
            if (docente) {
                // Llenar autom√°ticamente el programa
                const programaInput = document.getElementById('programa');
                if (programaInput && docente.dependencia) {
                    programaInput.value = docente.dependencia;
                }
                
                // Indicaci√≥n visual
                nombreInput.classList.add('border-green-500', 'bg-green-50');
                setTimeout(() => {
                    nombreInput.classList.remove('border-green-500', 'bg-green-50');
                }, 1000);
                
                console.log('‚úÖ Docente encontrado:', docente.nombre);
            } else {
                console.log('‚ö†Ô∏è Docente no encontrado en la base de datos');
            }
        };

        // ==================== CAMBIAR CATEGOR√çA Y MOSTRAR CAMPOS DIN√ÅMICOS ====================
        window.cambiarCategoria = function() {
            const categoria = document.getElementById('categoria')?.value;
            const camposExtrasContainer = document.getElementById('campos-extras-jose');
            
            if (!camposExtrasContainer || !categoria) return;
            
            // Limpiar campos extras
            camposExtrasContainer.innerHTML = '';
            
            // Obtener campos para esta categor√≠a
            const campos = CAMPOS_POR_CATEGORIA[categoria]?.jose || [];
            
            if (campos.length === 0) return;
            
            // Crear t√≠tulo de secci√≥n
            const titulo = document.createElement('h3');
            titulo.className = 'col-span-2 text-lg font-bold text-green-800 mt-4 mb-2 border-b-2 border-green-300 pb-2';
            titulo.textContent = `üìã Informaci√≥n Espec√≠fica de ${categoria}`;
            camposExtrasContainer.appendChild(titulo);
            
            // Crear campos din√°micos
            campos.forEach(campo => {
                const div = document.createElement('div');
                const label = document.createElement('label');
                label.className = 'block text-xs font-bold text-gray-600 mb-1';
                label.textContent = formatearNombreCampo(campo);
                
                const input = document.createElement('input');
                input.type = 'text';
                input.id = campo;
                input.className = 'w-full p-2 border rounded';
                input.placeholder = formatearNombreCampo(campo);
                
                div.appendChild(label);
                div.appendChild(input);
                camposExtrasContainer.appendChild(div);
            });
        };

        function formatearNombreCampo(campo) {
            // Convertir snake_case a T√≠tulo Capitalizado
            return campo
                .split('_')
                .map(palabra => palabra.charAt(0).toUpperCase() + palabra.slice(1))
                .join(' ');
        }

        // ==================== ENVIAR SOLICITUD (JOS√â) ====================
        window.enviarSolicitud = async function() {
            const btnEnviar = document.getElementById('btn-enviar-jose');
            const categoriaSeleccionada = document.getElementById('categoria').value;
            
            // Validar campos obligatorios
            const campos = ['categoria', 'anio', 'semestre', 'fecha_recibido', 'titulo_producto', 'autor', 'programa'];
            for (let campo of campos) {
                const valor = document.getElementById(campo)?.value;
                if (!valor || valor.trim() === '') {
                    alert(`‚ö†Ô∏è El campo ${formatearNombreCampo(campo)} es obligatorio`);
                    return;
                }
            }
            
            btnEnviar.disabled = true;
            btnEnviar.textContent = '‚è≥ Enviando...';
            
            try {
                // Recoger datos generales
                const datosGenerales = {
                    tipo_registro: "JOSE",
                    timestamp: new Date().toISOString(),
                    categoria: document.getElementById('categoria').value,
                    anio: document.getElementById('anio').value,
                    semestre: document.getElementById('semestre').value,
                    fecha_recibido: document.getElementById('fecha_recibido').value,
                    titulo_producto: document.getElementById('titulo_producto').value,
                    autor: document.getElementById('autor').value,
                    programa: document.getElementById('programa').value,
                    doc_completa: document.getElementById('doc_completa').value || 'Completa',
                    estado_ciarp: document.getElementById('estado_ciarp')?.value || 'Pendiente',
                    observaciones_jose: document.getElementById('observaciones-jose')?.value || ''
                };
                
                // Recoger datos espec√≠ficos de la categor√≠a
                const camposEspecificos = CAMPOS_POR_CATEGORIA[categoriaSeleccionada]?.jose || [];
                camposEspecificos.forEach(campo => {
                    const valor = document.getElementById(campo)?.value;
                    if (valor) {
                        datosGenerales[campo] = valor;
                    }
                });
                
                console.log('üì§ Enviando datos:', datosGenerales);
                
                // Guardar en Firebase
                const docRef = await addDoc(collection(db, 'solicitudes'), datosGenerales);
                console.log('‚úÖ Guardado en Firebase:', docRef.id);
                
                // Enviar a Google Sheets
                const responseSheets = await fetch(urlAppsScript, {
                    method: 'POST',
                    body: JSON.stringify(datosGenerales)
                });
                
                const resultSheets = await responseSheets.json();
                console.log('‚úÖ Respuesta de Sheets:', resultSheets);
                
                if (resultSheets.status === 'success') {
                    alert('‚úÖ Solicitud enviada correctamente');
                    limpiarFormularioJose();
                } else {
                    throw new Error(resultSheets.message || 'Error desconocido');
                }
                
            } catch (error) {
                console.error('‚ùå Error:', error);
                alert('‚ùå Error al enviar: ' + error.message);
            } finally {
                btnEnviar.disabled = false;
                btnEnviar.textContent = '‚úÖ ENVIAR SOLICITUD';
            }
        };

        function limpiarFormularioJose() {
            document.getElementById('form-jose').reset();
            document.getElementById('campos-extras-jose').innerHTML = '';
            document.getElementById('estado_ciarp').value = 'Pendiente';
        }

        // ==================== CARGAR PENDIENTES (LINA) ====================
        async function cargarPendientesLina() {
            try {
                const q = query(collection(db, 'solicitudes'), orderBy('timestamp', 'desc'));
                const querySnapshot = await getDocs(q);
                
                const tablaPendientes = document.getElementById('tabla-pendientes-lina');
                tablaPendientes.innerHTML = '';
                
                if (querySnapshot.empty) {
                    tablaPendientes.innerHTML = '<tr><td colspan="6" class="text-center py-8 text-gray-500">No hay solicitudes pendientes</td></tr>';
                    return;
                }
                
                querySnapshot.forEach((doc) => {
                    const data = doc.data();
                    const tr = document.createElement('tr');
                    tr.className = 'hover:bg-blue-50 cursor-pointer transition';
                    tr.onclick = () => abrirModalEvaluacion(doc.id, data);
                    
                    const estadoColor = data.estado_ciarp === 'Aprobado' ? 'text-green-700 font-bold' :
                                       data.estado_ciarp === 'No Aprobado' ? 'text-red-700 font-bold' :
                                       'text-yellow-700 font-bold';
                    
                    tr.innerHTML = `
                        <td class="border p-3 text-sm">${data.categoria || ''}</td>
                        <td class="border p-3 text-sm font-semibold">${data.titulo_producto || ''}</td>
                        <td class="border p-3 text-sm">${data.autor || ''}</td>
                        <td class="border p-3 text-sm">${data.programa || ''}</td>
                        <td class="border p-3 text-sm ${estadoColor}">${data.estado_ciarp || 'Pendiente'}</td>
                        <td class="border p-3 text-sm text-center font-bold text-blue-700">${data.puntaje_asignado || '0'}</td>
                    `;
                    
                    tablaPendientes.appendChild(tr);
                });
                
            } catch (error) {
                console.error('‚ùå Error al cargar pendientes:', error);
                alert('‚ùå Error al cargar solicitudes');
            }
        }

        // ==================== ABRIR MODAL EVALUACI√ìN (LINA) ====================
        window.abrirModalEvaluacion = async function(idDoc, data) {
            idRegistroActual = idDoc;
            
            // Informaci√≥n de Jos√© (solo lectura)
            document.getElementById('info-categoria').textContent = data.categoria || '';
            document.getElementById('info-fecha').textContent = data.fecha_recibido || '';
            document.getElementById('info-doc-completa').textContent = data.doc_completa || '';
            document.getElementById('info-titulo').textContent = data.titulo_producto || '';
            document.getElementById('info-autor').textContent = data.autor || '';
            document.getElementById('info-programa').textContent = data.programa || '';
            document.getElementById('info-obs-jose').textContent = data.observaciones_jose || 'Sin observaciones';
            
            // Buscar docente y llenar informaci√≥n
            const docente = baseDocentes.find(d => d.nombre === data.autor);
            
            if (docente) {
                document.getElementById('buscar-docente-lina').value = docente.nombre;
                document.getElementById('info-cedula').textContent = docente.cedula || '';
                document.getElementById('info-correo').textContent = docente.correo || '';
                document.getElementById('info-escolaridad').textContent = docente.escolaridad || '';
                document.getElementById('info-categoria-doc').textContent = docente.categoria || '';
                document.getElementById('info-dedicacion').textContent = docente.dedicacion || '';
                document.getElementById('info-facultad').textContent = docente.facultad || '';
            } else {
                document.getElementById('buscar-docente-lina').value = data.autor;
                document.getElementById('info-cedula').textContent = 'No encontrado';
                document.getElementById('info-correo').textContent = 'No encontrado';
                document.getElementById('info-escolaridad').textContent = '';
                document.getElementById('info-categoria-doc').textContent = '';
                document.getElementById('info-dedicacion').textContent = '';
                document.getElementById('info-facultad').textContent = '';
            }
            
            // Campos editables de Lina
            document.getElementById('edit-estado-ciarp').value = data.estado_ciarp || 'Pendiente';
            document.getElementById('edit-puntaje-eval1').value = data.puntaje_eval1 || '';
            document.getElementById('edit-puntaje-eval2').value = data.puntaje_eval2 || '';
            document.getElementById('edit-puntaje-final').value = data.puntaje_asignado || '';
            document.getElementById('edit-acta').value = data.acta_ciarp || '';
            document.getElementById('edit-resolucion').value = data.resolucion || '';
            document.getElementById('edit-observaciones-lina').value = data.observaciones_lina || '';
            
            // Mostrar campos espec√≠ficos de Lina para esta categor√≠a
            mostrarCamposEspecificosLina(data.categoria, data);
            
            document.getElementById('modal-evaluacion').classList.remove('hidden');
        };

        function mostrarCamposEspecificosLina(categoria, data) {
            const container = document.getElementById('campos-especificos-lina');
            if (!container) return;
            
            container.innerHTML = '';
            
            const campos = CAMPOS_POR_CATEGORIA[categoria]?.lina || [];
            
            if (campos.length === 0) return;
            
            // Crear t√≠tulo
            const titulo = document.createElement('h3');
            titulo.className = 'font-bold text-blue-900 mb-4 text-lg col-span-2';
            titulo.textContent = `üìù Campos Espec√≠ficos de ${categoria}`;
            container.appendChild(titulo);
            
            // Crear inputs
            campos.forEach(campo => {
                const div = document.createElement('div');
                const label = document.createElement('label');
                label.className = 'block text-sm font-bold text-gray-700 mb-2';
                label.textContent = formatearNombreCampo(campo);
                
                const input = document.createElement('input');
                input.type = 'text';
                input.id = `lina_${campo}`;
                input.className = 'w-full p-3 border-2 border-blue-300 rounded-lg';
                input.value = data[campo] || '';
                
                div.appendChild(label);
                div.appendChild(input);
                container.appendChild(div);
            });
        }

        window.cerrarModal = function() {
            document.getElementById('modal-evaluacion').classList.add('hidden');
            idRegistroActual = null;
        };

        // ==================== GUARDAR EVALUACI√ìN (LINA) ====================
        window.guardarEvaluacion = async function() {
            if (!idRegistroActual) {
                alert('‚ö†Ô∏è No hay registro seleccionado');
                return;
            }
            
            const btnGuardar = document.getElementById('btn-guardar-lina');
            btnGuardar.disabled = true;
            btnGuardar.textContent = '‚è≥ Guardando...';
            
            try {
                // Obtener el registro actual de Firebase
                const docRef = doc(db, 'solicitudes', idRegistroActual);
                const docSnap = await getDoc(docRef);
                
                if (!docSnap.exists()) {
                    throw new Error('Registro no encontrado');
                }
                
                const datosActuales = docSnap.data();
                
                // Datos de evaluaci√≥n de Lina
                const datosLina = {
                    timestamp_lina: new Date().toISOString(),
                    estado_ciarp: document.getElementById('edit-estado-ciarp').value,
                    puntaje_eval1: parseFloat(document.getElementById('edit-puntaje-eval1').value) || 0,
                    puntaje_eval2: parseFloat(document.getElementById('edit-puntaje-eval2').value) || 0,
                    puntaje_asignado: parseFloat(document.getElementById('edit-puntaje-final').value) || 0,
                    acta_ciarp: document.getElementById('edit-acta').value,
                    resolucion: document.getElementById('edit-resolucion').value,
                    observaciones_lina: document.getElementById('edit-observaciones-lina').value
                };
                
                // Agregar campos espec√≠ficos de Lina
                const categoria = datosActuales.categoria;
                const camposEspecificos = CAMPOS_POR_CATEGORIA[categoria]?.lina || [];
                camposEspecificos.forEach(campo => {
                    const input = document.getElementById(`lina_${campo}`);
                    if (input) {
                        datosLina[campo] = input.value;
                    }
                });
                
                // Actualizar en Firebase
                await updateDoc(docRef, datosLina);
                console.log('‚úÖ Actualizado en Firebase');
                
                // Preparar datos para Sheets (combinar Jos√© + Lina)
                const datosCompletos = {
                    ...datosActuales,
                    ...datosLina,
                    tipo_registro: "LINA",
                    _fila: datosActuales._fila
                };
                
                // Enviar a Google Sheets
                const responseSheets = await fetch(urlAppsScript, {
                    method: 'POST',
                    body: JSON.stringify(datosCompletos)
                });
                
                const resultSheets = await responseSheets.json();
                console.log('‚úÖ Respuesta de Sheets:', resultSheets);
                
                if (resultSheets.status === 'success') {
                    alert('‚úÖ Evaluaci√≥n guardada correctamente');
                    cerrarModal();
                    cargarPendientesLina();
                } else {
                    throw new Error(resultSheets.message || 'Error desconocido');
                }
                
            } catch (error) {
                console.error('‚ùå Error:', error);
                alert('‚ùå Error al guardar: ' + error.message);
            } finally {
                btnGuardar.disabled = false;
                btnGuardar.textContent = 'üíæ GUARDAR EVALUACI√ìN';
            }
        };

        // Autenticaci√≥n an√≥nima
        signInAnonymously(auth).catch(error => {
            console.error('‚ùå Error de autenticaci√≥n:', error);
        });
    </script>
</head>
<body class="bg-gradient-to-br from-gray-100 to-gray-200 min-h-screen">
    <!-- HEADER -->
    <header id="header-bg" class="bg-gray-700 text-white shadow-lg sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 py-4 flex justify-between items-center">
            <h1 id="header-title" class="text-2xl font-bold">SISTEMA DE PRODUCTIVIDAD UQ 2024</h1>
            <button onclick="cerrarSesion()" class="hidden bg-white/20 hover:bg-white/30 px-4 py-2 rounded-lg font-semibold transition" id="btn-cerrar-sesion">
                üö™ Cerrar Sesi√≥n
            </button>
        </div>
    </header>

    <!-- PANTALLA DE LOGIN -->
    <div id="pantalla-login" class="max-w-4xl mx-auto mt-20 px-4">
        <div class="bg-white rounded-3xl shadow-2xl overflow-hidden">
            <div class="bg-gradient-to-r from-green-700 to-blue-900 p-8 text-white text-center">
                <h1 class="text-4xl font-bold mb-2">üéì Sistema de Productividad</h1>
                <p class="text-xl">Universidad del Quind√≠o - 2024</p>
            </div>
            
            <div class="p-10">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <!-- CARD JOS√â -->
                    <div class="bg-green-50 border-4 border-green-200 rounded-2xl p-8 hover:shadow-xl transition">
                        <div class="text-center mb-6">
                            <div class="bg-green-700 text-white w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-4 text-4xl">
                                üìù
                            </div>
                            <h2 class="text-2xl font-bold text-green-900">JOS√â</h2>
                            <p class="text-sm text-green-700 mt-2">Seguimiento de Solicitudes</p>
                        </div>
                        <input type="password" id="password-jose" placeholder="Contrase√±a" 
                               class="w-full p-3 border-2 border-green-300 rounded-lg mb-4 text-center font-bold"
                               onkeypress="if(event.key==='Enter') intentarLogin('JOSE')">
                        <button onclick="intentarLogin('JOSE')" 
                                class="w-full bg-green-700 text-white py-4 rounded-lg font-bold text-lg hover:bg-green-800 transition shadow-lg">
                            ‚úÖ INICIAR SESI√ìN
                        </button>
                    </div>

                    <!-- CARD LINA -->
                    <div class="bg-blue-50 border-4 border-blue-200 rounded-2xl p-8 hover:shadow-xl transition">
                        <div class="text-center mb-6">
                            <div class="bg-blue-900 text-white w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-4 text-4xl">
                                üìä
                            </div>
                            <h2 class="text-2xl font-bold text-blue-900">LINA</h2>
                            <p class="text-sm text-blue-700 mt-2">Compilado y Liquidaci√≥n</p>
                        </div>
                        <input type="password" id="password-lina" placeholder="Contrase√±a" 
                               class="w-full p-3 border-2 border-blue-300 rounded-lg mb-4 text-center font-bold"
                               onkeypress="if(event.key==='Enter') intentarLogin('LINA')">
                        <button onclick="intentarLogin('LINA')" 
                                class="w-full bg-blue-900 text-white py-4 rounded-lg font-bold text-lg hover:bg-blue-950 transition shadow-lg">
                            ‚úÖ INICIAR SESI√ìN
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- PANEL JOS√â -->
    <div id="panel-jose" class="hidden max-w-7xl mx-auto mt-8 px-4 pb-8">
        <div class="bg-white rounded-2xl shadow-xl p-8">
            <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center gap-3">
                <span class="bg-green-700 text-white p-3 rounded-lg">üìù</span>
                REGISTRO DE NUEVA SOLICITUD
            </h2>
            
            <form id="form-jose" class="space-y-6">
                <!-- Informaci√≥n General -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-xs font-bold text-gray-600 mb-1">Categor√≠a *</label>
                        <select id="categoria" onchange="cambiarCategoria()" required class="w-full p-2 border rounded font-semibold">
                            <option value="">Seleccione...</option>
                            <option>Art√≠culos Indexados</option>
                            <option>Art√≠culos No Indexados</option>
                            <option>Libro Investigaci√≥n</option>
                            <option>Libro Texto</option>
                            <option>Software</option>
                            <option>Producci√≥n T√©cnica</option>
                            <option>Producci√≥n Audiovisual</option>
                            <option>Obra Art√≠stica</option>
                            <option>Patente</option>
                            <option>Premio</option>
                            <option>Ponencias</option>
                            <option>Tesis</option>
                        </select>
                    </div>

                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-xs font-bold text-gray-600 mb-1">A√±o *</label>
                            <select id="anio" required class="w-full p-2 border rounded">
                                <option value="2024">2024</option>
                                <option value="2025">2025</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-xs font-bold text-gray-600 mb-1">Semestre *</label>
                            <select id="semestre" required class="w-full p-2 border rounded">
                                <option value="1">1</option>
                                <option value="2">2</option>
                            </select>
                        </div>
                    </div>

                    <div>
                        <label class="block text-xs font-bold text-gray-600 mb-1">Fecha Recibido *</label>
                        <input type="date" id="fecha_recibido" required class="w-full p-2 border rounded">
                    </div>

                    <div class="md:col-span-2">
                        <label class="block text-xs font-bold text-gray-600 mb-1">T√≠tulo del Producto *</label>
                        <input type="text" id="titulo_producto" required class="w-full p-2 border rounded">
                    </div>

                    <div>
                        <label class="block text-xs font-bold text-gray-600 mb-1">Autor/Docente *</label>
                        <input type="text" id="autor" list="lista-docentes-jose" required 
                               onchange="autocompletarDocente()" class="w-full p-2 border rounded">
                        <datalist id="lista-docentes-jose"></datalist>
                    </div>

                    <div>
                        <label class="block text-xs font-bold text-gray-600 mb-1">Programa *</label>
                        <input type="text" id="programa" required class="w-full p-2 border rounded">
                    </div>

                    <div>
                        <label class="block text-xs font-bold text-gray-600 mb-1">Documentaci√≥n Completa</label>
                        <select id="doc_completa" class="w-full p-2 border rounded">
                            <option>Completa</option>
                            <option>Incompleta</option>
                        </select>
                    </div>
                    
                    <div>
                        <label class="block text-xs font-bold text-gray-600 mb-1">Estado Inicial</label>
                        <select id="estado_ciarp" class="w-full p-2 border rounded">
                            <option>Pendiente</option>
                            <option>Aprobado</option>
                            <option>No Aprobado</option>
                        </select>
                    </div>
                </div>

                <!-- Campos Espec√≠ficos Din√°micos -->
                <div id="campos-extras-jose" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <!-- Aqu√≠ se insertar√°n los campos espec√≠ficos seg√∫n la categor√≠a -->
                </div>

                <!-- Observaciones -->
                <div>
                    <label class="block text-xs font-bold text-gray-600 mb-1">Observaciones de Jos√©</label>
                    <textarea id="observaciones-jose" rows="3" class="w-full p-2 border rounded"></textarea>
                </div>

                <button type="button" id="btn-enviar-jose" onclick="enviarSolicitud()" 
                        class="w-full bg-green-700 text-white py-4 rounded-lg font-bold text-lg hover:bg-green-800 transition shadow-lg">
                    ‚úÖ ENVIAR SOLICITUD
                </button>
            </form>
        </div>
    </div>

    <!-- PANEL LINA -->
    <div id="panel-lina" class="hidden max-w-7xl mx-auto mt-8 px-4 pb-8">
        <div class="bg-white rounded-2xl shadow-xl p-8">
            <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center gap-3">
                <span class="bg-blue-900 text-white p-3 rounded-lg">üìä</span>
                SOLICITUDES PENDIENTES
            </h2>
            
            <div class="overflow-x-auto">
                <table class="w-full border-collapse">
                    <thead>
                        <tr class="bg-blue-900 text-white">
                            <th class="border p-3 text-sm font-bold">Categor√≠a</th>
                            <th class="border p-3 text-sm font-bold">T√≠tulo</th>
                            <th class="border p-3 text-sm font-bold">Autor</th>
                            <th class="border p-3 text-sm font-bold">Programa</th>
                            <th class="border p-3 text-sm font-bold">Estado</th>
                            <th class="border p-3 text-sm font-bold">Puntaje</th>
                        </tr>
                    </thead>
                    <tbody id="tabla-pendientes-lina">
                        <tr><td colspan="6" class="text-center py-8 text-gray-500">Cargando...</td></tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- MODAL EVALUACI√ìN (LINA) -->
    <div id="modal-evaluacion" class="hidden fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50">
        <div class="bg-white rounded-2xl shadow-2xl max-w-5xl w-full max-h-[90vh] overflow-y-auto">
            <div class="sticky top-0 bg-blue-900 text-white p-6 rounded-t-2xl flex justify-between items-center">
                <h2 class="text-2xl font-bold">üìù EVALUACI√ìN Y COMPILADO</h2>
                <button onclick="cerrarModal()" class="text-white hover:text-gray-200 text-3xl font-bold">√ó</button>
            </div>

            <div class="p-8 space-y-6">
                <!-- Informaci√≥n de Jos√© (solo lectura) -->
                <div class="bg-green-50 p-6 rounded-lg border-2 border-green-200">
                    <h3 class="font-bold text-green-900 mb-4 text-lg">üìã Informaci√≥n Original (Jos√©)</h3>
                    <div class="grid grid-cols-3 gap-4 text-sm">
                        <div><strong class="text-gray-700">Categor√≠a:</strong> <span id="info-categoria" class="text-gray-900"></span></div>
                        <div><strong class="text-gray-700">Fecha Recibido:</strong> <span id="info-fecha" class="text-gray-900"></span></div>
                        <div><strong class="text-gray-700">Doc. Completa:</strong> <span id="info-doc-completa" class="text-gray-900"></span></div>
                        <div class="col-span-3"><strong class="text-gray-700">T√≠tulo:</strong> <span id="info-titulo" class="text-gray-900 font-semibold"></span></div>
                        <div><strong class="text-gray-700">Autor:</strong> <span id="info-autor" class="text-gray-900"></span></div>
                        <div class="col-span-2"><strong class="text-gray-700">Programa:</strong> <span id="info-programa" class="text-gray-900"></span></div>
                        <div class="col-span-3"><strong class="text-gray-700">Observaciones:</strong> <span id="info-obs-jose" class="text-gray-900"></span></div>
                    </div>
                </div>

                <!-- Datos del Docente desde BD_Docentes (solo lectura) -->
                <div class="bg-yellow-50 p-6 rounded-lg border-2 border-yellow-200">
                    <h3 class="font-bold text-yellow-900 mb-4 text-lg">üë§ Datos del Docente (BD_Docentes)</h3>
                    <div class="mb-3">
                        <label class="block text-xs font-bold text-gray-700 mb-1">Buscar Docente</label>
                        <input type="text" id="buscar-docente-lina" list="lista-docentes-lina" 
                               class="w-full p-2 border-2 border-yellow-300 rounded bg-white" readonly>
                        <datalist id="lista-docentes-lina"></datalist>
                    </div>
                    <div class="grid grid-cols-3 gap-4 text-sm">
                        <div><strong class="text-gray-700">C√©dula:</strong> <span id="info-cedula" class="text-gray-900"></span></div>
                        <div class="col-span-2"><strong class="text-gray-700">Correo:</strong> <span id="info-correo" class="text-gray-900"></span></div>
                        <div><strong class="text-gray-700">Escolaridad:</strong> <span id="info-escolaridad" class="text-gray-900"></span></div>
                        <div><strong class="text-gray-700">Categor√≠a:</strong> <span id="info-categoria-doc" class="text-gray-900"></span></div>
                        <div><strong class="text-gray-700">Dedicaci√≥n:</strong> <span id="info-dedicacion" class="text-gray-900"></span></div>
                        <div class="col-span-3"><strong class="text-gray-700">Facultad:</strong> <span id="info-facultad" class="text-gray-900"></span></div>
                    </div>
                </div>

                <!-- Evaluaci√≥n de Lina (editable) -->
                <div class="bg-blue-50 p-6 rounded-lg border-2 border-blue-200">
                    <h3 class="font-bold text-blue-900 mb-4 text-lg">‚≠ê Evaluaci√≥n CIARP (Editable)</h3>
                    
                    <div class="mb-4">
                        <label class="block text-sm font-bold text-gray-700 mb-2">Estado CIARP</label>
                        <select id="edit-estado-ciarp" class="w-full p-3 border-2 border-blue-300 rounded-lg font-bold text-lg">
                            <option value="Pendiente">‚è≥ Pendiente</option>
                            <option value="Aprobado">‚úÖ Aprobado</option>
                            <option value="No Aprobado">‚ùå No Aprobado</option>
                        </select>
                    </div>

                    <div class="grid grid-cols-4 gap-4 mb-4">
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-2">Puntaje Eval 1</label>
                            <input type="number" step="0.1" id="edit-puntaje-eval1" class="w-full p-3 border-2 border-blue-300 rounded-lg text-center font-bold text-lg">
                        </div>
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-2">Puntaje Eval 2</label>
                            <input type="number" step="0.1" id="edit-puntaje-eval2" class="w-full p-3 border-2 border-blue-300 rounded-lg text-center font-bold text-lg">
                        </div>
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-2">Puntaje Final</label>
                            <input type="number" step="0.1" id="edit-puntaje-final" class="w-full p-3 border-2 border-green-500 bg-green-50 rounded-lg text-center font-bold text-xl text-green-700">
                        </div>
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-2">Acta CIARP</label>
                            <input type="text" id="edit-acta" class="w-full p-3 border-2 border-blue-300 rounded-lg">
                        </div>
                    </div>

                    <div class="grid grid-cols-2 gap-4 mb-4">
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-2">Resoluci√≥n</label>
                            <input type="text" id="edit-resolucion" placeholder="R.R. No..." class="w-full p-3 border-2 border-blue-300 rounded-lg">
                        </div>
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-2">Observaciones T√©cnicas</label>
                            <textarea id="edit-observaciones-lina" rows="3" class="w-full p-3 border-2 border-blue-300 rounded-lg"></textarea>
                        </div>
                    </div>

                    <!-- Campos espec√≠ficos de Lina por categor√≠a -->
                    <div id="campos-especificos-lina" class="grid grid-cols-2 gap-4">
                        <!-- Aqu√≠ se insertar√°n los campos espec√≠ficos de Lina seg√∫n la categor√≠a -->
                    </div>
                </div>

                <button id="btn-guardar-lina" onclick="guardarEvaluacion()" 
                        class="w-full bg-blue-900 text-white py-4 rounded-xl font-bold hover:bg-blue-950 transition text-lg shadow-lg">
                    üíæ GUARDAR EVALUACI√ìN
                </button>
            </div>
        </div>
    </div>

</body>
</html>

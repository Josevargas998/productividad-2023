<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema Productividad UQ 2024</title>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-app.js";
        import { getFirestore, collection, addDoc, getDocs, updateDoc, doc, query, orderBy, getDoc, deleteDoc } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-firestore.js";
        import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-auth.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBbqMf8ZOmqmbGTmr2tr8nziyUWKSE6OWg",
            authDomain: "uniquindio-produccion.firebaseapp.com",
            projectId: "uniquindio-produccion",
            storageBucket: "uniquindio-produccion.firebasestorage.app",
            messagingSenderId: "440871309124",
            appId: "1:440871309124:web:108be1894adaf6ecaf1111"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);
        
        // ‚ö†Ô∏è IMPORTANTE: Reemplaza esta URL con la URL de tu Apps Script implementado
        const urlAppsScript = "https://script.google.com/macros/s/AKfycbwobOnXi21gqYfj7g7vHXRNYQKXpT8Qk44pyUPUVr1fj8vpUB7Ctf58lJg4oxsbeGgKsw/exec";

        let rolActual = '';
        let idRegistroActual = null;
        let baseDocentes = [];

        const CONTRASE√ëAS = {
            'JOSE': 'jose2026',
            'LINA': 'lina2026'
        };

        // ==================== LOGIN ====================
        window.intentarLogin = function(rol) {
            const password = document.getElementById(`password-${rol.toLowerCase()}`).value;
            
            if (!password) {
                alert("‚ö†Ô∏è Ingrese la contrase√±a");
                return;
            }
            
            if (password === CONTRASE√ëAS[rol]) {
                iniciarSesion(rol);
            } else {
                alert("‚ùå Contrase√±a incorrecta");
                document.getElementById(`password-${rol.toLowerCase()}`).value = '';
            }
        };

        function iniciarSesion(rol) {
            rolActual = rol;
            document.getElementById('pantalla-login').classList.add('hidden');
            
            if (rol === 'JOSE') {
                document.getElementById('panel-jose').classList.remove('hidden');
                document.getElementById('header-title').innerText = "SEGUIMIENTO DE SOLICITUDES (JOS√â)";
                document.getElementById('header-bg').classList.remove('bg-gray-700');
                document.getElementById('header-bg').classList.add('bg-green-800');
                cargarBaseDocentes();
                cambiarCategoria();
            } else {
                document.getElementById('panel-lina').classList.remove('hidden');
                document.getElementById('header-title').innerText = "COMPILADO Y LIQUIDACI√ìN (LINA)";
                document.getElementById('header-bg').classList.remove('bg-gray-700');
                document.getElementById('header-bg').classList.add('bg-blue-900');
                cargarBaseDocentes();
                cargarPendientesLina();
            }
        }

        window.cerrarSesion = function() {
            location.reload();
        };

        // ==================== CARGAR DOCENTES DESDE GOOGLE SHEETS ====================
        async function cargarBaseDocentes() {
            try {
                console.log('üîÑ Cargando base de docentes desde Google Sheets...');
                
                const response = await fetch(urlAppsScript + '?action=obtenerDocentes');
                const data = await response.json();
                
                if (data && Array.isArray(data) && data.length > 0) {
                    baseDocentes = data;
                    
                    // Llenar datalist para Jos√©
                    const datalistJose = document.getElementById('lista-docentes-jose');
                    if (datalistJose) {
                        datalistJose.innerHTML = '';
                        data.forEach(doc => {
                            const option = document.createElement('option');
                            option.value = doc.nombre;
                            datalistJose.appendChild(option);
                        });
                    }
                    
                    // Llenar datalist para Lina
                    const datalistLina = document.getElementById('lista-docentes-lina');
                    if (datalistLina) {
                        datalistLina.innerHTML = '';
                        data.forEach(doc => {
                            const option = document.createElement('option');
                            option.value = doc.nombre;
                            datalistLina.appendChild(option);
                        });
                    }
                    
                    console.log(`‚úÖ ${data.length} docentes cargados correctamente`);
                } else {
                    console.warn('‚ö†Ô∏è No se encontraron docentes en la base de datos');
                    alert('‚ö†Ô∏è Advertencia: No se pudieron cargar los docentes. Verifique que la hoja BD_Docentes exista en Google Sheets.');
                }
                    
            } catch (error) {
                console.error('‚ùå Error al cargar docentes:', error);
                alert('‚ùå Error al conectar con Google Sheets. Verifique la configuraci√≥n del Apps Script.');
            }
        }

        // ==================== AUTOCOMPLETAR DOCENTE (JOS√â) ====================
        window.autocompletarDocente = function() {
            const nombreInput = document.getElementById('autor');
            const nombreSeleccionado = nombreInput?.value.trim();
            
            if (!nombreSeleccionado) return;
            
            const docente = baseDocentes.find(d => d.nombre === nombreSeleccionado);
            
            if (docente) {
                // Llenar autom√°ticamente el programa
                const programaInput = document.getElementById('programa');
                if (programaInput && docente.dependencia) {
                    programaInput.value = docente.dependencia;
                }
                
                // Indicaci√≥n visual
                nombreInput.classList.add('border-green-500', 'bg-green-50');
                setTimeout(() => {
                    nombreInput.classList.remove('border-green-500', 'bg-green-50');
                }, 1500);
                
                console.log('‚úÖ Docente encontrado:', docente.nombre);
            } else {
                console.warn('‚ö†Ô∏è Docente no encontrado en BD_Docentes');
            }
        };

        // ==================== JOS√â: CAMBIAR CATEGOR√çA ====================
        window.cambiarCategoria = function() {
            const cat = document.getElementById('categoria').value;
            const container = document.getElementById('campos-especificos-jose');
            const inputClass = "w-full p-2 border border-gray-300 rounded focus:ring-2 focus:ring-green-500";
            const labelClass = "block text-xs font-bold text-gray-600 mb-1";
            
            let html = '';

            if (cat === "Art√≠culos Indexados" || cat === "Art√≠culos No Indexados") {
                html = `
                    <div><label class="${labelClass}">Nombre del Art√≠culo *</label>
                    <input type="text" id="nombre_articulo" class="${inputClass}" required></div>
                    <div><label class="${labelClass}">T√≠tulo de la Revista</label>
                    <input type="text" id="titulo_revista" class="${inputClass}"></div>
                `;
            } else if (cat.includes("Libro")) {
                html = `
                    <div><label class="${labelClass}">T√≠tulo del Libro *</label>
                    <input type="text" id="titulo_libro" class="${inputClass}" required></div>
                    <div><label class="${labelClass}">√Årea de Conocimiento</label>
                    <input type="text" id="area_conocimiento" class="${inputClass}"></div>
                `;
            } else if (cat === "Premio") {
                html = `
                    <div><label class="${labelClass}">T√≠tulo del Trabajo Premiado *</label>
                    <input type="text" id="titulo_premiado" class="${inputClass}" required></div>
                    <div><label class="${labelClass}">Premio Otorgado</label>
                    <input type="text" id="premio_otorgado" class="${inputClass}"></div>
                `;
            } else if (cat === "Software") {
                html = `
                    <div><label class="${labelClass}">T√≠tulo del Software *</label>
                    <input type="text" id="titulo_software" class="${inputClass}" required></div>
                    <div><label class="${labelClass}">Tipo</label>
                    <input type="text" id="tipo_software" class="${inputClass}"></div>
                `;
            }

            container.innerHTML = html;
        };

        // ==================== JOS√â: ENVIAR SOLICITUD ====================
        window.enviarSolicitud = async function() {
            const categoria = document.getElementById('categoria').value;
            const anio = document.getElementById('anio').value;
            const semestre = document.getElementById('semestre').value;
            const fechaRecibido = document.getElementById('fecha-recibido').value;
            const autor = document.getElementById('autor').value;
            const programa = document.getElementById('programa').value;

            if (!categoria || !anio || !semestre || !fechaRecibido || !autor) {
                alert("‚ö†Ô∏è Complete los campos obligatorios");
                return;
            }

            // Obtener t√≠tulo seg√∫n categor√≠a
            let tituloProducto = '';
            if (categoria.includes("Art√≠culo")) {
                tituloProducto = document.getElementById('nombre_articulo')?.value || '';
            } else if (categoria.includes("Libro")) {
                tituloProducto = document.getElementById('titulo_libro')?.value || '';
            } else if (categoria === "Premio") {
                tituloProducto = document.getElementById('titulo_premiado')?.value || '';
            } else if (categoria === "Software") {
                tituloProducto = document.getElementById('titulo_software')?.value || '';
            }

            if (!tituloProducto) {
                alert("‚ö†Ô∏è Complete el t√≠tulo del producto");
                return;
            }

            const btnEnviar = document.getElementById('btn-enviar-jose');
            btnEnviar.disabled = true;
            btnEnviar.innerText = "‚è≥ ENVIANDO...";

            try {
                const data = {
                    categoria: categoria,
                    anio: anio,
                    semestre: semestre,
                    fecha_recibido: fechaRecibido,
                    titulo_producto: tituloProducto,
                    autor: autor,
                    programa: programa,
                    doc_completa: document.getElementById('doc-completa')?.value || 'Pendiente',
                    estado_ciarp: 'Pendiente',
                    observaciones_jose: document.getElementById('observaciones-jose')?.value || '',
                    timestamp: new Date().toISOString(),
                    tipo_registro: "JOSE"
                };

                // Guardar en Firebase
                const docRef = await addDoc(collection(db, "solicitudes"), data);
                console.log("‚úÖ Firebase ID:", docRef.id);

                // Enviar a Google Sheets
                try {
                    await fetch(urlAppsScript, {
                        method: 'POST',
                        mode: 'no-cors',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(data)
                    });
                    console.log("‚úÖ Enviado a Google Sheets");
                } catch (sheetError) {
                    console.warn("‚ö†Ô∏è No se pudo conectar con Sheets (los datos est√°n en Firebase):", sheetError);
                }

                alert("‚úÖ Solicitud enviada correctamente");
                document.getElementById('form-jose').reset();
                document.getElementById('campos-especificos-jose').innerHTML = '';
                
            } catch (error) {
                console.error("‚ùå Error:", error);
                alert("‚ùå Error: " + error.message);
            } finally {
                btnEnviar.disabled = false;
                btnEnviar.innerText = "‚úÖ ENVIAR SOLICITUD";
            }
        };

        // ==================== LINA: CARGAR PENDIENTES ====================
        window.cargarPendientesLina = async function() {
            try {
                await signInAnonymously(auth);
                const q = query(collection(db, "solicitudes"), orderBy("timestamp", "desc"));
                const querySnapshot = await getDocs(q);

                const tbody = document.getElementById('tabla-pendientes-lina');
                tbody.innerHTML = '';

                if (querySnapshot.empty) {
                    tbody.innerHTML = '<tr><td colspan="6" class="text-center py-8 text-gray-500">No hay solicitudes registradas</td></tr>';
                    return;
                }

                querySnapshot.forEach((docSnap) => {
                    const data = docSnap.data();
                    const estadoColor = data.estado_ciarp === 'Aprobado' ? 'bg-green-100 text-green-800' : 
                                       data.estado_ciarp === 'No Aprobado' ? 'bg-red-100 text-red-800' : 
                                       'bg-yellow-100 text-yellow-800';
                    
                    const row = `<tr class="hover:bg-blue-50 cursor-pointer transition" onclick="abrirEvaluacion('${docSnap.id}')">
                        <td class="border px-3 py-2 text-xs">${data.categoria || ''}</td>
                        <td class="border px-3 py-2 text-xs font-semibold">${data.titulo_producto || ''}</td>
                        <td class="border px-3 py-2 text-xs">${data.autor || ''}</td>
                        <td class="border px-3 py-2 text-xs">${data.programa || ''}</td>
                        <td class="border px-3 py-2 text-center">
                            <span class="px-3 py-1 rounded-full text-xs font-bold ${estadoColor}">
                                ${data.estado_ciarp || 'Pendiente'}
                            </span>
                        </td>
                        <td class="border px-3 py-2 text-center text-sm font-bold">${data.puntaje_asignado || 0}</td>
                    </tr>`;
                    tbody.innerHTML += row;
                });

            } catch (error) {
                console.error("‚ùå Error al cargar pendientes:", error);
                alert("‚ùå Error al cargar solicitudes: " + error.message);
            }
        };

        // ==================== LINA: ABRIR EVALUACI√ìN ====================
        window.abrirEvaluacion = async function(id) {
            idRegistroActual = id;
            
            try {
                const docRef = doc(db, "solicitudes", id);
                const docSnap = await getDoc(docRef);

                if (!docSnap.exists()) {
                    alert("‚ùå Registro no encontrado");
                    return;
                }

                const data = docSnap.data();
                
                document.getElementById('modal-evaluacion').classList.remove('hidden');
                
                // ===== DATOS DE JOS√â (SOLO LECTURA) =====
                document.getElementById('info-categoria').innerText = data.categoria || '';
                document.getElementById('info-titulo').innerText = data.titulo_producto || '';
                document.getElementById('info-autor').innerText = data.autor || '';
                document.getElementById('info-programa').innerText = data.programa || '';
                document.getElementById('info-fecha').innerText = data.fecha_recibido || '';
                document.getElementById('info-doc-completa').innerText = data.doc_completa || '';
                document.getElementById('info-obs-jose').innerText = data.observaciones_jose || 'Sin observaciones';
                
                // ===== BUSCAR DOCENTE EN BD_DOCENTES =====
                const buscadorDocente = document.getElementById('buscar-docente-lina');
                if (buscadorDocente && data.autor) {
                    buscadorDocente.value = data.autor;
                    
                    const docente = baseDocentes.find(d => d.nombre === data.autor);
                    
                    if (docente) {
                        // Llenar datos del docente (SOLO LECTURA)
                        document.getElementById('info-cedula').innerText = docente.cedula || '';
                        document.getElementById('info-correo').innerText = docente.correo || '';
                        document.getElementById('info-escolaridad').innerText = docente.escolaridad || '';
                        document.getElementById('info-categoria-doc').innerText = docente.categoria || '';
                        document.getElementById('info-dedicacion').innerText = docente.dedicacion || '';
                        document.getElementById('info-facultad').innerText = docente.facultad || '';
                        
                        console.log('‚úÖ Datos del docente cargados:', docente.nombre);
                    } else {
                        console.warn('‚ö†Ô∏è Docente no encontrado en BD_Docentes');
                    }
                }
                
                // ===== DATOS EDITABLES DE LINA =====
                document.getElementById('edit-estado-ciarp').value = data.estado_ciarp || 'Pendiente';
                document.getElementById('edit-puntaje-eval1').value = data.puntaje_eval1 || '';
                document.getElementById('edit-puntaje-eval2').value = data.puntaje_eval2 || '';
                document.getElementById('edit-puntaje-final').value = data.puntaje_asignado || '';
                document.getElementById('edit-acta').value = data.acta_ciarp || '';
                document.getElementById('edit-resolucion').value = data.resolucion || '';
                document.getElementById('edit-observaciones-lina').value = data.observaciones_lina || '';
                
            } catch (error) {
                console.error("‚ùå Error:", error);
                alert("‚ùå Error: " + error.message);
            }
        };

        // ==================== LINA: GUARDAR EVALUACI√ìN ====================
        window.guardarEvaluacion = async function() {
            if (!idRegistroActual) {
                alert("‚ùå No hay registro seleccionado");
                return;
            }

            const btnGuardar = document.getElementById('btn-guardar-lina');
            btnGuardar.disabled = true;
            btnGuardar.innerText = "‚è≥ GUARDANDO...";

            try {
                const data = {
                    estado_ciarp: document.getElementById('edit-estado-ciarp').value,
                    puntaje_eval1: parseFloat(document.getElementById('edit-puntaje-eval1').value) || 0,
                    puntaje_eval2: parseFloat(document.getElementById('edit-puntaje-eval2').value) || 0,
                    puntaje_asignado: parseFloat(document.getElementById('edit-puntaje-final').value) || 0,
                    acta_ciarp: document.getElementById('edit-acta').value,
                    resolucion: document.getElementById('edit-resolucion').value,
                    observaciones_lina: document.getElementById('edit-observaciones-lina').value,
                    timestamp_lina: new Date().toISOString(),
                    tipo_registro: "LINA"
                };

                // Obtener datos originales
                const docRef = doc(db, "solicitudes", idRegistroActual);
                const docSnap = await getDoc(docRef);
                const originalData = docSnap.data();

                // Actualizar Firebase
                await updateDoc(docRef, data);
                console.log("‚úÖ Firebase actualizado");

                // Actualizar Google Sheets
                const sheetData = {
                    ...data,
                    titulo_producto: originalData.titulo_producto,
                    autor: originalData.autor,
                    _fila: originalData._fila,
                    categoria: originalData.categoria
                };

                try {
                    await fetch(urlAppsScript, {
                        method: 'POST',
                        mode: 'no-cors',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(sheetData)
                    });
                    console.log("‚úÖ Google Sheets actualizado");
                } catch (sheetError) {
                    console.warn("‚ö†Ô∏è No se pudo conectar con Sheets (los datos est√°n en Firebase):", sheetError);
                }

                alert("‚úÖ Evaluaci√≥n guardada correctamente");
                cerrarModal();
                cargarPendientesLina();
                
            } catch (error) {
                console.error("‚ùå Error:", error);
                alert("‚ùå Error: " + error.message);
            } finally {
                btnGuardar.disabled = false;
                btnGuardar.innerText = "üíæ GUARDAR EVALUACI√ìN";
            }
        };

        // ==================== CERRAR MODAL ====================
        window.cerrarModal = function() {
            document.getElementById('modal-evaluacion').classList.add('hidden');
            idRegistroActual = null;
        };

    </script>
</head>
<body class="bg-gray-100 min-h-screen">

    <!-- HEADER -->
    <div id="header-bg" class="text-white py-6 shadow-xl bg-gray-700 transition-colors duration-300">
        <div class="max-w-7xl mx-auto px-6 flex justify-between items-center">
            <div>
                <h1 id="header-title" class="text-3xl font-bold">Sistema Productividad Acad√©mica</h1>
                <p class="text-sm opacity-90 mt-1">Universidad del Quind√≠o - 2024</p>
            </div>
            <button onclick="cerrarSesion()" class="bg-white/20 hover:bg-white/30 px-6 py-2 rounded-lg font-bold transition">
                üîì CERRAR SESI√ìN
            </button>
        </div>
    </div>

    <!-- PANTALLA LOGIN -->
    <div id="pantalla-login" class="max-w-4xl mx-auto mt-16 px-4">
        <div class="bg-white rounded-3xl shadow-2xl p-12">
            <h2 class="text-4xl font-bold text-center text-gray-800 mb-12">Seleccione su Perfil</h2>
            
            <div class="grid grid-cols-2 gap-8">
                <!-- JOS√â -->
                <div class="bg-gradient-to-br from-green-800 to-green-600 p-8 rounded-2xl text-white shadow-xl">
                    <div class="text-center mb-6">
                        <div class="bg-white/20 w-24 h-24 rounded-full mx-auto flex items-center justify-center text-5xl mb-4">üìã</div>
                        <h3 class="text-2xl font-bold">JOS√â</h3>
                        <p class="text-sm opacity-90 mt-2">Seguimiento de Solicitudes</p>
                    </div>
                    <input type="password" id="password-jose" placeholder="Contrase√±a" 
                           class="w-full p-3 rounded-lg mb-4 text-gray-800 font-semibold"
                           onkeypress="if(event.key==='Enter') intentarLogin('JOSE')">
                    <button onclick="intentarLogin('JOSE')" 
                            class="w-full bg-white text-green-800 py-3 rounded-lg font-bold hover:bg-gray-100 transition">
                        INGRESAR
                    </button>
                </div>

                <!-- LINA -->
                <div class="bg-gradient-to-br from-blue-900 to-blue-700 p-8 rounded-2xl text-white shadow-xl">
                    <div class="text-center mb-6">
                        <div class="bg-white/20 w-24 h-24 rounded-full mx-auto flex items-center justify-center text-5xl mb-4">üìä</div>
                        <h3 class="text-2xl font-bold">LINA</h3>
                        <p class="text-sm opacity-90 mt-2">Compilado y Liquidaci√≥n</p>
                    </div>
                    <input type="password" id="password-lina" placeholder="Contrase√±a" 
                           class="w-full p-3 rounded-lg mb-4 text-gray-800 font-semibold"
                           onkeypress="if(event.key==='Enter') intentarLogin('LINA')">
                    <button onclick="intentarLogin('LINA')" 
                            class="w-full bg-white text-blue-900 py-3 rounded-lg font-bold hover:bg-gray-100 transition">
                        INGRESAR
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- PANEL JOS√â -->
    <div id="panel-jose" class="hidden max-w-6xl mx-auto mt-8 px-4 pb-8">
        <div class="bg-white rounded-2xl shadow-xl p-8">
            <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center gap-3">
                <span class="bg-green-800 text-white p-3 rounded-lg">üìã</span>
                NUEVA SOLICITUD
            </h2>
            
            <form id="form-jose" class="space-y-6">
                <!-- Datos b√°sicos -->
                <div class="grid grid-cols-4 gap-4">
                    <div>
                        <label class="block text-xs font-bold text-gray-600 mb-1">Categor√≠a *</label>
                        <select id="categoria" onchange="cambiarCategoria()" class="w-full p-2 border rounded" required>
                            <option value="">Seleccionar...</option>
                            <option>Art√≠culos Indexados</option>
                            <option>Art√≠culos No Indexados</option>
                            <option>Libro Investigaci√≥n</option>
                            <option>Libro Texto</option>
                            <option>Libro Ensayo</option>
                            <option>Premio</option>
                            <option>Software</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-xs font-bold text-gray-600 mb-1">A√±o *</label>
                        <input type="number" id="anio" class="w-full p-2 border rounded" required>
                    </div>
                    <div>
                        <label class="block text-xs font-bold text-gray-600 mb-1">Semestre *</label>
                        <select id="semestre" class="w-full p-2 border rounded" required>
                            <option value="">Seleccionar...</option>
                            <option>1</option>
                            <option>2</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-xs font-bold text-gray-600 mb-1">Fecha Recibido *</label>
                        <input type="date" id="fecha-recibido" class="w-full p-2 border rounded" required>
                    </div>
                </div>

                <!-- Datos del docente -->
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-xs font-bold text-gray-600 mb-1">Autor/Docente * (escribe para buscar)</label>
                        <input type="text" id="autor" list="lista-docentes-jose" 
                               class="w-full p-2 border rounded" 
                               onchange="autocompletarDocente()"
                               placeholder="Buscar docente..."
                               required>
                        <datalist id="lista-docentes-jose"></datalist>
                    </div>
                    <div>
                        <label class="block text-xs font-bold text-gray-600 mb-1">Programa/Dependencia</label>
                        <input type="text" id="programa" class="w-full p-2 border rounded bg-gray-50" readonly>
                    </div>
                </div>

                <!-- Campos espec√≠ficos seg√∫n categor√≠a -->
                <div id="campos-especificos-jose" class="grid grid-cols-2 gap-4"></div>

                <!-- Documentaci√≥n -->
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-xs font-bold text-gray-600 mb-1">Documentaci√≥n Completa</label>
                        <select id="doc-completa" class="w-full p-2 border rounded">
                            <option>Pendiente</option>
                            <option>Completa</option>
                            <option>Incompleta</option>
                        </select>
                    </div>
                </div>

                <!-- Observaciones -->
                <div>
                    <label class="block text-xs font-bold text-gray-600 mb-1">Observaciones de Jos√©</label>
                    <textarea id="observaciones-jose" rows="3" class="w-full p-2 border rounded"></textarea>
                </div>

                <button type="button" id="btn-enviar-jose" onclick="enviarSolicitud()" 
                        class="w-full bg-green-700 text-white py-4 rounded-lg font-bold text-lg hover:bg-green-800 transition shadow-lg">
                    ‚úÖ ENVIAR SOLICITUD
                </button>
            </form>
        </div>
    </div>

    <!-- PANEL LINA -->
    <div id="panel-lina" class="hidden max-w-7xl mx-auto mt-8 px-4 pb-8">
        <div class="bg-white rounded-2xl shadow-xl p-8">
            <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center gap-3">
                <span class="bg-blue-900 text-white p-3 rounded-lg">üìä</span>
                SOLICITUDES PENDIENTES
            </h2>
            
            <div class="overflow-x-auto">
                <table class="w-full border-collapse">
                    <thead>
                        <tr class="bg-blue-900 text-white">
                            <th class="border p-3 text-sm font-bold">Categor√≠a</th>
                            <th class="border p-3 text-sm font-bold">T√≠tulo</th>
                            <th class="border p-3 text-sm font-bold">Autor</th>
                            <th class="border p-3 text-sm font-bold">Programa</th>
                            <th class="border p-3 text-sm font-bold">Estado</th>
                            <th class="border p-3 text-sm font-bold">Puntaje</th>
                        </tr>
                    </thead>
                    <tbody id="tabla-pendientes-lina">
                        <tr><td colspan="6" class="text-center py-8 text-gray-500">Cargando...</td></tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- MODAL EVALUACI√ìN (LINA) -->
    <div id="modal-evaluacion" class="hidden fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50">
        <div class="bg-white rounded-2xl shadow-2xl max-w-5xl w-full max-h-[90vh] overflow-y-auto">
            <div class="sticky top-0 bg-blue-900 text-white p-6 rounded-t-2xl flex justify-between items-center">
                <h2 class="text-2xl font-bold">üìù EVALUACI√ìN Y COMPILADO</h2>
                <button onclick="cerrarModal()" class="text-white hover:text-gray-200 text-3xl font-bold">√ó</button>
            </div>

            <div class="p-8 space-y-6">
                <!-- Informaci√≥n de Jos√© (solo lectura) -->
                <div class="bg-green-50 p-6 rounded-lg border-2 border-green-200">
                    <h3 class="font-bold text-green-900 mb-4 text-lg">üìã Informaci√≥n Original (Jos√©)</h3>
                    <div class="grid grid-cols-3 gap-4 text-sm">
                        <div><strong class="text-gray-700">Categor√≠a:</strong> <span id="info-categoria" class="text-gray-900"></span></div>
                        <div><strong class="text-gray-700">Fecha Recibido:</strong> <span id="info-fecha" class="text-gray-900"></span></div>
                        <div><strong class="text-gray-700">Doc. Completa:</strong> <span id="info-doc-completa" class="text-gray-900"></span></div>
                        <div class="col-span-3"><strong class="text-gray-700">T√≠tulo:</strong> <span id="info-titulo" class="text-gray-900 font-semibold"></span></div>
                        <div><strong class="text-gray-700">Autor:</strong> <span id="info-autor" class="text-gray-900"></span></div>
                        <div class="col-span-2"><strong class="text-gray-700">Programa:</strong> <span id="info-programa" class="text-gray-900"></span></div>
                        <div class="col-span-3"><strong class="text-gray-700">Observaciones:</strong> <span id="info-obs-jose" class="text-gray-900"></span></div>
                    </div>
                </div>

                <!-- Datos del Docente desde BD_Docentes (solo lectura) -->
                <div class="bg-yellow-50 p-6 rounded-lg border-2 border-yellow-200">
                    <h3 class="font-bold text-yellow-900 mb-4 text-lg">üë§ Datos del Docente (BD_Docentes)</h3>
                    <div class="mb-3">
                        <label class="block text-xs font-bold text-gray-700 mb-1">Buscar Docente</label>
                        <input type="text" id="buscar-docente-lina" list="lista-docentes-lina" 
                               class="w-full p-2 border-2 border-yellow-300 rounded bg-white" readonly>
                        <datalist id="lista-docentes-lina"></datalist>
                    </div>
                    <div class="grid grid-cols-3 gap-4 text-sm">
                        <div><strong class="text-gray-700">C√©dula:</strong> <span id="info-cedula" class="text-gray-900"></span></div>
                        <div class="col-span-2"><strong class="text-gray-700">Correo:</strong> <span id="info-correo" class="text-gray-900"></span></div>
                        <div><strong class="text-gray-700">Escolaridad:</strong> <span id="info-escolaridad" class="text-gray-900"></span></div>
                        <div><strong class="text-gray-700">Categor√≠a:</strong> <span id="info-categoria-doc" class="text-gray-900"></span></div>
                        <div><strong class="text-gray-700">Dedicaci√≥n:</strong> <span id="info-dedicacion" class="text-gray-900"></span></div>
                        <div class="col-span-3"><strong class="text-gray-700">Facultad:</strong> <span id="info-facultad" class="text-gray-900"></span></div>
                    </div>
                </div>

                <!-- Evaluaci√≥n de Lina (editable) -->
                <div class="bg-blue-50 p-6 rounded-lg border-2 border-blue-200">
                    <h3 class="font-bold text-blue-900 mb-4 text-lg">‚≠ê Evaluaci√≥n CIARP (Editable)</h3>
                    
                    <div class="mb-4">
                        <label class="block text-sm font-bold text-gray-700 mb-2">Estado CIARP</label>
                        <select id="edit-estado-ciarp" class="w-full p-3 border-2 border-blue-300 rounded-lg font-bold text-lg">
                            <option value="Pendiente">‚è≥ Pendiente</option>
                            <option value="Aprobado">‚úÖ Aprobado</option>
                            <option value="No Aprobado">‚ùå No Aprobado</option>
                        </select>
                    </div>

                    <div class="grid grid-cols-4 gap-4 mb-4">
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-2">Puntaje Eval 1</label>
                            <input type="number" step="0.1" id="edit-puntaje-eval1" class="w-full p-3 border-2 border-blue-300 rounded-lg text-center font-bold text-lg">
                        </div>
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-2">Puntaje Eval 2</label>
                            <input type="number" step="0.1" id="edit-puntaje-eval2" class="w-full p-3 border-2 border-blue-300 rounded-lg text-center font-bold text-lg">
                        </div>
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-2">Puntaje Final</label>
                            <input type="number" step="0.1" id="edit-puntaje-final" class="w-full p-3 border-2 border-green-500 bg-green-50 rounded-lg text-center font-bold text-xl text-green-700">
                        </div>
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-2">Acta CIARP</label>
                            <input type="text" id="edit-acta" class="w-full p-3 border-2 border-blue-300 rounded-lg">
                        </div>
                    </div>

                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-2">Resoluci√≥n</label>
                            <input type="text" id="edit-resolucion" placeholder="R.R. No..." class="w-full p-3 border-2 border-blue-300 rounded-lg">
                        </div>
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-2">Observaciones T√©cnicas</label>
                            <textarea id="edit-observaciones-lina" rows="3" class="w-full p-3 border-2 border-blue-300 rounded-lg"></textarea>
                        </div>
                    </div>
                </div>

                <button id="btn-guardar-lina" onclick="guardarEvaluacion()" 
                        class="w-full bg-blue-900 text-white py-4 rounded-xl font-bold hover:bg-blue-950 transition text-lg shadow-lg">
                    üíæ GUARDAR EVALUACI√ìN
                </button>
            </div>
        </div>
    </div>

</body>
</html>
